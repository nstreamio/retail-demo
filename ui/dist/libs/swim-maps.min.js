// @swim/maps v4.0.0-dev.20220527.3 (c) 2015-2023 Swim.inc
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@swim/core"),require("@swim/core"),require("@swim/core"),require("@swim/ui"),require("@swim/ui"),require("@swim/ui"),require("@swim/ui"),require("@swim/ui"),require("@swim/ui"),require("@swim/core"),require("@swim/ui")):"function"==typeof define&&define.amd?define(["exports","@swim/core","@swim/core","@swim/core","@swim/ui","@swim/ui","@swim/ui","@swim/ui","@swim/ui","@swim/ui","@swim/core","@swim/ui"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).swim=e.swim||{},e.swim,e.swim,e.swim,e.swim,e.swim,e.swim,e.swim,e.swim,e.swim,e.swim,e.swim)}(this,(function(e,t,i,s,n,r,o,l,a,h,u,d){"use strict";function c(e,t,i,s,n,r){function o(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var l,a=s.kind,h="getter"===a?"get":"setter"===a?"set":"value",u=!t&&e?s.static?e:e.prototype:null,d=t||(u?Object.getOwnPropertyDescriptor(u,s.name):{}),c=!1,p=i.length-1;p>=0;p--){var v={};for(var w in s)v[w]="access"===w?{}:s[w];for(var w in s.access)v.access[w]=s.access[w];v.addInitializer=function(e){if(c)throw new TypeError("Cannot add initializers after decoration has completed");r.push(o(e||null))};var g=(0,i[p])("accessor"===a?{get:d.get,set:d.set}:d[h],v);if("accessor"===a){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(l=o(g.get))&&(d.get=l),(l=o(g.set))&&(d.set=l),(l=o(g.init))&&n.unshift(l)}else(l=o(g))&&("field"===a?n.unshift(l):d[h]=l)}u&&Object.defineProperty(u,s.name,d),c=!0}function p(e,t,i){for(var s=arguments.length>2,n=0;n<t.length;n++)i=s?t[n].call(e,i):t[n].call(e);return s?i:void 0}"function"==typeof SuppressedError&&SuppressedError;const v={[Symbol.hasInstance]:e=>g[Symbol.hasInstance](e)||e instanceof i.GeoShape||w[Symbol.hasInstance](e)||i.GeoBoxInit[Symbol.hasInstance](e)},w={[Symbol.hasInstance]:e=>t.Objects.hasAnyKey(e,"geoFrame","geoCenter")},g={fromLike:e=>null==e||g[Symbol.hasInstance](e)?e:e instanceof i.GeoShape||i.GeoBoxLike[Symbol.hasInstance](e)?{geoFrame:i.GeoBox.fromLike(e),geoCenter:null,zoom:void 0,heading:void 0,tilt:void 0}:{geoFrame:void 0!==e.geoFrame&&null!==e.geoFrame?i.GeoBox.fromLike(e.geoFrame):null,geoCenter:void 0!==e.geoCenter&&null!==e.geoCenter?i.GeoPoint.fromLike(e.geoCenter):null,zoom:e.zoom,heading:e.heading,tilt:e.tilt},[Symbol.hasInstance]:e=>t.Objects.hasAllKeys(e,"geoFrame","geoCenter","zoom","heading","tilt")},m={[Symbol.hasInstance]:e=>i.GeoProjection[Symbol.hasInstance](e)&&g[Symbol.hasInstance](e)};let f=(()=>{var e;let t,a,h=[],u=[];return e=class e extends l.GraphicsView{constructor(){super(),this.geoViewport=(p(this,h),p(this,u,void 0)),this.geoBounds=i.GeoBox.undefined()}get geoBoundsColor(){return r.ThemeAnimator.getter()}didInsertChild(t,i){t instanceof e&&this.onInsertChildGeoBounds(t,t.geoBounds),super.didInsertChild(t,i)}didRemoveChild(t){t instanceof e&&this.onRemoveChildGeoBounds(t,t.geoBounds),super.didRemoveChild(t)}onRender(){super.onRender();const e=r.ThemeAnimator.tryValue(this,"geoBoundsColor");null!==e&&this.renderGeoBounds(e,1)}renderGeoBounds(e,t){const i=this.renderer.value;i instanceof l.PaintingRenderer&&!this.hidden&&!this.culled&&!this.unbounded&&this.renderGeoOutline(this.geoBounds,i.context,e,t)}renderGeoOutline(e,t,i,s){const n=this.geoViewport.value;if(!e.isDefined()||null===n)return;const r=t.lineWidth,o=t.strokeStyle,l=n.project(e.southWest.normalized()),a=n.project(e.northWest.normalized()),h=n.project(e.northEast.normalized()),u=n.project(e.southEast.normalized());t.beginPath(),t.moveTo(l.x,l.y),t.lineTo(a.x,a.y),t.lineTo(h.x,h.y),t.lineTo(u.x,u.y),t.closePath(),t.lineWidth=s,t.strokeStyle=i.toString(),t.stroke(),t.lineWidth=r,t.strokeStyle=o}onHide(){super.onHide();const t=this.parent;t instanceof e&&t.onHideChild(this)}onUnhide(){super.onUnhide();const t=this.parent;t instanceof e&&t.onUnhideChild(this)}onSetUnbounded(t){const i=this.parent;i instanceof e&&i.onSetChildUnbounded(this,t)}cullGeoFrame(e=this.geoFrame){this.setCulled(!e.intersects(this.geoBounds))}get geoFrame(){const t=this.parent;return t instanceof e?t.geoFrame:i.GeoBox.globe()}setGeoBounds(e){const t=this.geoBounds;t.equals(e)||(this.willSetGeoBounds(e,t),this.geoBounds=e,this.onSetGeoBounds(e,t),this.didSetGeoBounds(e,t))}willSetGeoBounds(e,t){this.callObservers("viewWillSetGeoBounds",e,t,this)}onSetGeoBounds(t,i){if(this.unbounded)return;const s=this.parent;s instanceof e&&s.onSetChildGeoBounds(this,t,i)}didSetGeoBounds(e,t){this.callObservers("viewDidSetGeoBounds",e,t,this)}updateGeoBounds(){this.setGeoBounds(this.deriveGeoBounds())}onInsertChildGeoBounds(e,t){this.updateGeoBounds()}onRemoveChildGeoBounds(e,t){this.updateGeoBounds()}onSetChildGeoBounds(e,t,i){this.updateGeoBounds()}onHideChild(e){this.updateGeoBounds()}onUnhideChild(e){this.updateGeoBounds()}onSetChildUnbounded(e,t){this.updateGeoBounds()}get ownGeoBounds(){return null}deriveGeoBounds(){let t=this.ownGeoBounds,i=this.firstChild;for(;null!==i;){if(i instanceof e&&!i.hidden&&!i.unbounded){const e=i.geoBounds;e.isDefined()&&(t=null!==t?t.union(e):e)}i=i.nextSibling}return null===t&&(t=this.geoFrame),t}},t=[r.ThemeAnimator({valueType:n.Color,value:null,inherits:!0})],a=[s.Property({valueType:m,value:null,inherits:!0})],c(e,null,t,{kind:"getter",name:"geoBoundsColor",static:!1,private:!1,access:{has:e=>"geoBoundsColor"in e,get:e=>e.geoBoundsColor}},null,h),c(null,null,a,{kind:"field",name:"geoViewport",static:!1,private:!1,access:{has:e=>"geoViewport"in e,get:e=>e.geoViewport,set:(e,t)=>{e.geoViewport=t}}},u,h),e.MountFlags=l.GraphicsView.MountFlags|o.View.NeedsProject,e.UncullFlags=l.GraphicsView.UncullFlags|o.View.NeedsProject,e})(),y=(()=>{var e;let t,i=[],n=[];return e=class extends a.Trait{constructor(){super(...arguments),this.geoPerspective=(p(this,i),p(this,n,void 0))}createGeoController(){return new V}},t=[s.Property({valueType:g,value:null,didSetValue(e){this.owner.callObservers("traitDidSetGeoPerspective",e,this.owner)}})],c(null,null,t,{kind:"field",name:"geoPerspective",static:!1,private:!1,access:{has:e=>"geoPerspective"in e,get:e=>e.geoPerspective,set:(e,t)=>{e.geoPerspective=t}}},n,i),e})(),V=(()=>{var e;let t,i,n=[],r=[],l=[];return e=class extends h.Controller{constructor(){super(...arguments),this.geoPerspective=(p(this,n),p(this,r,void 0)),this.geo=p(this,l,void 0)}},t=[s.Property({valueType:g,value:null,didSetValue(e){this.owner.callObservers("controllerDidSetGeoPerspective",e,this.owner)}})],i=[h.TraitViewRef({traitType:y,willAttachTrait(e){this.owner.callObservers("controllerWillAttachGeoTrait",e,this.owner)},initTrait(e){this.owner.geoPerspective.bindInlet(e.geoPerspective)},deinitTrait(e){this.owner.geoPerspective.unbindInlet(e.geoPerspective)},didDetachTrait(e){this.owner.callObservers("controllerDidDetachGeoTrait",e,this.owner)},viewType:f,willAttachView(e){e.requireUpdate(o.View.NeedsProject),this.owner.callObservers("controllerWillAttachGeoView",e,this.owner)},didDetachView(e){this.owner.callObservers("controllerDidDetachGeoView",e,this.owner)}})],c(null,null,t,{kind:"field",name:"geoPerspective",static:!1,private:!1,access:{has:e=>"geoPerspective"in e,get:e=>e.geoPerspective,set:(e,t)=>{e.geoPerspective=t}}},r,n),c(null,null,i,{kind:"field",name:"geo",static:!1,private:!1,access:{has:e=>"geo"in e,get:e=>e.geo,set:(e,t)=>{e.geo=t}}},l,n),e})(),C=(()=>{var e;let a,h,d,v,w,g,m=[],y=[],V=[],C=[],T=[],x=[],k=[];return e=class e extends f{constructor(){super(),this.geoCenter=(p(this,m),p(this,y,void 0)),this.viewCenter=p(this,V,void 0),this.radius=p(this,C,void 0),this.stroke=p(this,T,void 0),this.strokeWidth=p(this,x,void 0),this.source=p(this,k,void 0),Object.defineProperty(this,"viewBounds",{value:u.R2Box.undefined(),writable:!0,enumerable:!0,configurable:!0}),this.setFlags(this.flags|o.View.UnboundedFlag)}onProject(){super.onProject(),this.projectRipple()}projectGeoCenter(e){const t=this.geoViewport.value;if(!this.mounted||null===t)return;const i=null!==e&&e.isDefined()?t.project(e):null;this.viewCenter.setInterpolatedValue(this.viewCenter.value,i),this.projectRipple()}projectRipple(){const e=this.geoViewport.value;if(!this.viewCenter.hasAffinity(s.Affinity.Intrinsic)||null===e)return;const t=this.geoCenter.value,i=null!==t&&t.isDefined()?e.project(t):null;this.viewCenter.setIntrinsic(i)}onRender(){super.onRender();const e=this.renderer.value;e instanceof l.PaintingRenderer&&!this.hidden&&!this.culled&&this.renderRipple(e.context,this.viewFrame)}renderRipple(e,t){const i=this.viewCenter.value;if(null===i||!i.isDefined())return;const s=Math.min(t.width,t.height),n=this.radius.getValue().pxValue(s),r=this.stroke.value;if(null===r)return;const o=e.lineWidth,l=e.strokeStyle;e.beginPath(),e.arc(i.x,i.y,n,0,2*Math.PI);const a=this.strokeWidth.value;null!==a&&(e.lineWidth=a.pxValue(s)),e.strokeStyle=r.toString(),e.stroke(),e.lineWidth=o,e.strokeStyle=l}renderGeoBounds(e,t){}updateGeoBounds(){}updateViewBounds(){this.viewBounds=this.deriveViewBounds()}deriveViewBounds(){const e=this.viewCenter.value;return null!==e&&e.isDefined()?e.bounds:u.R2Box.undefined()}ripple(e){let s,o,l,a,h,d;s=void 0===e||void 0===e.source?null:e.source,o=void 0===e||void 0===e.center||null===e.center?null:i.GeoPoint.fromLike(e.center),l=void 0===e||void 0===e.width||null===e.width?null:u.Length.fromLike(e.width),a=void 0===e||void 0===e.radius||null===e.radius?u.Length.pct(12.5):u.Length.fromLike(e.radius),h=void 0===e||void 0===e.color||null===e.color?this.getLookOr(r.Look.accentColor,null):e.color instanceof r.Look?this.getLookOr(e.color,null):n.Color.fromLike(e.color),d=void 0===e||void 0===e.timing||!0===e.timing?this.getLookOr(r.Look.timing,r.Mood.ambient,!1):"number"==typeof e.timing?t.Easing.linear.withDuration(e.timing):t.Timing.fromLike(e.timing);const c=void 0!==e?e.opacity:void 0;return null!==s&&this.source.setView(s),null!==o&&this.geoCenter.setIntrinsic(o),null!==l&&this.strokeWidth.setIntrinsic(l),this.radius.set(a,d),null!==h&&(this.stroke.set(void 0!==c?h.alpha(c):h),this.stroke.set(h.alpha(0),d)),this}static ripple(t,i){let s;if(document.hidden||t.hidden||t.culled||null===(s=t.geoViewport.value)||!t.geoBounds.intersects(s.geoFrame))return null;const n=e.create();n.source.setView(t);let r=t.getRoot(f);return null===r&&(r=t),r.appendChild(n),n.ripple(i),n}},a=[s.Animator({valueType:i.GeoPoint,value:null,didSetState(e){this.owner.projectGeoCenter(e)},didSetValue(e){this.owner.setGeoBounds(null!==e?e.bounds:i.GeoBox.undefined()),this.mounted&&this.owner.projectRipple(),this.owner.callObservers("viewDidSetGeoCenter",e,this.owner)}})],h=[s.Animator({valueType:u.R2Point,value:u.R2Point.undefined(),updateFlags:o.View.NeedsRender,didSetValue(e){this.owner.updateViewBounds()}})],d=[r.ThemeAnimator({valueType:u.Length,value:u.Length.zero(),updateFlags:o.View.NeedsRender,didTransition(){this.owner.source.setView(null),this.owner.remove()}})],v=[r.ThemeAnimator({valueType:n.Color,value:null,look:r.Look.accentColor,inherits:!0,updateFlags:o.View.NeedsRender})],w=[r.ThemeAnimator({valueType:u.Length,value:u.Length.px(1),inherits:!0,updateFlags:o.View.NeedsRender})],g=[o.ViewRef({observes:!0,didAttachView(e){this.owner.geoCenter.setIntrinsic(e.geoBounds.center)},viewDidUnmount(e){this.owner.remove()},viewDidSetGeoBounds(e){this.owner.geoCenter.setIntrinsic(e.center)}})],c(null,null,a,{kind:"field",name:"geoCenter",static:!1,private:!1,access:{has:e=>"geoCenter"in e,get:e=>e.geoCenter,set:(e,t)=>{e.geoCenter=t}}},y,m),c(null,null,h,{kind:"field",name:"viewCenter",static:!1,private:!1,access:{has:e=>"viewCenter"in e,get:e=>e.viewCenter,set:(e,t)=>{e.viewCenter=t}}},V,m),c(null,null,d,{kind:"field",name:"radius",static:!1,private:!1,access:{has:e=>"radius"in e,get:e=>e.radius,set:(e,t)=>{e.radius=t}}},C,m),c(null,null,v,{kind:"field",name:"stroke",static:!1,private:!1,access:{has:e=>"stroke"in e,get:e=>e.stroke,set:(e,t)=>{e.stroke=t}}},T,m),c(null,null,w,{kind:"field",name:"strokeWidth",static:!1,private:!1,access:{has:e=>"strokeWidth"in e,get:e=>e.strokeWidth,set:(e,t)=>{e.strokeWidth=t}}},x,m),c(null,null,g,{kind:"field",name:"source",static:!1,private:!1,access:{has:e=>"source"in e,get:e=>e.source,set:(e,t)=>{e.source=t}}},k,m),e})(),T=(()=>{var e;let t,i,n=[],r=[];return e=class extends f{constructor(){super(...arguments),this.gesture=(p(this,n),p(this,r,void 0))}get hyperlink(){return s.Property.getter()}didPress(e,t){if(e.defaultPrevented)return;this.callObservers("viewDidPress",e,t,this);const i=this.hyperlink.value;null===i||e.defaultPrevented||(e.preventDefault(),i.activate(t))}didLongPress(e){e.defaultPrevented||this.callObservers("viewDidLongPress",e,this)}ripple(e){return C.ripple(this,e)}},t=[s.Property({valueType:h.Hyperlink,value:null})],i=[o.PositionGesture({bindsOwner:!0,didMovePress(e,t){const i=e.x-e.x0,s=e.y-e.y0;i*i+s*s>16&&this.cancelPress(e,t)},didStartHovering(){this.owner.callObservers("viewDidEnter",this.owner)},didStopHovering(){this.owner.callObservers("viewDidLeave",this.owner)},didPress(e,t){e.defaultPrevented||this.owner.didPress(e,t)},didLongPress(e){e.defaultPrevented||this.owner.didLongPress(e)}})],c(e,null,t,{kind:"getter",name:"hyperlink",static:!1,private:!1,access:{has:e=>"hyperlink"in e,get:e=>e.hyperlink}},null,n),c(null,null,i,{kind:"field",name:"gesture",static:!1,private:!1,access:{has:e=>"gesture"in e,get:e=>e.gesture,set:(e,t)=>{e.gesture=t}}},r,n),e})(),x=(()=>{var e;let t,i=[];return e=class extends y{get hyperlink(){return s.Property.getter()}createGeoController(){return new k}constructor(){super(...arguments),p(this,i)}},t=[s.Property({valueType:h.Hyperlink,value:null})],c(e,null,t,{kind:"getter",name:"hyperlink",static:!1,private:!1,access:{has:e=>"hyperlink"in e,get:e=>e.hyperlink}},null,i),e})(),k=(()=>{var e;let t,i,n,r,o,l,a,u=[],d=[],v=[],w=[],g=[];return e=class extends V{constructor(){super(...arguments),this.intersectsViewport=(p(this,u),p(this,d,void 0)),this.visible=p(this,v,void 0),this.consumable=p(this,w,void 0),this.geo=p(this,g,void 0)}get visibleRange(){return s.Property.getter()}get consumeRange(){return s.Property.getter()}get hyperlink(){return s.Property.getter()}},t=[s.Property({inherits:!0,value:[0,1/0],didSetValue(e){this.owner.visible.decohere()},setMin(e,t){this.setValue([e,this.value[1]],t)},setMax(e,t){this.setValue([this.value[0],e],t)}})],i=[s.Property({inherits:!0,value:[0,1/0],didSetValue(e){this.owner.consumable.decohere()},setMin(e,t){this.setValue([e,this.value[1]],t)},setMax(e,t){this.setValue([this.value[0],e],t)}})],n=[s.Property({valueType:Boolean,value:!1,inletKeys:[],deriveValue(){let e,t;return!(!this.owner.mounted||null===(e=this.owner.geo.view)||null===(t=e.geoViewport.value))&&t.geoFrame.intersects(e.geoBounds)}})],r=[s.Property({valueType:Boolean,value:!1,inletKeys:["intersectsViewport"],deriveValue(e){let t,i;if(!this.owner.mounted||null===(t=this.owner.geo.view)||null===(i=t.geoViewport.value))return!1;const[s,n]=this.owner.visibleRange.value;return e&&i.zoom>=s&&i.zoom<n},didSetValue(e){const t=this.owner.geo.view;null!==t&&t.setCulled(!e)}})],o=[s.Property({valueType:Boolean,value:!1,inletKeys:["intersectsViewport"],deriveValue(e){let t,i;if(!this.owner.mounted||null===(t=this.owner.geo.view)||null===(i=t.geoViewport.value))return!1;const[s,n]=this.owner.consumeRange.value;return e&&i.zoom>=s&&i.zoom<n},didSetValue(e){const t=this.owner.geo.view;null!==t&&(e?this.owner.consume(t):this.owner.unconsume(t))}})],l=[h.TraitViewRef({extends:!0,traitType:x,initTrait(e){this.owner.hyperlink.bindInlet(e.hyperlink)},deinitTrait(e){this.owner.hyperlink.unbindInlet(e.hyperlink)},viewType:T,observesView:!0,willAttachView(e){e.setCulled(!0),super.willAttachView(e)},initView(e){super.initView(e),e.hyperlink.bindInlet(this.owner.hyperlink)},deinitView(e){e.hyperlink.unbindInlet(this.owner.hyperlink),super.deinitView(e)},viewDidProject(e){this.owner.intersectsViewport.decohere(),this.owner.visible.decohere(),this.owner.consumable.decohere()},viewDidEnter(e){this.owner.callObservers("controllerDidEnterGeoView",e,this.owner)},viewDidLeave(e){this.owner.callObservers("controllerDidLeaveGeoView",e,this.owner)},viewDidPress(e,t,i){this.owner.callObservers("controllerDidPressGeoView",e,t,i,this.owner)},viewDidLongPress(e,t){this.owner.callObservers("controllerDidLongPressGeoView",e,t,this.owner)}})],a=[s.Property({valueType:h.Hyperlink,value:null})],c(e,null,t,{kind:"getter",name:"visibleRange",static:!1,private:!1,access:{has:e=>"visibleRange"in e,get:e=>e.visibleRange}},null,u),c(e,null,i,{kind:"getter",name:"consumeRange",static:!1,private:!1,access:{has:e=>"consumeRange"in e,get:e=>e.consumeRange}},null,u),c(e,null,a,{kind:"getter",name:"hyperlink",static:!1,private:!1,access:{has:e=>"hyperlink"in e,get:e=>e.hyperlink}},null,u),c(null,null,n,{kind:"field",name:"intersectsViewport",static:!1,private:!1,access:{has:e=>"intersectsViewport"in e,get:e=>e.intersectsViewport,set:(e,t)=>{e.intersectsViewport=t}}},d,u),c(null,null,r,{kind:"field",name:"visible",static:!1,private:!1,access:{has:e=>"visible"in e,get:e=>e.visible,set:(e,t)=>{e.visible=t}}},v,u),c(null,null,o,{kind:"field",name:"consumable",static:!1,private:!1,access:{has:e=>"consumable"in e,get:e=>e.consumable,set:(e,t)=>{e.consumable=t}}},w,u),c(null,null,l,{kind:"field",name:"geo",static:!1,private:!1,access:{has:e=>"geo"in e,get:e=>e.geo,set:(e,t)=>{e.geo=t}}},g,u),e})(),b=(()=>{var e;let t,n,r,o,l=[],h=[],u=[],d=[];return e=class extends y{constructor(){super(...arguments),this.geoBounds=(p(this,l),p(this,h,void 0)),this.layers=p(this,u,void 0),this.features=p(this,d,void 0)}get nodeUri(){return s.Property.getter()}consumeLayers(){}unconsumeLayers(){}onStartConsuming(){super.onStartConsuming(),this.features.consumeTraits(this),this.consumeLayers()}onStopConsuming(){super.onStopConsuming(),this.features.unconsumeTraits(this)}createGeoController(){return new S}},t=[s.Property({extends:!0,inherits:!1})],n=[s.Property({valueType:i.GeoBox,value:null,didSetValue(e){this.owner.callObservers("traitDidSetGeoBounds",e,this.owner),this.owner.geoPerspective.setIntrinsic(e)}})],r=[a.TraitModelSet({get traitType(){return b},traitKey:"layer",modelType:a.Model,binds:!0,willAttachTrait(e){this.owner.callObservers("traitWillAttachLayer",e,this.owner)},didDetachTrait(e){this.owner.callObservers("traitDidDetachLayer",e,this.owner)}})],o=[a.TraitModelSet({traitType:x,traitKey:"feature",modelType:a.Model,binds:!0,willAttachTrait(e){this.owner.callObservers("traitWillAttachFeature",e,this.owner)},didAttachTrait(e){this.owner.consuming&&e.consume(this.owner)},willDetachTrait(e){this.owner.consuming&&e.unconsume(this.owner)},didDetachTrait(e){this.owner.callObservers("traitDidDetachFeature",e,this.owner)}})],c(e,null,t,{kind:"getter",name:"nodeUri",static:!1,private:!1,access:{has:e=>"nodeUri"in e,get:e=>e.nodeUri}},null,l),c(null,null,n,{kind:"field",name:"geoBounds",static:!1,private:!1,access:{has:e=>"geoBounds"in e,get:e=>e.geoBounds,set:(e,t)=>{e.geoBounds=t}}},h,l),c(null,null,r,{kind:"field",name:"layers",static:!1,private:!1,access:{has:e=>"layers"in e,get:e=>e.layers,set:(e,t)=>{e.layers=t}}},u,l),c(null,null,o,{kind:"field",name:"features",static:!1,private:!1,access:{has:e=>"features"in e,get:e=>e.features,set:(e,t)=>{e.features=t}}},d,l),e})();class R{constructor(e,t,i,s,n,r,o,l,a,h,u,d){this.depth=e,this.maxDepth=t,this.density=i,this.geoFrame=s,this.geoBounds=n,this.geoCenter=r,this.southWest=o,this.northWest=l,this.southEast=a,this.northEast=h,this.views=u,this.size=d}isEmpty(){return 0===this.size}contains(e){return this.geoFrame.contains(e)}intersects(e){return this.geoFrame.intersects(e)}getTree(e){if(this.depth>=this.maxDepth||this.size<=this.density)return this;const t=this.geoCenter,i=e.lngMin<=t.lng,s=e.latMin<=t.lat,n=e.lngMax>t.lng,r=e.latMax>t.lat;if(i===n||s===r)return this;if(s&&i){const t=this.southWest;if(null!==t)return t.getTree(e)}else if(r&&i){const t=this.northWest;if(null!==t)return t.getTree(e)}else if(s&&n){const t=this.southEast;if(null!==t)return t.getTree(e)}else if(r&&n){const t=this.northEast;if(null!==t)return t.getTree(e)}return this}has(e,t){if(this.depth<this.maxDepth&&this.size>this.density){const i=this.hasNode(e,t);if(void 0!==i)return i}return this.hasLeaf(e,t)}hasNode(e,t){const i=this.geoCenter,s=t.lngMin<=i.lng,n=t.latMin<=i.lat,r=t.lngMax>i.lng,o=t.latMax>i.lat;if(s!==r&&n!==o)if(n&&s){const i=this.southWest;if(null!==i)return i.has(e,t)}else if(o&&s){const i=this.northWest;if(null!==i)return i.has(e,t)}else if(n&&r){const i=this.southEast;if(null!==i)return i.has(e,t)}else if(o&&r){const i=this.northEast;if(null!==i)return i.has(e,t)}}hasLeaf(e,t){return this.views.indexOf(e)>=0}inserted(e,t){let i=this;if(i.depth<i.maxDepth&&i.size>i.density){const s=i.insertedNode(e,t);if(null!==s)return i=s,this!==i&&i.size===i.density+1&&(i=i.reinsertedNode()),i}return i=i.insertedLeaf(e,t),this!==i&&i.depth<i.maxDepth&&i.size===i.density+1&&(i=i.reinsertedNode()),i}insertedNode(e,t){const s=this.geoCenter,n=t.lngMin<=s.lng,r=t.latMin<=s.lat,o=t.lngMax>s.lng,l=t.latMax>s.lat;if(n===o||r===l)return null;if(r&&n){const s=this.southWest;let n=s;return null===n&&(n=this.createTree(this.depth+1,this.maxDepth,this.density,new i.GeoBox(this.geoFrame.lngMin,this.geoFrame.latMin,this.geoCenter.lng,this.geoCenter.lat))),n=n.inserted(e,t),s===n?this:this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,n,this.northWest,this.southEast,this.northEast,this.views,this.size+1)}if(l&&n){const s=this.northWest;let n=s;return null===n&&(n=this.createTree(this.depth+1,this.maxDepth,this.density,new i.GeoBox(this.geoFrame.lngMin,this.geoCenter.lat,this.geoCenter.lng,this.geoFrame.latMax))),n=n.inserted(e,t),s===n?this:this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,n,this.southEast,this.northEast,this.views,this.size+1)}if(r&&o){const s=this.southEast;let n=s;return null===n&&(n=this.createTree(this.depth+1,this.maxDepth,this.density,new i.GeoBox(this.geoCenter.lng,this.geoFrame.latMin,this.geoFrame.lngMax,this.geoCenter.lat))),n=n.inserted(e,t),s===n?this:this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,this.northWest,n,this.northEast,this.views,this.size+1)}if(l&&o){const s=this.northEast;let n=s;return null===n&&(n=this.createTree(this.depth+1,this.maxDepth,this.density,new i.GeoBox(this.geoCenter.lng,this.geoCenter.lat,this.geoFrame.lngMax,this.geoFrame.latMax))),n=n.inserted(e,t),s===n?this:this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,this.northWest,this.southEast,n,this.views,this.size+1)}return null}insertedLeaf(e,t){const i=this.views;if(i.indexOf(e)>=0)return this;const s=i.slice(0);return s.push(e),this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,this.northWest,this.southEast,this.northEast,s,this.size+1)}removed(e,t){let i=this;if(i.depth<i.maxDepth&&i.size>i.density){const s=i.removedNode(e,t);if(null!==s)return i=s,this!==i&&i.size===i.density&&(i=i.reinsertedLeaf()),i}return i=i.removedLeaf(e,t),this!==i&&i.size===i.density&&(i=i.reinsertedLeaf()),i}removedNode(e,t){const i=this.geoCenter,s=t.lngMin<=i.lng,n=t.latMin<=i.lat,r=t.lngMax>i.lng,o=t.latMax>i.lat;if(s===r||n===o)return null;if(n&&s){const i=this.southWest;if(null===i)return this;let s=i.removed(e,t);return s.isEmpty()&&(s=null),this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,s,this.northWest,this.southEast,this.northEast,this.views,this.size-1)}if(o&&s){const i=this.northWest;if(null===i)return this;let s=i.removed(e,t);return s.isEmpty()&&(s=null),this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,s,this.southEast,this.northEast,this.views,this.size-1)}if(n&&r){const i=this.southEast;if(null===i)return this;let s=i.removed(e,t);return s.isEmpty()&&(s=null),this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,this.northWest,s,this.northEast,this.views,this.size-1)}if(o&&r){const i=this.northEast;if(null===i)return this;let s=i.removed(e,t);return s.isEmpty()&&(s=null),this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,this.northWest,this.southEast,s,this.views,this.size-1)}return null}removedLeaf(e,t){const i=this.views,s=i.indexOf(e);if(s<0)return this;const n=i.slice(0);return n.splice(s,1),this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,this.northWest,this.southEast,this.northEast,n,this.size-1)}reinsertedNode(){let e=this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter);return this.forEach((function(t){const i=t.geoBounds,s=e.insertedNode(t,i);e=null!==s?s:e.insertedLeaf(t,i)}),this),e}reinsertedLeaf(){let e=this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter);return this.forEach((function(t){e=e.insertedLeaf(t,t.geoBounds)}),this),e}moved(e,t,i){if(this.depth>=this.maxDepth||this.size<=this.density)return this;const s=this.geoCenter,n=t.lngMin<=s.lng,r=t.latMin<=s.lat,o=t.lngMax>s.lng,l=t.latMax>s.lat,a=i.lngMin<=s.lng,h=i.latMin<=s.lat,u=i.lngMax>s.lng,d=i.latMax>s.lat;if(n!==a||r!==h||o!==u||l!==d)return this.removed(e,i).inserted(e,t);if(n===o||r===l)return this;if(r&&n){const s=this.southWest,n=s.moved(e,t,i);return s===n?this:this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,n,this.northWest,this.southEast,this.northEast,this.views,this.size)}if(l&&n){const s=this.northWest,n=s.moved(e,t,i);return s===n?this:this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,n,this.southEast,this.northEast,this.views,this.size)}if(r&&o){const s=this.southEast,n=s.moved(e,t,i);return s===n?this:this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,this.northWest,n,this.northEast,this.views,this.size)}if(l&&o){const s=this.northEast,n=s.moved(e,t,i);return s===n?this:this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,this.northWest,this.southEast,n,this.views,this.size)}return this}forEach(e,t){if(null!==this.southWest){const i=this.southWest.forEach(e,t);if(void 0!==i)return i}if(null!==this.northWest){const i=this.northWest.forEach(e,t);if(void 0!==i)return i}if(null!==this.southEast){const i=this.southEast.forEach(e,t);if(void 0!==i)return i}if(null!==this.northEast){const i=this.northEast.forEach(e,t);if(void 0!==i)return i}const i=this.views;for(let s=0;s<i.length;s+=1){const n=e.call(t,i[s]);if(void 0!==n)return n}}forEachReverse(e,t){const i=this.views;for(let s=i.length-1;s>=0;s-=1){const n=e.call(t,i[s]);if(void 0!==n)return n}if(null!==this.northEast){const i=this.northEast.forEachReverse(e,t);if(void 0!==i)return i}if(null!==this.southEast){const i=this.southEast.forEachReverse(e,t);if(void 0!==i)return i}if(null!==this.northWest){const i=this.northWest.forEachReverse(e,t);if(void 0!==i)return i}if(null!==this.southWest){const i=this.southWest.forEachReverse(e,t);if(void 0!==i)return i}}forEachIntersecting(e,t,i){if(!this.geoFrame.intersects(e))return;if(null!==this.southWest){const s=this.southWest.forEachIntersecting(e,t,i);if(void 0!==s)return s}if(null!==this.northWest){const s=this.northWest.forEachIntersecting(e,t,i);if(void 0!==s)return s}if(null!==this.southEast){const s=this.southEast.forEachIntersecting(e,t,i);if(void 0!==s)return s}if(null!==this.northEast){const s=this.northEast.forEachIntersecting(e,t,i);if(void 0!==s)return s}const s=this.views;for(let e=0;e<s.length;e+=1){const n=t.call(i,s[e]);if(void 0!==n)return n}}forEachNonIntersecting(e,t,i){if(this.geoFrame.intersects(e))return;if(null!==this.southWest){const s=this.southWest.forEachNonIntersecting(e,t,i);if(void 0!==s)return s}if(null!==this.northWest){const s=this.northWest.forEachNonIntersecting(e,t,i);if(void 0!==s)return s}if(null!==this.southEast){const s=this.southEast.forEachNonIntersecting(e,t,i);if(void 0!==s)return s}if(null!==this.northEast){const s=this.northEast.forEachNonIntersecting(e,t,i);if(void 0!==s)return s}const s=this.views;for(let e=0;e<s.length;e+=1){const n=t.call(i,s[e]);if(void 0!==n)return n}}createTree(e,i,s,n,r,o,l=null,a=null,h=null,u=null,d=t.Arrays.empty(),c=0){if(void 0===o&&(o=n.center),void 0===r){null!==l&&(r=l.geoBounds),null!==a&&(r=void 0!==r?r.union(a.geoBounds):a.geoBounds),null!==h&&(r=void 0!==r?r.union(h.geoBounds):h.geoBounds),null!==u&&(r=void 0!==r?r.union(u.geoBounds):u.geoBounds);for(let e=0;e<d.length;e+=1){const t=d[e];r=void 0!==r?r.union(t.geoBounds):t.geoBounds}void 0===r&&(r=n)}return new R(e,i,s,n,r,o,l,a,h,u,d,c)}static empty(e,s,n,r){return void 0===e&&(e=i.GeoBox.globe()),void 0===s&&(s=0),void 0===n&&(n=20),n=Math.max(s,n),void 0===r&&(r=8),new R(s,n,r,e,e,e.center,null,null,null,null,t.Arrays.empty(),0)}}let P=(()=>{var e;let t,i=[];return e=class extends f{constructor(e,t,s,n){super(),this.root=void p(this,i),this.root=R.empty(e,t,s,n),this.stem=null}updateRoot(e){this.root=e,this.stem=null,this.setGeoBounds(e.geoBounds)}getStem(e){let t=this.stem;return null===t&&(t=this.root.getTree(e),this.stem=t),t}onInsertChild(e,t){super.onInsertChild(e,t),e instanceof f&&this.updateRoot(this.root.inserted(e,e.geoBounds))}onRemoveChild(e){super.onRemoveChild(e),e instanceof f&&this.updateRoot(this.root.removed(e,e.geoBounds))}willProject(){super.willProject(),this.stem=null}processChildren(e,t){const i=this.geoViewport.value;if(null===i)return;const s=i.geoFrame,n=this.getStem(s);this.processTree(n,s,e,t)}processTree(e,t,i,s){null!==e.southWest&&e.southWest.geoFrame.intersects(t)&&this.processTree(e.southWest,t,i,s),null!==e.northWest&&e.northWest.geoFrame.intersects(t)&&this.processTree(e.northWest,t,i,s),null!==e.southEast&&e.southEast.geoFrame.intersects(t)&&this.processTree(e.southEast,t,i,s),null!==e.northEast&&e.northEast.geoFrame.intersects(t)&&this.processTree(e.northEast,t,i,s);const n=e.views;for(let e=0;e<n.length;e+=1){const t=n[e];s.call(this,t,i),0!=(t.flags&o.View.RemovingFlag)&&(t.setFlags(t.flags&~o.View.RemovingFlag),this.removeChild(t))}}get geoTreeColor(){return r.ThemeAnimator.getter()}onRender(){super.onRender();const e=r.ThemeAnimator.tryValue(this,"geoTreeColor");null!==e&&this.renderGeoTree(e)}renderGeoTree(e){const t=this.geoViewport.value;if(null===t)return;const i=this.renderer.value;i instanceof l.PaintingRenderer&&!this.hidden&&!this.culled&&this.renderGeoTreeOutline(this.root,t,i.context,e)}renderGeoTreeOutline(e,t,i,s){null!==e.southWest&&this.renderGeoTreeOutline(e.southWest,t,i,s),null!==e.northWest&&this.renderGeoTreeOutline(e.northWest,t,i,s),null!==e.southEast&&this.renderGeoTreeOutline(e.southEast,t,i,s),null!==e.northEast&&this.renderGeoTreeOutline(e.northEast,t,i,s);if(e.depth>=2){const t=(e.depth-2)/(e.maxDepth-2),n=4*(1-t)+.5*t;this.renderGeoOutline(e.geoFrame,i,s,n)}}displayChildren(e,t){const i=this.geoViewport.value;if(null===i)return;const s=i.geoFrame,n=this.getStem(s);this.displayTree(n,s,e,t)}displayTree(e,t,i,s){null!==e.southWest&&e.southWest.geoFrame.intersects(t)&&this.displayTree(e.southWest,t,i,s),null!==e.northWest&&e.northWest.geoFrame.intersects(t)&&this.displayTree(e.northWest,t,i,s),null!==e.southEast&&e.southEast.geoFrame.intersects(t)&&this.displayTree(e.southEast,t,i,s),null!==e.northEast&&e.northEast.geoFrame.intersects(t)&&this.displayTree(e.northEast,t,i,s);const n=e.views;for(let e=0;e<n.length;e+=1){const t=n[e];s.call(this,t,i),0!=(t.flags&o.View.RemovingFlag)&&(t.setFlags(t.flags&~o.View.RemovingFlag),this.removeChild(t))}}updateGeoBounds(){}onSetChildGeoBounds(e,t,i){this.updateRoot(this.root.moved(e,t,i))}hitTest(e,t){const i=this.geoViewport.value;if(null===i)return null;const s=i.unproject(e,t),n=this.getStem(i.geoFrame);return this.hitTestTree(n,e,t,s)}hitTestTree(e,t,i,s){let n=null;if(null!==e.southWest&&e.southWest.geoFrame.contains(s)&&(n=this.hitTestTree(e.southWest,t,i,s)),null===n&&null!==e.northWest&&e.northWest.geoFrame.contains(s)&&(n=this.hitTestTree(e.northWest,t,i,s)),null===n&&null!==e.southEast&&e.southEast.geoFrame.contains(s)&&(n=this.hitTestTree(e.southEast,t,i,s)),null===n&&null!==e.northEast&&e.northEast.geoFrame.contains(s)&&(n=this.hitTestTree(e.northEast,t,i,s)),null===n){const s=e.views;for(let e=0;e<s.length;e+=1){if(n=s[e].cascadeHitTest(t,i),null!==n)break}}return n}},t=[r.ThemeAnimator({valueType:n.Color,value:null})],c(e,null,t,{kind:"getter",name:"geoTreeColor",static:!1,private:!1,access:{has:e=>"geoTreeColor"in e,get:e=>e.geoTreeColor}},null,i),e})(),S=(()=>{var e;let t,i,n,r,o,l,a,u,d,v=[],w=[],g=[],m=[],f=[],y=[],C=[];return e=class extends V{constructor(){super(...arguments),this.intersectsViewport=(p(this,v),p(this,w,void 0)),this.visible=p(this,g,void 0),this.consumable=p(this,m,void 0),this.geo=p(this,f,void 0),this.layers=p(this,y,void 0),this.features=p(this,C,void 0)}get nodeUri(){return s.Property.getter()}get visibleRange(){return s.Property.getter()}get consumeRange(){return s.Property.getter()}consumeLayers(){}unconsumeLayers(){}onStartConsuming(){super.onStartConsuming(),this.consumeLayers()}},t=[s.Property({extends:!0,inherits:!1})],i=[s.Property({inherits:!0,value:[0,1/0],didSetValue(e){this.owner.visible.decohere()},setMin(e,t){this.setValue([e,this.value[1]],t)},setMax(e,t){this.setValue([this.value[0],e],t)}})],n=[s.Property({inherits:!0,value:[0,1/0],didSetValue(e){this.owner.consumable.decohere()},setMin(e,t){this.setValue([e,this.value[1]],t)},setMax(e,t){this.setValue([this.value[0],e],t)}})],r=[s.Property({valueType:Boolean,value:!1,inletKeys:[],deriveValue(){let e,t;return!(!this.owner.mounted||null===(e=this.owner.geo.view)||null===(t=e.geoViewport.value))&&t.geoFrame.intersects(e.geoBounds)}})],o=[s.Property({valueType:Boolean,value:!1,inletKeys:["intersectsViewport"],deriveValue(e){let t,i;if(!this.owner.mounted||null===(t=this.owner.geo.view)||null===(i=t.geoViewport.value))return!1;const[s]=this.owner.visibleRange.value;return e&&i.zoom>=s},didSetValue(e){const t=this.owner.geo.view;null!==t&&t.setCulled(!e)}})],l=[s.Property({valueType:Boolean,value:!1,inletKeys:["intersectsViewport"],deriveValue(e){let t,i;if(!this.owner.mounted||null===(t=this.owner.geo.view)||null===(i=t.geoViewport.value))return!1;const[s,n]=this.owner.consumeRange.value;if(e&&i.zoom>=n){const e=this.owner.geo.trait;null!==e&&e.consumeLayers(),this.owner.consumeLayers()}else if(!e||i.zoom<s){const e=this.owner.geo.trait;null!==e&&e.unconsumeLayers(),this.owner.unconsumeLayers()}return e&&i.zoom>=s&&i.zoom<n},didSetValue(e){const t=this.owner.geo.view;null!==t&&(e?this.owner.consume(t):this.owner.unconsume(t))}})],a=[h.TraitViewRef({extends:!0,consumed:!0,traitType:b,observesTrait:!0,initTrait(e){super.initTrait(e),this.owner.layers.addTraits(e.layers.traits),this.owner.features.addTraits(e.features.traits)},deinitTrait(e){this.owner.features.deleteTraits(e.features.traits),this.owner.layers.deleteTraits(e.layers.traits),super.deinitTrait(e)},traitWillAttachLayer(e,t){this.owner.layers.addTrait(e,t)},traitDidDetachLayer(e){this.owner.layers.deleteTrait(e)},traitWillAttachFeature(e,t){this.owner.features.addTrait(e,t)},traitDidDetachFeature(e){this.owner.features.deleteTrait(e)},viewType:P,observesView:!0,initView(e){super.initView(e);const t=this.owner.layers.controllers;for(const i in t)t[i].geo.insertView(e);const i=this.owner.features.controllers;for(const t in i)i[t].geo.insertView(e)},deinitView(e){this.owner.unconsume(e),super.deinitView(e)},viewDidProject(e){this.owner.intersectsViewport.decohere(),this.owner.visible.decohere(),this.owner.consumable.decohere()}})],u=[h.TraitViewControllerSet({get controllerType(){return S},binds:!0,observes:!0,get parentView(){return this.owner.geo.attachView()},getTraitViewRef:e=>e.geo,willAttachController(e){this.owner.callObservers("controllerWillAttachLayer",e,this.owner)},didAttachController(e){const t=e.geo.trait;null!==t&&this.attachLayerTrait(t,e);const i=e.geo.attachView();this.attachLayerView(i,e)},willDetachController(e){const t=e.geo.view;null!==t&&this.detachLayerView(t,e);const i=e.geo.trait;null!==i&&this.detachLayerTrait(i,e)},didDetachController(e){this.owner.callObservers("controllerDidDetachLayer",e,this.owner)},controllerWillAttachGeoTrait(e,t){this.owner.callObservers("controllerWillAttachLayerTrait",e,t,this.owner),this.attachLayerTrait(e,t)},controllerDidDetachGeoTrait(e,t){this.detachLayerTrait(e,t),this.owner.callObservers("controllerDidDetachLayerTrait",e,t,this.owner)},attachLayerTrait(e,t){},detachLayerTrait(e,t){this.deleteController(t)},controllerWillAttachGeoView(e,t){this.owner.callObservers("controllerWillAttachLayerView",e,t,this.owner),this.attachLayerView(e,t)},controllerDidDetachGeoView(e,t){this.detachLayerView(e,t),this.owner.callObservers("controllerDidDetachLayerView",e,t,this.owner)},attachLayerView(e,t){const i=this.owner.geo.attachView();t.geo.insertView(i)},detachLayerView(e,t){e.remove()},createController(e){return void 0!==e?e.createGeoController():super.createController()}})],d=[h.TraitViewControllerSet({controllerType:k,binds:!0,observes:!0,get parentView(){return this.owner.geo.attachView()},getTraitViewRef:e=>e.geo,willAttachController(e){this.owner.callObservers("controllerWillAttachFeature",e,this.owner)},didAttachController(e){const t=e.geo.trait;null!==t&&this.attachFeatureTrait(t,e);const i=e.geo.attachView();this.attachFeatureView(i,e)},willDetachController(e){const t=e.geo.view;null!==t&&this.detachFeatureView(t,e);const i=e.geo.trait;null!==i&&this.detachFeatureTrait(i,e)},didDetachController(e){this.owner.callObservers("controllerDidDetachFeature",e,this.owner)},controllerWillAttachGeoTrait(e,t){this.owner.callObservers("controllerWillAttachFeatureTrait",e,t,this.owner),this.attachFeatureTrait(e,t)},controllerDidDetachGeoTrait(e,t){this.detachFeatureTrait(e,t),this.owner.callObservers("controllerDidDetachFeatureTrait",e,t,this.owner)},attachFeatureTrait(e,t){},detachFeatureTrait(e,t){this.deleteController(t)},controllerWillAttachGeoView(e,t){this.owner.callObservers("controllerWillAttachFeatureView",e,t,this.owner),this.attachFeatureView(e,t)},controllerDidDetachGeoView(e,t){this.detachFeatureView(e,t),this.owner.callObservers("controllerDidDetachFeatureView",e,t,this.owner)},attachFeatureView(e,t){const i=this.owner.geo.attachView();t.geo.insertView(i)},detachFeatureView(e,t){e.remove()},controllerDidSetGeoPerspective(e,t){this.owner.callObservers("controllerDidSetFeatureGeoPerspective",e,t,this.owner)},controllerDidEnterGeoView(e,t){this.owner.callObservers("controllerDidEnterFeatureView",e,t,this.owner)},controllerDidLeaveGeoView(e,t){this.owner.callObservers("controllerDidLeaveFeatureView",e,t,this.owner)},controllerDidPressGeoView(e,t,i,s){this.owner.callObservers("controllerDidPressFeatureView",e,t,i,s,this.owner)},controllerDidLongPressGeoView(e,t,i){this.owner.callObservers("controllerDidLongPressFeatureView",e,t,i,this.owner)},createController(e){return void 0!==e?e.createGeoController():super.createController()}})],c(e,null,t,{kind:"getter",name:"nodeUri",static:!1,private:!1,access:{has:e=>"nodeUri"in e,get:e=>e.nodeUri}},null,v),c(e,null,i,{kind:"getter",name:"visibleRange",static:!1,private:!1,access:{has:e=>"visibleRange"in e,get:e=>e.visibleRange}},null,v),c(e,null,n,{kind:"getter",name:"consumeRange",static:!1,private:!1,access:{has:e=>"consumeRange"in e,get:e=>e.consumeRange}},null,v),c(null,null,r,{kind:"field",name:"intersectsViewport",static:!1,private:!1,access:{has:e=>"intersectsViewport"in e,get:e=>e.intersectsViewport,set:(e,t)=>{e.intersectsViewport=t}}},w,v),c(null,null,o,{kind:"field",name:"visible",static:!1,private:!1,access:{has:e=>"visible"in e,get:e=>e.visible,set:(e,t)=>{e.visible=t}}},g,v),c(null,null,l,{kind:"field",name:"consumable",static:!1,private:!1,access:{has:e=>"consumable"in e,get:e=>e.consumable,set:(e,t)=>{e.consumable=t}}},m,v),c(null,null,a,{kind:"field",name:"geo",static:!1,private:!1,access:{has:e=>"geo"in e,get:e=>e.geo,set:(e,t)=>{e.geo=t}}},f,v),c(null,null,u,{kind:"field",name:"layers",static:!1,private:!1,access:{has:e=>"layers"in e,get:e=>e.layers,set:(e,t)=>{e.layers=t}}},y,v),c(null,null,d,{kind:"field",name:"features",static:!1,private:!1,access:{has:e=>"features"in e,get:e=>e.features,set:(e,t)=>{e.features=t}}},C,v),e})(),A=(()=>{var e;let t,n,a,h,d,v,w,g,m,y,V=[],T=[],x=[],k=[],b=[],R=[],P=[],S=[],A=[],G=[],M=[];return e=class extends f{constructor(){super(),this.geoAnchor=(p(this,V),p(this,T,void 0)),this.viewAnchor=p(this,x,void 0),this.xAlign=p(this,k,void 0),this.yAlign=p(this,b,void 0),this.width=p(this,R,void 0),this.height=p(this,P,void 0),this.opacity=p(this,S,void 0),this.compositeOperation=p(this,A,void 0),this.compositor=p(this,G,void 0),this.renderer=p(this,M,void 0),this.canvas=this.createCanvas(),this.ownRasterFrame=null,this.renderer.value=this.createRenderer()}get pixelRatio(){return window.devicePixelRatio||1}createRenderer(e="canvas"){if("canvas"===e){const e=this.canvas.getContext("2d");if(null===e)throw new Error("Failed to create canvas rendering context");return new l.CanvasRenderer(e,u.Transform.identity(),this.pixelRatio)}if("webgl"===e){const e=this.canvas.getContext("webgl");if(null===e)throw new Error("Failed to create webgl rendering context");return new l.WebGLRenderer(e,this.pixelRatio)}throw new Error("Failed to create "+e+" renderer")}needsUpdate(e,t){const i=(e=super.needsUpdate(e,t))&(o.View.NeedsRender|o.View.NeedsComposite);return 0!==i&&(e|=o.View.NeedsComposite,this.setFlags(this.flags|o.View.NeedsDisplay|o.View.NeedsComposite|i)),e}needsProcess(e){return 0==(this.flags&o.View.ProcessMask)&&0==(e&(o.View.NeedsResize|o.View.NeedsProject))&&(e=0),e}onResize(){super.onResize(),this.requireUpdate(o.View.NeedsRender|o.View.NeedsComposite)}onProject(){super.onProject(),this.projectRaster()}projectGeoAnchor(e){const t=this.geoViewport.value;if(!this.mounted||null===t)return;const i=null!==e&&e.isDefined()?t.project(e):null;this.viewAnchor.setInterpolatedValue(this.viewAnchor.value,i),this.projectRaster()}projectRaster(){const e=this.geoViewport.value;if(null===e)return;let t;if(this.viewAnchor.hasAffinity(s.Affinity.Intrinsic)){const i=this.geoAnchor.value;t=null!==i&&i.isDefined()?e.project(i):null,this.viewAnchor.setIntrinsic(t)}else t=this.viewAnchor.value;if(null===t)return void this.setCulled(!this.viewFrame.intersects(this.rasterFrame));const i=this.viewFrame,n=i.width,r=i.height,o=Math.min(n,r);let l=this.width.value;l=l instanceof u.Length?l.pxValue(o):n;let a=this.height.value;a=a instanceof u.Length?a.pxValue(o):r;const h=t.x-l*this.xAlign.getValue(),d=t.y-a*this.yAlign.getValue(),c=new u.R2Box(h,d,h+l,d+a);this.setRasterFrame(c),this.setViewFrame(c),this.setCulled(!i.intersects(c))}needsDisplay(e){return 0!=(this.flags&o.View.DisplayMask)?e|=o.View.NeedsComposite:e=0!=(e&o.View.NeedsComposite)?o.View.NeedsDisplay|o.View.NeedsComposite:0,e}onRender(){const e=this.rasterFrame;this.resizeCanvas(this.canvas,e),this.resetRenderer(e),this.clearCanvas(e),super.onRender()}didComposite(){this.compositeImage(),super.didComposite()}get rasterFrame(){let e=this.ownRasterFrame;return null===e&&(e=this.deriveRasterFrame()),e}setRasterFrame(e){this.ownRasterFrame=e}deriveRasterFrame(){return this.deriveViewBounds()}createCanvas(){return document.createElement("canvas")}resizeCanvas(e,t){const i=this.pixelRatio,s=t.width,n=t.height,r=s*i,o=n*i,l=e.width,a=e.height;r===l&&o===a||(e.width=r,e.height=o,e.style.width=s+"px",e.style.height=n+"px")}clearCanvas(e){const t=this.renderer.value;if(t instanceof l.CanvasRenderer)t.context.clearRect(0,0,e.xMax,e.yMax);else if(t instanceof l.WebGLRenderer){const e=t.context;e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}}resetRenderer(e){const t=this.renderer.value;if(t instanceof l.CanvasRenderer){const i=this.pixelRatio,s=e.xMin*i,n=e.yMin*i;t.context.setTransform(i,0,0,i,-s,-n),t.setTransform(u.Transform.affine(i,0,0,i,-s,-n))}else t instanceof l.WebGLRenderer&&t.context.viewport(e.x,e.y,e.xMax,e.yMax)}compositeImage(){const e=this.compositor.value;if(!(e instanceof l.CanvasRenderer))return;const t=this.rasterFrame,i=this.canvas;if(!t.isDefined()||0===t.width||0===t.height||0===i.width||0===i.height)return;const s=e.context,n=s.globalAlpha,r=s.globalCompositeOperation;s.globalAlpha=this.opacity.getValue(),s.globalCompositeOperation=this.compositeOperation.getValue(),s.drawImage(i,t.x,t.y,t.width,t.height),s.globalAlpha=n,s.globalCompositeOperation=r}ripple(e){return C.ripple(this,e)}},t=[s.Animator({valueType:i.GeoPoint,value:null,didSetState(e,t){this.owner.projectGeoAnchor(e)},didSetValue(e,t){this.owner.setGeoBounds(null!==e?e.bounds:i.GeoBox.undefined()),this.mounted&&this.owner.projectRaster(),this.owner.callObservers("viewDidSetGeoAnchor",e,this.owner)}})],n=[s.Animator({valueType:u.R2Point,value:u.R2Point.undefined()})],a=[s.Animator({valueType:Number,value:.5,updateFlags:o.View.NeedsComposite})],h=[s.Animator({valueType:Number,value:.5,updateFlags:o.View.NeedsComposite})],d=[r.ThemeAnimator({valueType:u.Length,value:null,updateFlags:o.View.NeedsResize|o.View.NeedsLayout|o.View.NeedsRender|o.View.NeedsComposite})],v=[r.ThemeAnimator({valueType:u.Length,value:null,updateFlags:o.View.NeedsResize|o.View.NeedsLayout|o.View.NeedsRender|o.View.NeedsComposite})],w=[r.ThemeAnimator({valueType:Number,value:1,updateFlags:o.View.NeedsComposite})],g=[s.Animator({valueType:String,value:"source-over",updateFlags:o.View.NeedsComposite})],m=[s.Property({valueType:l.GraphicsRenderer,value:null,inherits:"renderer"})],y=[s.Property({extends:!0,inherits:!1,updateFlags:o.View.NeedsRender|o.View.NeedsComposite,fromLike(e){return"string"==typeof e&&(e=this.owner.createRenderer(e)),e}})],c(null,null,t,{kind:"field",name:"geoAnchor",static:!1,private:!1,access:{has:e=>"geoAnchor"in e,get:e=>e.geoAnchor,set:(e,t)=>{e.geoAnchor=t}}},T,V),c(null,null,n,{kind:"field",name:"viewAnchor",static:!1,private:!1,access:{has:e=>"viewAnchor"in e,get:e=>e.viewAnchor,set:(e,t)=>{e.viewAnchor=t}}},x,V),c(null,null,a,{kind:"field",name:"xAlign",static:!1,private:!1,access:{has:e=>"xAlign"in e,get:e=>e.xAlign,set:(e,t)=>{e.xAlign=t}}},k,V),c(null,null,h,{kind:"field",name:"yAlign",static:!1,private:!1,access:{has:e=>"yAlign"in e,get:e=>e.yAlign,set:(e,t)=>{e.yAlign=t}}},b,V),c(null,null,d,{kind:"field",name:"width",static:!1,private:!1,access:{has:e=>"width"in e,get:e=>e.width,set:(e,t)=>{e.width=t}}},R,V),c(null,null,v,{kind:"field",name:"height",static:!1,private:!1,access:{has:e=>"height"in e,get:e=>e.height,set:(e,t)=>{e.height=t}}},P,V),c(null,null,w,{kind:"field",name:"opacity",static:!1,private:!1,access:{has:e=>"opacity"in e,get:e=>e.opacity,set:(e,t)=>{e.opacity=t}}},S,V),c(null,null,g,{kind:"field",name:"compositeOperation",static:!1,private:!1,access:{has:e=>"compositeOperation"in e,get:e=>e.compositeOperation,set:(e,t)=>{e.compositeOperation=t}}},A,V),c(null,null,m,{kind:"field",name:"compositor",static:!1,private:!1,access:{has:e=>"compositor"in e,get:e=>e.compositor,set:(e,t)=>{e.compositor=t}}},G,V),c(null,null,y,{kind:"field",name:"renderer",static:!1,private:!1,access:{has:e=>"renderer"in e,get:e=>e.renderer,set:(e,t)=>{e.renderer=t}}},M,V),e.MountFlags=f.MountFlags|o.View.NeedsComposite,e.UncullFlags=f.UncullFlags|o.View.NeedsComposite,e.UnhideFlags=f.UnhideFlags|o.View.NeedsComposite,e})();class G extends f{constructor(e){super(),this.geoTile=e,this.geoBounds=e.bounds}setGeoBounds(e){}updateGeoBounds(){}}let M=(()=>{var e;let t,i,s,n,r=[],o=[],l=[],h=[],u=[];return e=class extends b{constructor(e){super(),this.geoTile=void p(this,r),this.southWest=p(this,o,void 0),this.northWest=p(this,l,void 0),this.southEast=p(this,h,void 0),this.northEast=p(this,u,void 0),this.geoTile=e}createTileTrait(e){return new this.constructor(e)}consumeLayers(){this.southWest.insertModel(),this.northWest.insertModel(),this.southEast.insertModel(),this.northEast.insertModel()}unconsumeLayers(){this.southWest.deleteModel(),this.northWest.deleteModel(),this.southEast.deleteModel(),this.northEast.deleteModel()}createGeoController(){return new W(this.geoTile)}},t=[a.TraitModelRef({get traitType(){return M},traitKey:"layer",modelType:a.Model,modelKey:"southWest",binds:!0,createTrait(){return this.owner.createTileTrait(this.owner.geoTile.southWestTile)}})],i=[a.TraitModelRef({get traitType(){return M},traitKey:"layer",modelType:a.Model,modelKey:"northWest",binds:!0,createTrait(){return this.owner.createTileTrait(this.owner.geoTile.northWestTile)}})],s=[a.TraitModelRef({get traitType(){return M},traitKey:"layer",modelType:a.Model,modelKey:"southEast",binds:!0,createTrait(){return this.owner.createTileTrait(this.owner.geoTile.southEastTile)}})],n=[a.TraitModelRef({get traitType(){return M},traitKey:"layer",modelType:a.Model,modelKey:"northEast",binds:!0,createTrait(){return this.owner.createTileTrait(this.owner.geoTile.northEastTile)}})],c(null,null,t,{kind:"field",name:"southWest",static:!1,private:!1,access:{has:e=>"southWest"in e,get:e=>e.southWest,set:(e,t)=>{e.southWest=t}}},o,r),c(null,null,i,{kind:"field",name:"northWest",static:!1,private:!1,access:{has:e=>"northWest"in e,get:e=>e.northWest,set:(e,t)=>{e.northWest=t}}},l,r),c(null,null,s,{kind:"field",name:"southEast",static:!1,private:!1,access:{has:e=>"southEast"in e,get:e=>e.southEast,set:(e,t)=>{e.southEast=t}}},h,r),c(null,null,n,{kind:"field",name:"northEast",static:!1,private:!1,access:{has:e=>"northEast"in e,get:e=>e.northEast,set:(e,t)=>{e.northEast=t}}},u,r),e})(),W=(()=>{var e;let t,i,n,r,o,l,a,u,d=[],v=[],w=[],g=[],m=[],f=[],y=[];return e=class extends S{constructor(e){super(),this.geoTile=void p(this,d),this.geo=p(this,v,void 0),this.layers=p(this,w,void 0),this.southWest=p(this,g,void 0),this.northWest=p(this,m,void 0),this.southEast=p(this,f,void 0),this.northEast=p(this,y,void 0),this.geoTile=e,this.visibleRange.setIntrinsic([e.z,e.z+1]),this.consumeRange.setIntrinsic([e.z,e.z+1])}get visibleRange(){return s.Property.getter()}get consumeRange(){return s.Property.getter()}createTileController(e,t){return new this.constructor(e)}consumeLayers(){this.southWest.insertController(),this.northWest.insertController(),this.southEast.insertController(),this.northEast.insertController()}unconsumeLayers(){this.southWest.deleteController(),this.northWest.deleteController(),this.southEast.deleteController(),this.northEast.deleteController()}},t=[s.Property({extends:!0,inherits:!1})],i=[s.Property({extends:!0,inherits:!1})],n=[h.TraitViewRef({extends:!0,traitType:M,viewType:G,createView(){return new G(this.owner.geoTile)}})],r=[h.TraitViewControllerSet({extends:!0,createController(e){return e instanceof M?this.owner.createTileController(e.geoTile,e):super.createController()}})],o=[h.TraitViewControllerRef({get controllerType(){return W},controllerKey:!0,binds:!0,get parentView(){return this.owner.geo.attachView()},getTraitViewRef:e=>e.geo,createController(e){return this.owner.createTileController(this.owner.geoTile.southWestTile,e)}})],l=[h.TraitViewControllerRef({get controllerType(){return W},controllerKey:!0,binds:!0,get parentView(){return this.owner.geo.attachView()},getTraitViewRef:e=>e.geo,createController(e){return this.owner.createTileController(this.owner.geoTile.northWestTile,e)}})],a=[h.TraitViewControllerRef({get controllerType(){return W},controllerKey:!0,binds:!0,get parentView(){return this.owner.geo.attachView()},getTraitViewRef:e=>e.geo,createController(e){return this.owner.createTileController(this.owner.geoTile.southEastTile,e)}})],u=[h.TraitViewControllerRef({get controllerType(){return W},controllerKey:!0,binds:!0,get parentView(){return this.owner.geo.attachView()},getTraitViewRef:e=>e.geo,createController(e){return this.owner.createTileController(this.owner.geoTile.northEastTile,e)}})],c(e,null,t,{kind:"getter",name:"visibleRange",static:!1,private:!1,access:{has:e=>"visibleRange"in e,get:e=>e.visibleRange}},null,d),c(e,null,i,{kind:"getter",name:"consumeRange",static:!1,private:!1,access:{has:e=>"consumeRange"in e,get:e=>e.consumeRange}},null,d),c(null,null,n,{kind:"field",name:"geo",static:!1,private:!1,access:{has:e=>"geo"in e,get:e=>e.geo,set:(e,t)=>{e.geo=t}}},v,d),c(null,null,r,{kind:"field",name:"layers",static:!1,private:!1,access:{has:e=>"layers"in e,get:e=>e.layers,set:(e,t)=>{e.layers=t}}},w,d),c(null,null,o,{kind:"field",name:"southWest",static:!1,private:!1,access:{has:e=>"southWest"in e,get:e=>e.southWest,set:(e,t)=>{e.southWest=t}}},g,d),c(null,null,l,{kind:"field",name:"northWest",static:!1,private:!1,access:{has:e=>"northWest"in e,get:e=>e.northWest,set:(e,t)=>{e.northWest=t}}},m,d),c(null,null,a,{kind:"field",name:"southEast",static:!1,private:!1,access:{has:e=>"southEast"in e,get:e=>e.southEast,set:(e,t)=>{e.southEast=t}}},f,d),c(null,null,u,{kind:"field",name:"northEast",static:!1,private:!1,access:{has:e=>"northEast"in e,get:e=>e.northEast,set:(e,t)=>{e.northEast=t}}},y,d),e})(),D=(()=>{var e;let t,a,h,d,v,w,g,m,f,y,V=[],C=[],x=[],k=[],b=[],R=[],P=[],S=[],A=[],G=[],M=[];return e=class extends T{constructor(){super(),this.geoShape=(p(this,V),p(this,C,void 0)),this.viewShape=p(this,x,void 0),this.geoCentroid=p(this,k,void 0),this.viewCentroid=p(this,b,void 0),this.fill=p(this,R,void 0),this.fillOpacity=p(this,P,void 0),this.stroke=p(this,S,void 0),this.strokeOpacity=p(this,A,void 0),this.strokeWidth=p(this,G,void 0),this.strokeHitWidth=p(this,M,void 0),Object.defineProperty(this,"viewBounds",{value:u.R2Box.undefined(),writable:!0,enumerable:!0,configurable:!0})}onProject(){super.onProject(),this.projectShape()}projectShape(){const e=this.geoViewport.value;if(null===e)return;let t;if(this.viewShape.hasAffinity(s.Affinity.Intrinsic)){const i=this.geoShape.value;t=null!==i&&i.isDefined()?i.project(e):null,this.viewShape.setIntrinsic(t)}else t=this.viewShape.value;if(this.viewCentroid.hasAffinity(s.Affinity.Intrinsic)){const t=this.geoCentroid.value,i=null!==t&&t.isDefined()?e.project(t):null;this.viewCentroid.setIntrinsic(i)}this.viewBounds=null!==t?t.bounds:this.viewFrame}onRender(){super.onRender();const e=this.renderer.value;if(e instanceof l.PaintingRenderer&&!this.hidden&&!this.culled){const t=this.viewShape.value;null!==t&&t.isDefined()&&this.renderShape(t,e.context,this.viewFrame)}}renderShape(e,t,i){e instanceof u.R2Group?this.renderGroup(e,t,i):e instanceof u.R2Path?this.renderPath(e,t,i):e instanceof u.R2Spline?this.renderPath(u.R2Path.of(e),t,i):e instanceof u.R2Curve&&this.renderPath(u.R2Path.open(e),t,i)}renderGroup(e,t,i){const s=e.shapes;for(let e=0;e<s.length;e+=1){const n=s[e];n.isDefined()&&this.renderShape(n,t,i)}}renderPath(e,t,i){const s=t.fillStyle,n=t.lineWidth,r=t.strokeStyle;t.beginPath(),e.draw(t);let o=this.fill.value;if(null!==o){const e=this.fillOpacity.value;void 0!==e&&(o=o.alpha(e)),t.fillStyle=o.toString(),t.fill()}let l=this.stroke.value;const a=this.strokeWidth.value;if(null!==l&&null!==a){const e=this.strokeOpacity.value;void 0!==e&&(l=l.alpha(e));const s=Math.min(i.width,i.height);t.lineWidth=a.pxValue(s),t.strokeStyle=l.toString(),t.stroke()}t.fillStyle=s,t.lineWidth=n,t.strokeStyle=r}hitTest(e,t){const i=this.renderer.value;if(i instanceof l.CanvasRenderer){const s=this.viewShape.value;if(null!==s&&s.isDefined()){const n=i.transform.transform(e,t);return this.hitTestShape(n.x,n.y,s,i.context,this.viewFrame)}}return null}hitTestShape(e,t,i,s,n){return i instanceof u.R2Group?this.hitTestGroup(e,t,i,s,n):i instanceof u.R2Path?this.hitTestPath(e,t,i,s,n):i instanceof u.R2Spline?this.hitTestPath(e,t,u.R2Path.of(i),s,n):i instanceof u.R2Curve?this.hitTestPath(e,t,u.R2Path.open(i),s,n):null}hitTestGroup(e,t,i,s,n){const r=i.shapes;for(let i=0;i<r.length;i+=1){const o=r[i];if(o.isDefined()){const i=this.hitTestShape(e,t,o,s,n);if(null!==i)return i}}return null}hitTestPath(e,t,i,s,n){if(s.beginPath(),i.draw(s),null!==this.fill.value&&s.isPointInPath(e,t))return this;const r=s.lineWidth;let o=!1;const l=this.strokeWidth.value;if(null!==this.stroke.value&&null!==l){const i=Math.min(n.width,n.height),r=Math.max(this.strokeHitWidth.getValueOr(0),l.pxValue(i));0!==r&&(s.lineWidth=r,o=s.isPointInStroke(e,t))}return s.lineWidth=r,o?this:null}updateGeoBounds(){}get popoverFrame(){const e=this.pageTransform.inverse(),t=this.viewCentroid.value;if(null===t||!t.isDefined())return this.viewBounds.transform(e);const i=e.transformX(t.x,t.y),s=e.transformY(t.x,t.y);return new u.R2Box(i,s,i,s)}},t=[s.Animator({valueType:i.GeoShape,value:null,didSetValue(e){null!==e?(this.owner.setGeoBounds(e.bounds),this.owner.geoCentroid.setIntrinsic(e.bounds.center)):(this.owner.setGeoBounds(i.GeoBox.undefined()),this.owner.geoCentroid.setIntrinsic(null)),this.mounted&&this.owner.projectShape(),this.owner.callObservers("viewDidSetGeoShape",e,this.owner)}})],a=[s.Animator({valueType:u.R2Shape,value:null})],h=[s.Animator({valueType:i.GeoPoint,value:null})],d=[s.Animator({valueType:u.R2Point,value:null})],v=[r.ThemeAnimator({valueType:n.Color,value:null,updateFlags:o.View.NeedsRender})],w=[r.ThemeAnimator({valueType:Number,updateFlags:o.View.NeedsRender})],g=[r.ThemeAnimator({valueType:n.Color,value:null,updateFlags:o.View.NeedsRender})],m=[r.ThemeAnimator({valueType:Number,updateFlags:o.View.NeedsRender})],f=[r.ThemeAnimator({valueType:u.Length,value:null,updateFlags:o.View.NeedsRender})],y=[s.Property({valueType:Number})],c(null,null,t,{kind:"field",name:"geoShape",static:!1,private:!1,access:{has:e=>"geoShape"in e,get:e=>e.geoShape,set:(e,t)=>{e.geoShape=t}}},C,V),c(null,null,a,{kind:"field",name:"viewShape",static:!1,private:!1,access:{has:e=>"viewShape"in e,get:e=>e.viewShape,set:(e,t)=>{e.viewShape=t}}},x,V),c(null,null,h,{kind:"field",name:"geoCentroid",static:!1,private:!1,access:{has:e=>"geoCentroid"in e,get:e=>e.geoCentroid,set:(e,t)=>{e.geoCentroid=t}}},k,V),c(null,null,d,{kind:"field",name:"viewCentroid",static:!1,private:!1,access:{has:e=>"viewCentroid"in e,get:e=>e.viewCentroid,set:(e,t)=>{e.viewCentroid=t}}},b,V),c(null,null,v,{kind:"field",name:"fill",static:!1,private:!1,access:{has:e=>"fill"in e,get:e=>e.fill,set:(e,t)=>{e.fill=t}}},R,V),c(null,null,w,{kind:"field",name:"fillOpacity",static:!1,private:!1,access:{has:e=>"fillOpacity"in e,get:e=>e.fillOpacity,set:(e,t)=>{e.fillOpacity=t}}},P,V),c(null,null,g,{kind:"field",name:"stroke",static:!1,private:!1,access:{has:e=>"stroke"in e,get:e=>e.stroke,set:(e,t)=>{e.stroke=t}}},S,V),c(null,null,m,{kind:"field",name:"strokeOpacity",static:!1,private:!1,access:{has:e=>"strokeOpacity"in e,get:e=>e.strokeOpacity,set:(e,t)=>{e.strokeOpacity=t}}},A,V),c(null,null,f,{kind:"field",name:"strokeWidth",static:!1,private:!1,access:{has:e=>"strokeWidth"in e,get:e=>e.strokeWidth,set:(e,t)=>{e.strokeWidth=t}}},G,V),c(null,null,y,{kind:"field",name:"strokeHitWidth",static:!1,private:!1,access:{has:e=>"strokeHitWidth"in e,get:e=>e.strokeHitWidth,set:(e,t)=>{e.strokeHitWidth=t}}},M,V),e})(),F=(()=>{var e;let t,n,o,l,a,h,d=[],v=[],w=[],g=[],m=[],f=[],y=[];return e=class extends x{constructor(){super(...arguments),this.geoShape=(p(this,d),p(this,v,void 0)),this.fill=p(this,w,void 0),this.fillOpacity=p(this,g,void 0),this.stroke=p(this,m,void 0),this.strokeOpacity=p(this,f,void 0),this.strokeWidth=p(this,y,void 0)}createGeoController(){return new B}},t=[s.Property({valueType:i.GeoShape,value:null,didSetValue(e){this.owner.callObservers("traitDidSetGeoShape",e,this.owner),this.owner.geoPerspective.setIntrinsic(e)}})],n=[s.Property({valueType:r.ColorLook,value:null})],o=[s.Property({valueType:r.NumberLook})],l=[s.Property({valueType:r.ColorLook,value:null})],a=[s.Property({valueType:r.NumberLook})],h=[s.Property({valueType:u.Length,value:null})],c(null,null,t,{kind:"field",name:"geoShape",static:!1,private:!1,access:{has:e=>"geoShape"in e,get:e=>e.geoShape,set:(e,t)=>{e.geoShape=t}}},v,d),c(null,null,n,{kind:"field",name:"fill",static:!1,private:!1,access:{has:e=>"fill"in e,get:e=>e.fill,set:(e,t)=>{e.fill=t}}},w,d),c(null,null,o,{kind:"field",name:"fillOpacity",static:!1,private:!1,access:{has:e=>"fillOpacity"in e,get:e=>e.fillOpacity,set:(e,t)=>{e.fillOpacity=t}}},g,d),c(null,null,l,{kind:"field",name:"stroke",static:!1,private:!1,access:{has:e=>"stroke"in e,get:e=>e.stroke,set:(e,t)=>{e.stroke=t}}},m,d),c(null,null,a,{kind:"field",name:"strokeOpacity",static:!1,private:!1,access:{has:e=>"strokeOpacity"in e,get:e=>e.strokeOpacity,set:(e,t)=>{e.strokeOpacity=t}}},f,d),c(null,null,h,{kind:"field",name:"strokeWidth",static:!1,private:!1,access:{has:e=>"strokeWidth"in e,get:e=>e.strokeWidth,set:(e,t)=>{e.strokeWidth=t}}},y,d),e})(),B=(()=>{var e;let t,n,o,l,a,d,v,w=[],g=[],m=[],f=[],y=[],V=[],C=[],T=[];return e=class extends k{constructor(){super(...arguments),this.geo=(p(this,w),p(this,g,void 0)),this.geoShape=p(this,m,void 0),this.fill=p(this,f,void 0),this.fillOpacity=p(this,y,void 0),this.stroke=p(this,V,void 0),this.strokeOpacity=p(this,C,void 0),this.strokeWidth=p(this,T,void 0)}},t=[h.TraitViewRef({extends:!0,traitType:F,initTrait(e){super.initTrait(e),this.owner.geoShape.bindInlet(e.geoShape),this.owner.fill.bindInlet(e.fill),this.owner.fillOpacity.bindInlet(e.fillOpacity),this.owner.stroke.bindInlet(e.stroke),this.owner.strokeOpacity.bindInlet(e.strokeOpacity),this.owner.strokeWidth.bindInlet(e.strokeWidth)},deinitTrait(e){this.owner.geoShape.unbindInlet(e.geoShape),this.owner.fill.unbindInlet(e.fill),this.owner.fillOpacity.unbindInlet(e.fillOpacity),this.owner.stroke.unbindInlet(e.stroke),this.owner.strokeOpacity.unbindInlet(e.strokeOpacity),this.owner.strokeWidth.unbindInlet(e.strokeWidth),super.deinitTrait(e)},viewType:D,initView(e){super.initView(e),e.geoShape.bindInlet(this.owner.geoShape),e.fill.bindInlet(this.owner.fill),e.fillOpacity.bindInlet(this.owner.fillOpacity),e.stroke.bindInlet(this.owner.stroke),e.strokeOpacity.bindInlet(this.owner.strokeOpacity),e.strokeWidth.bindInlet(this.owner.strokeWidth)},deinitView(e){e.geoShape.unbindInlet(this.owner.geoShape),e.fill.unbindInlet(this.owner.fill),e.fillOpacity.unbindInlet(this.owner.fillOpacity),e.stroke.unbindInlet(this.owner.stroke),e.strokeOpacity.unbindInlet(this.owner.strokeOpacity),e.strokeWidth.unbindInlet(this.owner.strokeWidth),super.deinitView(e)}})],n=[s.Property({valueType:i.GeoShape,value:null,didSetValue(e){this.owner.callObservers("controllerDidSetGeoShape",e,this.owner),this.owner.geoPerspective.setIntrinsic(e)}})],o=[s.Property({valueType:r.ColorLook,value:null,transition:!0})],l=[s.Property({valueType:r.NumberLook,transition:!0})],a=[s.Property({valueType:r.ColorLook,value:null,transition:!0})],d=[s.Property({valueType:r.NumberLook,transition:!0})],v=[s.Property({valueType:u.Length,value:null,transition:!0})],c(null,null,t,{kind:"field",name:"geo",static:!1,private:!1,access:{has:e=>"geo"in e,get:e=>e.geo,set:(e,t)=>{e.geo=t}}},g,w),c(null,null,n,{kind:"field",name:"geoShape",static:!1,private:!1,access:{has:e=>"geoShape"in e,get:e=>e.geoShape,set:(e,t)=>{e.geoShape=t}}},m,w),c(null,null,o,{kind:"field",name:"fill",static:!1,private:!1,access:{has:e=>"fill"in e,get:e=>e.fill,set:(e,t)=>{e.fill=t}}},f,w),c(null,null,l,{kind:"field",name:"fillOpacity",static:!1,private:!1,access:{has:e=>"fillOpacity"in e,get:e=>e.fillOpacity,set:(e,t)=>{e.fillOpacity=t}}},y,w),c(null,null,a,{kind:"field",name:"stroke",static:!1,private:!1,access:{has:e=>"stroke"in e,get:e=>e.stroke,set:(e,t)=>{e.stroke=t}}},V,w),c(null,null,d,{kind:"field",name:"strokeOpacity",static:!1,private:!1,access:{has:e=>"strokeOpacity"in e,get:e=>e.strokeOpacity,set:(e,t)=>{e.strokeOpacity=t}}},C,w),c(null,null,v,{kind:"field",name:"strokeWidth",static:!1,private:!1,access:{has:e=>"strokeWidth"in e,get:e=>e.strokeWidth,set:(e,t)=>{e.strokeWidth=t}}},T,w),e})(),O=(()=>{var e;let t,a,h,d,v,w,g,m=[],y=[],V=[],T=[],x=[],k=[],b=[],R=[];return e=class extends f{constructor(){super(),this.geoCenter=(p(this,m),p(this,y,void 0)),this.viewCenter=p(this,V,void 0),this.radius=p(this,T,void 0),this.fill=p(this,x,void 0),this.stroke=p(this,k,void 0),this.strokeWidth=p(this,b,void 0),this.hitRadius=p(this,R,void 0),Object.defineProperty(this,"viewBounds",{value:u.R2Box.undefined(),writable:!0,enumerable:!0,configurable:!0})}onProject(){super.onProject(),this.projectCircle()}projectGeoCenter(e){const t=this.geoViewport.value;if(!this.mounted||null===t)return;const i=null!==e&&e.isDefined()?t.project(e):null;this.viewCenter.setInterpolatedValue(this.viewCenter.value,i),this.projectCircle()}projectCircle(){const e=this.geoViewport.value;if(null===e)return;if(s.Affinity.Intrinsic>=(this.viewCenter.flags&s.Affinity.Mask)){const t=this.geoCenter.value,i=null!==t&&t.isDefined()?e.project(t):null;this.viewCenter.value=i}const t=this.viewFrame,i=Math.min(t.width,t.height),n=this.radius.getValue().pxValue(i),r=this.viewCenter.value,o=this.viewCenter.state;null!==r&&null!==o&&(t.intersectsCircle(new u.R2Circle(r.x,r.y,n))||t.intersectsSegment(new u.R2Segment(r.x,r.y,o.x,o.y)))?this.setCulled(!1):this.setCulled(!0)}onRender(){super.onRender();const e=this.renderer.value;e instanceof l.PaintingRenderer&&!this.hidden&&!this.culled&&this.renderCircle(e.context,this.viewFrame)}renderCircle(e,t){const i=this.viewCenter.value;if(null===i||!i.isDefined())return;const s=e.fillStyle,n=e.lineWidth,r=e.strokeStyle,o=Math.min(t.width,t.height),l=this.radius.getValue().pxValue(o);e.beginPath(),e.arc(i.x,i.y,l,0,2*Math.PI);const a=this.fill.value;null!==a&&(e.fillStyle=a.toString(),e.fill());const h=this.stroke.value;if(null!==h){const t=this.strokeWidth.value;null!==t&&(e.lineWidth=t.pxValue(o)),e.strokeStyle=h.toString(),e.stroke()}e.fillStyle=s,e.lineWidth=n,e.strokeStyle=r}renderGeoBounds(e,t){}updateGeoBounds(){}deriveViewBounds(){const e=this.viewCenter.value;if(null===e||!e.isDefined())return u.R2Box.undefined();const t=this.viewFrame,i=Math.min(t.width,t.height),s=this.radius.getValue().pxValue(i);return new u.R2Box(e.x-s,e.y-s,e.x+s,e.y+s)}get popoverFrame(){const e=this.viewCenter.value;if(null===e||!e.isDefined())return this.pageBounds;const t=this.viewFrame,i=Math.min(t.width,t.height),s=this.pageTransform.inverse(),n=s.transformX(e.x,e.y),r=s.transformY(e.x,e.y),o=this.radius.getValue().pxValue(i);return new u.R2Box(n-o,r-o,n+o,r+o)}get hitBounds(){const e=this.viewCenter.value;if(null===e||!e.isDefined())return this.viewBounds;const t=this.viewFrame,i=Math.min(t.width,t.height),s=this.radius.getValue().pxValue(i),n=Math.max(this.hitRadius.getValueOr(s),s);return new u.R2Box(e.x-n,e.y-n,e.x+n,e.y+n)}hitTest(e,t){const i=this.renderer.value;return i instanceof l.CanvasRenderer?this.hitTestCircle(e,t,i.context,this.viewFrame,i.transform):null}hitTestCircle(e,t,i,s,n){const r=this.viewCenter.value;if(null===r||!r.isDefined())return null;const o=Math.min(s.width,s.height),l=this.radius.getValue().pxValue(o);if(null!==this.fill.value){const i=Math.max(this.hitRadius.getValueOr(l),l),s=r.x-e,n=r.y-t;if(s*s+n*n<i*i)return this}let a;if(null===this.stroke.value||null===(a=this.strokeWidth.value))return null;const h=i.lineWidth,u=n.transform(e,t);i.beginPath(),i.arc(r.x,r.y,l,0,2*Math.PI),i.lineWidth=a.pxValue(o);const d=i.isPointInStroke(u.x,u.y);return i.lineWidth=h,d?this:null}ripple(e){return C.ripple(this,e)}},t=[s.Animator({valueType:i.GeoPoint,value:null,didSetState(e,t){this.owner.projectGeoCenter(e)},didSetValue(e,t){this.owner.setGeoBounds(null!==e?e.bounds:i.GeoBox.undefined()),this.mounted&&this.owner.projectCircle(),this.owner.callObservers("viewDidSetGeoCenter",e,this.owner)}})],a=[s.Animator({valueType:u.R2Point,value:u.R2Point.undefined(),updateFlags:o.View.NeedsRender})],h=[r.ThemeAnimator({valueType:u.Length,value:u.Length.zero(),updateFlags:o.View.NeedsRender})],d=[r.ThemeAnimator({valueType:n.Color,value:null,inherits:!0,updateFlags:o.View.NeedsRender})],v=[r.ThemeAnimator({valueType:n.Color,value:null,inherits:!0,updateFlags:o.View.NeedsRender})],w=[r.ThemeAnimator({valueType:u.Length,value:null,inherits:!0,updateFlags:o.View.NeedsRender})],g=[s.Property({valueType:Number})],c(null,null,t,{kind:"field",name:"geoCenter",static:!1,private:!1,access:{has:e=>"geoCenter"in e,get:e=>e.geoCenter,set:(e,t)=>{e.geoCenter=t}}},y,m),c(null,null,a,{kind:"field",name:"viewCenter",static:!1,private:!1,access:{has:e=>"viewCenter"in e,get:e=>e.viewCenter,set:(e,t)=>{e.viewCenter=t}}},V,m),c(null,null,h,{kind:"field",name:"radius",static:!1,private:!1,access:{has:e=>"radius"in e,get:e=>e.radius,set:(e,t)=>{e.radius=t}}},T,m),c(null,null,d,{kind:"field",name:"fill",static:!1,private:!1,access:{has:e=>"fill"in e,get:e=>e.fill,set:(e,t)=>{e.fill=t}}},x,m),c(null,null,v,{kind:"field",name:"stroke",static:!1,private:!1,access:{has:e=>"stroke"in e,get:e=>e.stroke,set:(e,t)=>{e.stroke=t}}},k,m),c(null,null,w,{kind:"field",name:"strokeWidth",static:!1,private:!1,access:{has:e=>"strokeWidth"in e,get:e=>e.strokeWidth,set:(e,t)=>{e.strokeWidth=t}}},b,m),c(null,null,g,{kind:"field",name:"hitRadius",static:!1,private:!1,access:{has:e=>"hitRadius"in e,get:e=>e.hitRadius,set:(e,t)=>{e.hitRadius=t}}},R,m),e})(),E=(()=>{var e;let t,a,h,d,v,w,g,m,y,V,T,x,k=[],b=[],R=[],P=[],S=[],A=[],G=[],M=[],W=[],L=[],D=[],F=[],B=[];return e=class extends f{constructor(){super(),this.geoCenter=(p(this,k),p(this,b,void 0)),this.viewCenter=p(this,R,void 0),this.innerRadius=p(this,P,void 0),this.outerRadius=p(this,S,void 0),this.startAngle=p(this,A,void 0),this.sweepAngle=p(this,G,void 0),this.padAngle=p(this,M,void 0),this.padRadius=p(this,W,void 0),this.cornerRadius=p(this,L,void 0),this.fill=p(this,D,void 0),this.stroke=p(this,F,void 0),this.strokeWidth=p(this,B,void 0),Object.defineProperty(this,"viewBounds",{value:u.R2Box.undefined(),writable:!0,enumerable:!0,configurable:!0})}get value(){const e=this.viewCenter.value;return null!==e&&e.isDefined()?new l.Arc(e,this.innerRadius.value,this.outerRadius.value,this.startAngle.value,this.sweepAngle.value,this.padAngle.value,this.padRadius.value,this.cornerRadius.value):null}get state(){const e=this.viewCenter.state;return null!==e&&e.isDefined()?new l.Arc(e,this.innerRadius.state,this.outerRadius.state,this.startAngle.state,this.sweepAngle.state,this.padAngle.state,this.padRadius.state,this.cornerRadius.state):null}onProject(){super.onProject(),this.projectArc()}projectGeoCenter(e){const t=this.geoViewport.value;if(!this.mounted||null===t)return;const i=null!==e&&e.isDefined()?t.project(e):null;this.viewCenter.setInterpolatedValue(this.viewCenter.value,i),this.projectArc()}projectArc(){const e=this.geoViewport.value;if(null===e)return;if(s.Affinity.Intrinsic>=(this.viewCenter.flags&s.Affinity.Mask)){const t=this.geoCenter.value,i=null!==t&&t.isDefined()?e.project(t):null;this.viewCenter.value=i}const t=this.viewFrame,i=Math.min(t.width,t.height),n=this.outerRadius.getValue().pxValue(i),r=this.viewCenter.value,o=this.viewCenter.state;null!==r&&null!==o&&(t.intersectsCircle(new u.R2Circle(r.x,r.y,n))||t.intersectsSegment(new u.R2Segment(r.x,r.y,o.x,o.y)))?this.setCulled(!1):this.setCulled(!0)}onRender(){super.onRender();const e=this.renderer.value;e instanceof l.PaintingRenderer&&!this.hidden&&!this.culled&&this.renderArc(e.context,this.viewFrame)}renderArc(e,t){const i=this.value;if(null===i||!t.isDefined())return;const s=e.fillStyle,n=e.lineWidth,r=e.strokeStyle;e.beginPath(),i.draw(e,t);const o=this.fill.value;null!==o&&(e.fillStyle=o.toString(),e.fill());const l=this.stroke.value;if(null!==l){const i=this.strokeWidth.value;if(null!==i){const s=Math.min(t.width,t.height);e.lineWidth=i.pxValue(s)}e.strokeStyle=l.toString(),e.stroke()}e.fillStyle=s,e.lineWidth=n,e.strokeStyle=r}renderGeoBounds(e,t){}updateGeoBounds(){}deriveViewBounds(){const e=this.viewCenter.value;if(null===e||!e.isDefined())return u.R2Box.undefined();const t=this.viewFrame,i=Math.min(t.width,t.height),s=this.outerRadius.getValue().pxValue(i);return new u.R2Box(e.x-s,e.y-s,e.x+s,e.y+s)}get popoverFrame(){const e=this.viewCenter.value;if(null===e||!e.isDefined())return this.pageBounds;const t=this.viewFrame,i=Math.min(t.width,t.height),s=this.pageTransform.inverse(),n=s.transformX(e.x,e.y),r=s.transformY(e.x,e.y),o=(this.innerRadius.getValue().pxValue(i)+this.outerRadius.getValue().pxValue(i))/2,l=this.startAngle.getValue().radValue()+this.sweepAngle.getValue().radValue()/2,a=n+o*Math.cos(l),h=r+o*Math.sin(l);return new u.R2Box(a,h,a,h)}hitTest(e,t){const i=this.renderer.value;if(i instanceof l.CanvasRenderer){const s=i.transform.transform(e,t);return this.hitTestArc(s.x,s.y,i.context,this.viewFrame)}return null}hitTestArc(e,t,i,s){const n=this.value;if(null===n)return null;if(i.beginPath(),n.draw(i,s),null!==this.fill.value&&i.isPointInPath(e,t))return this;let r;if(null===this.stroke.value||null===(r=this.strokeWidth.value))return null;const o=i.lineWidth,l=Math.min(s.width,s.height);i.lineWidth=r.pxValue(l);const a=i.isPointInStroke(e,t);return i.lineWidth=o,a?this:null}ripple(e){return C.ripple(this,e)}},t=[s.Animator({valueType:i.GeoPoint,value:null,didSetState(e,t){this.owner.projectGeoCenter(e)},didSetValue(e,t){this.owner.setGeoBounds(null!==e?e.bounds:i.GeoBox.undefined()),this.mounted&&this.owner.projectArc(),this.owner.callObservers("viewDidSetGeoCenter",e,this.owner)}})],a=[s.Animator({valueType:u.R2Point,value:u.R2Point.undefined(),updateFlags:o.View.NeedsRender})],h=[r.ThemeAnimator({valueType:u.Length,value:u.Length.zero(),updateFlags:o.View.NeedsRender})],d=[r.ThemeAnimator({valueType:u.Length,value:u.Length.zero(),updateFlags:o.View.NeedsRender})],v=[r.ThemeAnimator({valueType:u.Angle,value:u.Angle.zero(),updateFlags:o.View.NeedsRender})],w=[r.ThemeAnimator({valueType:u.Angle,value:u.Angle.zero(),updateFlags:o.View.NeedsRender})],g=[r.ThemeAnimator({valueType:u.Angle,value:u.Angle.zero(),updateFlags:o.View.NeedsRender})],m=[r.ThemeAnimator({valueType:u.Length,value:null,updateFlags:o.View.NeedsRender})],y=[r.ThemeAnimator({valueType:u.Length,value:u.Length.zero(),updateFlags:o.View.NeedsRender})],V=[r.ThemeAnimator({valueType:n.Color,value:null,inherits:!0,updateFlags:o.View.NeedsRender})],T=[r.ThemeAnimator({valueType:n.Color,value:null,inherits:!0,updateFlags:o.View.NeedsRender})],x=[r.ThemeAnimator({valueType:u.Length,value:null,inherits:!0,updateFlags:o.View.NeedsRender})],c(null,null,t,{kind:"field",name:"geoCenter",static:!1,private:!1,access:{has:e=>"geoCenter"in e,get:e=>e.geoCenter,set:(e,t)=>{e.geoCenter=t}}},b,k),c(null,null,a,{kind:"field",name:"viewCenter",static:!1,private:!1,access:{has:e=>"viewCenter"in e,get:e=>e.viewCenter,set:(e,t)=>{e.viewCenter=t}}},R,k),c(null,null,h,{kind:"field",name:"innerRadius",static:!1,private:!1,access:{has:e=>"innerRadius"in e,get:e=>e.innerRadius,set:(e,t)=>{e.innerRadius=t}}},P,k),c(null,null,d,{kind:"field",name:"outerRadius",static:!1,private:!1,access:{has:e=>"outerRadius"in e,get:e=>e.outerRadius,set:(e,t)=>{e.outerRadius=t}}},S,k),c(null,null,v,{kind:"field",name:"startAngle",static:!1,private:!1,access:{has:e=>"startAngle"in e,get:e=>e.startAngle,set:(e,t)=>{e.startAngle=t}}},A,k),c(null,null,w,{kind:"field",name:"sweepAngle",static:!1,private:!1,access:{has:e=>"sweepAngle"in e,get:e=>e.sweepAngle,set:(e,t)=>{e.sweepAngle=t}}},G,k),c(null,null,g,{kind:"field",name:"padAngle",static:!1,private:!1,access:{has:e=>"padAngle"in e,get:e=>e.padAngle,set:(e,t)=>{e.padAngle=t}}},M,k),c(null,null,m,{kind:"field",name:"padRadius",static:!1,private:!1,access:{has:e=>"padRadius"in e,get:e=>e.padRadius,set:(e,t)=>{e.padRadius=t}}},W,k),c(null,null,y,{kind:"field",name:"cornerRadius",static:!1,private:!1,access:{has:e=>"cornerRadius"in e,get:e=>e.cornerRadius,set:(e,t)=>{e.cornerRadius=t}}},L,k),c(null,null,V,{kind:"field",name:"fill",static:!1,private:!1,access:{has:e=>"fill"in e,get:e=>e.fill,set:(e,t)=>{e.fill=t}}},D,k),c(null,null,T,{kind:"field",name:"stroke",static:!1,private:!1,access:{has:e=>"stroke"in e,get:e=>e.stroke,set:(e,t)=>{e.stroke=t}}},F,k),c(null,null,x,{kind:"field",name:"strokeWidth",static:!1,private:!1,access:{has:e=>"strokeWidth"in e,get:e=>e.strokeWidth,set:(e,t)=>{e.strokeWidth=t}}},B,k),e})(),I=(()=>{var e;let t,a,h,d,v,w,g,m,y,V,T,x=[],k=[],b=[],R=[],P=[],S=[],A=[],G=[],M=[],W=[],L=[],D=[];return e=class extends f{constructor(){super(...arguments),this.geoPoint=(p(this,x),p(this,k,void 0)),this.viewPoint=p(this,b,void 0),this.radius=p(this,R,void 0),this.color=p(this,P,void 0),this.opacity=p(this,S,void 0),this.labelPadding=p(this,A,void 0),this.font=p(this,G,void 0),this.textColor=p(this,M,void 0),this.hitRadius=p(this,W,void 0),this.label=p(this,L,void 0),this.labelPlacement=p(this,D,void 0)}isGradientStop(){return null!==this.color.value||void 0!==this.opacity.value}needsProcess(e){return 0!=(e&o.View.NeedsProject)&&null!==this.label.view&&this.requireUpdate(o.View.NeedsLayout),e}onProject(){super.onProject();const e=this.geoViewport.value;if(null!==e&&this.viewPoint.hasAffinity(s.Affinity.Intrinsic)){const t=e.project(this.geoPoint.getValue());this.viewPoint.setInterpolatedValue(t,t)}}onLayout(){super.onLayout();const e=this.label.view;null!==e&&this.layoutLabel(e,this.viewFrame)}layoutLabel(e,t){const i=this.labelPlacement.value,s=Math.min(t.width,t.height),n=this.labelPadding.getValue().pxValue(s),{x:r,y:o}=this.viewPoint.getValue();let a=o;"top"===i?a-=n:"bottom"===i&&(a+=n),l.TypesetView[Symbol.hasInstance](e)&&e.setIntrinsic({textAlign:"center",textBaseline:"bottom",textOrigin:new u.R2Point(r,a)})}updateGeoBounds(){}get hitBounds(){const{x:e,y:t}=this.viewPoint.getValue(),i=this.hitRadius.getValueOr(0);return new u.R2Box(e-i,t-i,e+i,t+i)}hitTest(e,t){const i=this.renderer.value;return i instanceof l.CanvasRenderer?this.hitTestPoint(e,t,i.context,this.viewFrame):null}hitTestPoint(e,t,i,s){const{x:n,y:r}=this.viewPoint.getValue(),o=this.radius.value;let l=this.hitRadius.getValueOr(0);if(null!==o){const e=Math.min(s.width,s.height);l=Math.max(l,o.pxValue(e))}const a=n-e,h=r-t;return a*a+h*h<l*l?this:null}ripple(e){return C.ripple(this,e)}},t=[s.Animator({valueType:i.GeoPoint,value:i.GeoPoint.origin(),updateFlags:o.View.NeedsProject,didSetValue(e,t){this.owner.setGeoBounds(e.bounds),this.owner.callObservers("viewDidSetGeoPoint",e,this.owner)}})],a=[s.Animator({valueType:u.R2Point,value:u.R2Point.origin()})],h=[r.ThemeAnimator({valueType:u.Length,value:null})],d=[r.ThemeAnimator({valueType:n.Color,value:null})],v=[r.ThemeAnimator({valueType:Number})],w=[r.ThemeAnimator({valueType:u.Length,value:null})],g=[r.ThemeAnimator({valueType:n.Font,value:null,inherits:!0})],m=[r.ThemeAnimator({valueType:n.Color,value:null,inherits:!0})],y=[s.Property({valueType:Number})],V=[o.ViewRef({viewType:l.TextRunView,viewKey:!0,binds:!0,willAttachView(e){this.owner.callObservers("viewWillAttachGeoLabel",e,this.owner)},didDetachView(e){this.owner.callObservers("viewDidDetachGeoLabel",e,this.owner)},fromLike(e){if(void 0===e||"string"==typeof e){let t=this.view;return null===t&&(t=this.createView()),t instanceof l.TextRunView&&t.text.setState(void 0!==e?e:""),t}return super.fromLike(e)}})],T=[s.Property({valueType:String,value:"auto"})],c(null,null,t,{kind:"field",name:"geoPoint",static:!1,private:!1,access:{has:e=>"geoPoint"in e,get:e=>e.geoPoint,set:(e,t)=>{e.geoPoint=t}}},k,x),c(null,null,a,{kind:"field",name:"viewPoint",static:!1,private:!1,access:{has:e=>"viewPoint"in e,get:e=>e.viewPoint,set:(e,t)=>{e.viewPoint=t}}},b,x),c(null,null,h,{kind:"field",name:"radius",static:!1,private:!1,access:{has:e=>"radius"in e,get:e=>e.radius,set:(e,t)=>{e.radius=t}}},R,x),c(null,null,d,{kind:"field",name:"color",static:!1,private:!1,access:{has:e=>"color"in e,get:e=>e.color,set:(e,t)=>{e.color=t}}},P,x),c(null,null,v,{kind:"field",name:"opacity",static:!1,private:!1,access:{has:e=>"opacity"in e,get:e=>e.opacity,set:(e,t)=>{e.opacity=t}}},S,x),c(null,null,w,{kind:"field",name:"labelPadding",static:!1,private:!1,access:{has:e=>"labelPadding"in e,get:e=>e.labelPadding,set:(e,t)=>{e.labelPadding=t}}},A,x),c(null,null,g,{kind:"field",name:"font",static:!1,private:!1,access:{has:e=>"font"in e,get:e=>e.font,set:(e,t)=>{e.font=t}}},G,x),c(null,null,m,{kind:"field",name:"textColor",static:!1,private:!1,access:{has:e=>"textColor"in e,get:e=>e.textColor,set:(e,t)=>{e.textColor=t}}},M,x),c(null,null,y,{kind:"field",name:"hitRadius",static:!1,private:!1,access:{has:e=>"hitRadius"in e,get:e=>e.hitRadius,set:(e,t)=>{e.hitRadius=t}}},W,x),c(null,null,V,{kind:"field",name:"label",static:!1,private:!1,access:{has:e=>"label"in e,get:e=>e.label,set:(e,t)=>{e.label=t}}},L,x),c(null,null,T,{kind:"field",name:"labelPlacement",static:!1,private:!1,access:{has:e=>"labelPlacement"in e,get:e=>e.labelPlacement,set:(e,t)=>{e.labelPlacement=t}}},D,x),e})();Object.defineProperty(I.prototype,"viewBounds",{get(){const{x:e,y:t}=this.viewPoint.getValue();return new u.R2Box(e,t,e,t)},configurable:!0});let N=(()=>{var e;let t,a,h,d,v,w,g,m=[],y=[],V=[],T=[],x=[],k=[],b=[],R=[];return e=class extends f{constructor(){super(),this.geoCentroid=(p(this,m),p(this,y,void 0)),this.viewCentroid=p(this,V,void 0),this.stroke=p(this,T,void 0),this.strokeWidth=p(this,x,void 0),this.font=p(this,k,void 0),this.textColor=p(this,b,void 0),this.hitWidth=p(this,R,void 0),this.gradientStops=0,Object.defineProperty(this,"viewBounds",{value:u.R2Box.undefined(),writable:!0,enumerable:!0,configurable:!0})}points(){const e=[];let t=this.firstChild;for(;null!==t;)t instanceof I&&e.push(t),t=t.nextSibling;return e}appendPoint(e,t){return this.appendChild(e,t),e}setPoint(e,t){return this.setChild(e,t),t}onInsertChild(e,t){super.onInsertChild(e,t),e instanceof I&&this.onInsertPoint(e)}onInsertPoint(e){e.requireUpdate(o.View.NeedsAnimate|o.View.NeedsProject)}didProject(){const e=this.geoViewport.value;if(null===e)return;const t=this.geoBounds;let s=1/0,n=1/0,r=-1/0,o=-1/0,l=0,a=0,h=1/0,d=1/0,c=-1/0,p=-1/0,v=0,w=0,g=!1,m=0,f=0,y=this.firstChild;for(;null!==y;){if(y instanceof I){const{lng:e,lat:t}=y.geoPoint.getValue();l+=e,a+=t,s=Math.min(s,e),n=Math.min(n,t),r=Math.max(e,r),o=Math.max(t,o),g=g||!isFinite(e)||!isFinite(t);const{x:i,y:u}=y.viewPoint.getValue();h=Math.min(h,i),d=Math.min(d,u),c=Math.max(i,c),p=Math.max(u,p),v+=i,w+=u,g=g||!isFinite(i)||!isFinite(u),y.isGradientStop()&&(m+=1),f+=1}y=y.nextSibling}g||0===f?(this.geoCentroid.setIntrinsic(i.GeoPoint.origin()),this.geoBounds=i.GeoBox.undefined(),this.viewCentroid.setIntrinsic(u.R2Point.origin()),this.viewBounds=u.R2Box.undefined(),this.setCulled(!0)):(l/=f,a/=f,this.geoCentroid.setIntrinsic(new i.GeoPoint(l,a)),this.geoBounds=new i.GeoBox(s,n,r,o),v/=f,w/=f,this.viewCentroid.setIntrinsic(new u.R2Point(v,w)),this.viewBounds=new u.R2Box(h,d,c,p),this.cullGeoFrame(e.geoFrame)),this.gradientStops=m;const V=this.geoBounds;t.equals(V)||(this.willSetGeoBounds(V,t),this.onSetGeoBounds(V,t),this.didSetGeoBounds(V,t)),super.didProject()}onRender(){super.onRender();const e=this.renderer.value;e instanceof l.PaintingRenderer&&!this.hidden&&!this.culled&&(0!==this.gradientStops&&e instanceof l.CanvasRenderer?this.renderPlotGradient(e.context,this.viewFrame):this.renderPlotStroke(e.context,this.viewFrame))}renderPlotStroke(e,t){const i=this.stroke.value;if(null===i)return;let s=0;e.beginPath();let n=this.firstChild;for(;null!==n;){if(n instanceof I){const{x:t,y:i}=n.viewPoint.getValue();0===s?e.moveTo(t,i):e.lineTo(t,i),s+=1}n=n.nextSibling}if(0===s)return;const r=e.lineWidth,o=e.strokeStyle,l=Math.min(t.width,t.height),a=this.strokeWidth.getValue().pxValue(l);e.lineWidth=a,e.strokeStyle=i.toString(),e.stroke(),e.lineWidth=r,e.strokeStyle=o}renderPlotGradient(e,t){const i=this.stroke.getValue(),s=Math.min(t.width,t.height),n=this.strokeWidth.getValue().pxValue(s),r=e.lineWidth,o=e.strokeStyle;let l,a=this.firstChild;for(;null!==a;){if(a instanceof I){if(void 0!==l){const t=l.viewPoint.getValue().x,s=l.viewPoint.getValue().y,r=a.viewPoint.getValue().x,o=a.viewPoint.getValue().y,h=e.createLinearGradient(t,s,r,o);let u=l.color.getValueOr(i),d=l.opacity.value;"number"==typeof d&&(u=u.alpha(d)),h.addColorStop(0,u.toString()),u=a.color.getValueOr(i),d=a.opacity.value,"number"==typeof d&&(u=u.alpha(d)),h.addColorStop(1,u.toString()),e.beginPath(),e.moveTo(t,s),e.lineTo(r,o),e.lineWidth=n,e.strokeStyle=h,e.stroke()}l=a}a=a.nextSibling}e.lineWidth=r,e.strokeStyle=o}updateGeoBounds(){}get popoverFrame(){const e=this.viewCentroid.value,t=this.pageTransform.inverse(),i=t.transformX(e.x,e.y),s=t.transformY(e.x,e.y);return new u.R2Box(i,s,i,s)}hitTest(e,t){const i=this.renderer.value;if(i instanceof l.CanvasRenderer){const s=i.transform.transform(e,t);return this.hitTestPlot(s.x,s.y,i.context,this.viewFrame)}return null}hitTestPlot(e,t,i,s){let n=0;i.beginPath();let r=this.firstChild;for(;null!==r;){if(r instanceof I){const{x:e,y:t}=r.viewPoint.getValue();0===n?i.moveTo(e,t):i.lineTo(e,t),n+=1}r=r.nextSibling}if(0===n)return null;const o=i.lineWidth;let l=this.hitWidth.getValueOr(0);const a=this.strokeWidth.value;if(null!==a){const e=Math.min(s.width,s.height);l=Math.max(l,a.pxValue(e))}i.lineWidth=l;const h=i.isPointInStroke(e,t);return i.lineWidth=o,h?this:null}ripple(e){return C.ripple(this,e)}},t=[s.Property({valueType:i.GeoPoint,value:i.GeoPoint.origin()})],a=[s.Property({valueType:u.R2Point,value:u.R2Point.origin()})],h=[r.ThemeAnimator({valueType:n.Color,value:null,inherits:!0,updateFlags:o.View.NeedsRender})],d=[r.ThemeAnimator({valueType:u.Length,value:null,inherits:!0,updateFlags:o.View.NeedsRender})],v=[r.ThemeAnimator({valueType:n.Font,value:null,inherits:!0})],w=[r.ThemeAnimator({valueType:n.Color,value:null,inherits:!0})],g=[s.Property({valueType:Number})],c(null,null,t,{kind:"field",name:"geoCentroid",static:!1,private:!1,access:{has:e=>"geoCentroid"in e,get:e=>e.geoCentroid,set:(e,t)=>{e.geoCentroid=t}}},y,m),c(null,null,a,{kind:"field",name:"viewCentroid",static:!1,private:!1,access:{has:e=>"viewCentroid"in e,get:e=>e.viewCentroid,set:(e,t)=>{e.viewCentroid=t}}},V,m),c(null,null,h,{kind:"field",name:"stroke",static:!1,private:!1,access:{has:e=>"stroke"in e,get:e=>e.stroke,set:(e,t)=>{e.stroke=t}}},T,m),c(null,null,d,{kind:"field",name:"strokeWidth",static:!1,private:!1,access:{has:e=>"strokeWidth"in e,get:e=>e.strokeWidth,set:(e,t)=>{e.strokeWidth=t}}},x,m),c(null,null,v,{kind:"field",name:"font",static:!1,private:!1,access:{has:e=>"font"in e,get:e=>e.font,set:(e,t)=>{e.font=t}}},k,m),c(null,null,w,{kind:"field",name:"textColor",static:!1,private:!1,access:{has:e=>"textColor"in e,get:e=>e.textColor,set:(e,t)=>{e.textColor=t}}},b,m),c(null,null,g,{kind:"field",name:"hitWidth",static:!1,private:!1,access:{has:e=>"hitWidth"in e,get:e=>e.hitWidth,set:(e,t)=>{e.hitWidth=t}}},R,m),e})(),j=(()=>{var e;let t,a,h,d,v,w=[],g=[],m=[],f=[],y=[];return e=class extends T{constructor(){super(),this.sprite=void p(this,w),this.geoCenter=p(this,g,void 0),this.viewCenter=p(this,m,void 0),this.iconLayout=p(this,f,void 0),this.graphics=p(this,y,void 0),this.sprite=null,Object.defineProperty(this,"viewBounds",{value:u.R2Box.undefined(),writable:!0,enumerable:!0,configurable:!0})}get iconColor(){return r.ThemeAnimator.getter()}onApplyTheme(e,t,i){if(super.onApplyTheme(e,t,i),this.graphics.derived)return;const n=this.graphics.value;if(!(n instanceof l.Icon))return;const r=n.withTheme(e,t);this.graphics.setState(r,!!n.isThemed()&&i,s.Affinity.Reflexive)}onProject(){super.onProject(),this.projectIcon()}projectGeoCenter(e){const t=this.geoViewport.value;if(!this.mounted||null===t)return;const i=null!==e&&e.isDefined()?t.project(e):null;this.viewCenter.setInterpolatedValue(this.viewCenter.value,i),this.projectIcon()}projectIcon(){const e=this.geoViewport.value;if(null===e)return;if(s.Affinity.Intrinsic>=(this.viewCenter.flags&s.Affinity.Mask)){const t=this.geoCenter.value,i=null!==t&&t.isDefined()?e.project(t):null;this.viewCenter.value=i}const t=this.viewFrame;this.viewBounds=this.deriveViewBounds(t);const i=this.viewCenter.value,n=this.viewCenter.state;null!==i&&null!==n&&(t.intersectsBox(this.viewBounds)||t.intersectsSegment(new u.R2Segment(i.x,i.y,n.x,n.y)))?this.setCulled(!1):this.setCulled(!0)}onRasterize(){super.onRasterize(),this.hidden||this.culled||this.rasterizeIcon(this.viewBounds)}rasterizeIcon(e){let t=this.sprite;const i=this.graphics.value;if(null!==i&&e.isDefined()){const s=e.width,n=e.height;null!==t&&(t.width<s||t.height<n||s<t.width/2&&n<t.height/2)&&(this.sprite=null,t.release(),t=null),null===t&&(t=this.sprites.getService().acquireSprite(s,n),this.sprite=t);const r=t.getRenderer(),o=r.context;o.clearRect(0,0,t.width,t.height),o.beginPath(),i.render(r,new u.R2Box(0,0,s,n))}else null!==t&&(this.sprite=null,t.release())}onComposite(){super.onComposite();const e=this.renderer.value;e instanceof l.CanvasRenderer&&!this.hidden&&!this.culled&&this.compositeIcon(e,this.viewBounds)}compositeIcon(e,t){const i=this.sprite;null!==i&&i.draw(e.context,t)}renderGeoBounds(e,t){}updateGeoBounds(){}deriveViewBounds(e){const t=this.viewCenter.value;if(null===t||!t.isDefined())return u.R2Box.undefined();void 0===e&&(e=this.viewFrame);const i=Math.min(e.width,e.height),s=this.iconLayout.value,n=null!==s?s.width.pxValue(i):i,r=null!==s?s.height.pxValue(i):i,o=null!==s?s.xAlign:.5,l=null!==s?s.yAlign:.5,a=t.x-n*o,h=t.y-r*l;return new u.R2Box(a,h,a+n,h+r)}get popoverFrame(){const e=this.viewCenter.value;if(null===e||!e.isDefined())return this.pageBounds;const t=this.viewFrame,i=Math.min(t.width,t.height),s=this.iconLayout.value,n=null!==s?s.width.pxValue(i):i,r=null!==s?s.height.pxValue(i):i,o=null!==s?s.xAlign:.5,l=null!==s?s.yAlign:.5,a=this.pageTransform.inverse(),h=a.transformX(e.x,e.y)-n*o,d=a.transformY(e.x,e.y)-r*l;return new u.R2Box(h,d,h+n,d+r)}hitTest(e,t){const i=this.renderer.value;return i instanceof l.CanvasRenderer?this.hitTestIcon(e,t,i,this.viewBounds):null}hitTestIcon(e,t,i,s){return this.hitBounds.contains(e,t)?this:null}onUnmount(){super.onUnmount();const e=this.sprite;null!==e&&(this.sprite=null,e.release())}},t=[s.Animator({valueType:i.GeoPoint,value:null,didSetState(e){this.owner.projectGeoCenter(e)},didSetValue(e){this.owner.setGeoBounds(null!==e?e.bounds:i.GeoBox.undefined()),this.mounted&&this.owner.projectIcon(),this.owner.callObservers("viewDidSetGeoCenter",e,this.owner)},decohere(e){this.owner.culled?this.recohere(performance.now()):super.decohere(e)}})],a=[s.Animator({valueType:u.R2Point,value:u.R2Point.undefined(),updateFlags:o.View.NeedsComposite})],h=[s.Animator({valueType:l.IconLayout,value:null,updateFlags:o.View.NeedsProject|o.View.NeedsRender|o.View.NeedsRasterize|o.View.NeedsComposite})],d=[r.ThemeAnimator({valueType:n.Color,value:null,updateFlags:o.View.NeedsRender|o.View.NeedsRasterize|o.View.NeedsComposite,didSetState(e){const t=null!==this.timing&&this.timing;this.owner.graphics.setState(this.owner.graphics.state,t,s.Affinity.Reflexive)}})],v=[r.ThemeAnimator({extends:l.IconGraphicsAnimator,valueType:l.Graphics,value:null,updateFlags:o.View.NeedsRender|o.View.NeedsRasterize|o.View.NeedsComposite,didSetValue(e){this.owner.callObservers("viewDidSetGraphics",e,this.owner)}})],c(e,null,d,{kind:"getter",name:"iconColor",static:!1,private:!1,access:{has:e=>"iconColor"in e,get:e=>e.iconColor}},null,w),c(null,null,t,{kind:"field",name:"geoCenter",static:!1,private:!1,access:{has:e=>"geoCenter"in e,get:e=>e.geoCenter,set:(e,t)=>{e.geoCenter=t}}},g,w),c(null,null,a,{kind:"field",name:"viewCenter",static:!1,private:!1,access:{has:e=>"viewCenter"in e,get:e=>e.viewCenter,set:(e,t)=>{e.viewCenter=t}}},m,w),c(null,null,h,{kind:"field",name:"iconLayout",static:!1,private:!1,access:{has:e=>"iconLayout"in e,get:e=>e.iconLayout,set:(e,t)=>{e.iconLayout=t}}},f,w),c(null,null,v,{kind:"field",name:"graphics",static:!1,private:!1,access:{has:e=>"graphics"in e,get:e=>e.graphics,set:(e,t)=>{e.graphics=t}}},y,w),e.MountFlags=T.MountFlags|o.View.NeedsRasterize,e.UncullFlags=T.UncullFlags|o.View.NeedsRasterize,e})(),z=(()=>{var e;let t,n,o,a,h=[],u=[],d=[],v=[],w=[];return e=class extends x{constructor(){super(...arguments),this.geoCenter=(p(this,h),p(this,u,void 0)),this.iconLayout=p(this,d,void 0),this.iconColor=p(this,v,void 0),this.graphics=p(this,w,void 0)}createGeoController(){return new q}},t=[s.Property({valueType:i.GeoPoint,value:null,didSetValue(e){this.owner.callObservers("traitDidSetGeoCenter",e,this.owner),this.owner.geoPerspective.setIntrinsic(e)}})],n=[s.Property({valueType:l.IconLayout,value:null,didSetValue(e){this.owner.callObservers("traitDidSetIconLayout",e,this.owner)}})],o=[s.Property({valueType:r.ColorLook,value:null})],a=[s.Property({valueType:l.Graphics,value:null,didSetValue(e){this.owner.callObservers("traitDidSetGraphics",e,this.owner)}})],c(null,null,t,{kind:"field",name:"geoCenter",static:!1,private:!1,access:{has:e=>"geoCenter"in e,get:e=>e.geoCenter,set:(e,t)=>{e.geoCenter=t}}},u,h),c(null,null,n,{kind:"field",name:"iconLayout",static:!1,private:!1,access:{has:e=>"iconLayout"in e,get:e=>e.iconLayout,set:(e,t)=>{e.iconLayout=t}}},d,h),c(null,null,o,{kind:"field",name:"iconColor",static:!1,private:!1,access:{has:e=>"iconColor"in e,get:e=>e.iconColor,set:(e,t)=>{e.iconColor=t}}},v,h),c(null,null,a,{kind:"field",name:"graphics",static:!1,private:!1,access:{has:e=>"graphics"in e,get:e=>e.graphics,set:(e,t)=>{e.graphics=t}}},w,h),e})(),q=(()=>{var e;let t,n,o,a,u,d=[],v=[],w=[],g=[],m=[],f=[];return e=class extends k{constructor(){super(...arguments),this.geo=(p(this,d),p(this,v,void 0)),this.geoCenter=p(this,w,void 0),this.iconLayout=p(this,g,void 0),this.iconColor=p(this,m,void 0),this.graphics=p(this,f,void 0)}},t=[h.TraitViewRef({extends:!0,traitType:z,initTrait(e){super.initTrait(e),this.owner.geoPerspective.bindInlet(e.geoPerspective),this.owner.geoCenter.bindInlet(e.geoCenter),this.owner.iconLayout.bindInlet(e.iconLayout),this.owner.iconColor.bindInlet(e.iconColor),this.owner.graphics.bindInlet(e.graphics)},deinitTrait(e){this.owner.geoPerspective.unbindInlet(e.geoPerspective),this.owner.geoCenter.unbindInlet(e.geoCenter),this.owner.iconLayout.unbindInlet(e.iconLayout),this.owner.iconColor.unbindInlet(e.iconColor),this.owner.graphics.unbindInlet(e.graphics),super.deinitTrait(e)},viewType:j,initView(e){super.initView(e),e.geoCenter.bindInlet(this.owner.geoCenter),e.iconLayout.bindInlet(this.owner.iconLayout),e.iconColor.bindInlet(this.owner.iconColor),e.graphics.bindInlet(this.owner.graphics)},deinitView(e){e.geoCenter.unbindInlet(this.owner.geoCenter),e.iconLayout.unbindInlet(this.owner.iconLayout),e.iconColor.unbindInlet(this.owner.iconColor),e.graphics.unbindInlet(this.owner.graphics),super.deinitView(e)}})],n=[s.Property({valueType:i.GeoPoint,value:null,transition:!0,didSetValue(e){this.owner.callObservers("controllerDidSetGeoCenter",e,this.owner),this.owner.geoPerspective.setIntrinsic(e)}})],o=[s.Property({valueType:l.IconLayout,value:null})],a=[s.Property({valueType:r.ColorLook,value:null,transition:!0})],u=[s.Property({valueType:l.Graphics,value:null})],c(null,null,t,{kind:"field",name:"geo",static:!1,private:!1,access:{has:e=>"geo"in e,get:e=>e.geo,set:(e,t)=>{e.geo=t}}},v,d),c(null,null,n,{kind:"field",name:"geoCenter",static:!1,private:!1,access:{has:e=>"geoCenter"in e,get:e=>e.geoCenter,set:(e,t)=>{e.geoCenter=t}}},w,d),c(null,null,o,{kind:"field",name:"iconLayout",static:!1,private:!1,access:{has:e=>"iconLayout"in e,get:e=>e.iconLayout,set:(e,t)=>{e.iconLayout=t}}},g,d),c(null,null,a,{kind:"field",name:"iconColor",static:!1,private:!1,access:{has:e=>"iconColor"in e,get:e=>e.iconColor,set:(e,t)=>{e.iconColor=t}}},m,d),c(null,null,u,{kind:"field",name:"graphics",static:!1,private:!1,access:{has:e=>"graphics"in e,get:e=>e.graphics,set:(e,t)=>{e.graphics=t}}},f,d),e})(),H=(()=>{var e;let t,n,r,a=[],h=[],u=[],v=[];return e=class extends f{constructor(){super(...arguments),this.geoViewport=(p(this,a),p(this,h,void 0)),this.canvas=p(this,u,void 0),this.container=p(this,v,void 0)}needsProcess(e){return 0!=(e&o.View.NeedsResize)&&(e|=o.View.NeedsProject),e}get geoFrame(){const e=this.geoViewport.value;return null!==e?e.geoFrame:i.GeoBox.globe()}},t=[s.Property({extends:!0,inherits:!1,willSetValue(e,t){this.owner.callObservers("viewWillSetGeoViewport",e,t,this.owner)},didSetValue(e,t){this.owner.callObservers("viewDidSetGeoViewport",e,t,this.owner)}})],n=[o.ViewRef({viewType:l.CanvasView,willAttachView(e){this.owner.callObservers("viewWillAttachMapCanvas",e,this.owner)},didDetachView(e){this.owner.callObservers("viewDidDetachMapCanvas",e,this.owner)}})],r=[o.ViewRef({viewType:d.HtmlView,willAttachView(e){this.owner.callObservers("viewWillAttachMapContainer",e,this.owner)},didDetachView(e){this.owner.callObservers("viewDidDetachMapContainer",e,this.owner)}})],c(null,null,t,{kind:"field",name:"geoViewport",static:!1,private:!1,access:{has:e=>"geoViewport"in e,get:e=>e.geoViewport,set:(e,t)=>{e.geoViewport=t}}},h,a),c(null,null,n,{kind:"field",name:"canvas",static:!1,private:!1,access:{has:e=>"canvas"in e,get:e=>e.canvas,set:(e,t)=>{e.canvas=t}}},u,a),c(null,null,r,{kind:"field",name:"container",static:!1,private:!1,access:{has:e=>"container"in e,get:e=>e.container,set:(e,t)=>{e.container=t}}},v,a),e})(),U=(()=>{var e;let t,i,n=[],r=[],o=[];return e=class extends a.Trait{constructor(){super(...arguments),this.geoPerspective=(p(this,n),p(this,r,void 0)),this.layers=p(this,o,void 0)}onStartConsuming(){super.onStartConsuming(),this.layers.consumeTraits(this)}onStopConsuming(){super.onStopConsuming(),this.layers.unconsumeTraits(this)}},t=[s.Property({valueType:g,value:null,didSetValue(e){this.owner.callObservers("traitDidSetGeoPerspective",e,this.owner)}})],i=[a.TraitSet({traitType:y,binds:!0,willAttachTrait(e,t){this.owner.callObservers("traitWillAttachLayer",e,t,this.owner)},didAttachTrait(e){this.owner.consuming&&e.consume(this.owner)},willDetachTrait(e){this.owner.consuming&&e.unconsume(this.owner)},didDetachTrait(e){this.owner.callObservers("traitDidDetachLayer",e,this.owner)},detectModel:e=>e.getTrait(y),detectTrait:e=>null})],c(null,null,t,{kind:"field",name:"geoPerspective",static:!1,private:!1,access:{has:e=>"geoPerspective"in e,get:e=>e.geoPerspective,set:(e,t)=>{e.geoPerspective=t}}},r,n),c(null,null,i,{kind:"field",name:"layers",static:!1,private:!1,access:{has:e=>"layers"in e,get:e=>e.layers,set:(e,t)=>{e.layers=t}}},o,n),e})(),K=(()=>{var e;let t,i,s,n,r=[],a=[],u=[],v=[],w=[];return e=class extends h.Controller{constructor(){super(...arguments),this.map=(p(this,r),p(this,a,void 0)),this.canvas=p(this,u,void 0),this.container=p(this,v,void 0),this.layers=p(this,w,void 0)}createMapView(e){return null}setGeoPerspective(e){if(null===e)return;const t=this.map.view;null!==t&&t.moveTo(e)}},t=[h.TraitViewRef({consumed:!0,traitType:U,observesTrait:!0,willAttachTrait(e){this.owner.callObservers("controllerWillAttachMapTrait",e,this.owner)},initTrait(e){null!==this.view&&this.owner.setGeoPerspective(e.geoPerspective.value),this.owner.layers.addTraits(e.layers.traits)},deinitTrait(e){this.owner.layers.deleteTraits(e.layers.traits)},didDetachTrait(e){this.owner.callObservers("controllerDidDetachMapTrait",e,this.owner)},traitDidSetGeoPerspective(e){this.owner.setGeoPerspective(e)},traitWillAttachLayer(e,t){this.owner.layers.addTrait(e,t)},traitDidDetachLayer(e){this.owner.layers.deleteTrait(e)},viewType:H,observesView:!0,initView(e){const t=this.trait;null!==t&&this.owner.setGeoPerspective(t.geoPerspective.value);const i=this.owner.layers.controllers;for(const t in i){const s=i[t],n=s.geo.view;null!==n&&null===n.parent&&s.geo.insertView(e)}},willAttachView(e){this.owner.callObservers("controllerWillAttachMapView",e,this.owner)},didAttachView(e){this.owner.canvas.setView(e.canvas.view),this.owner.container.setView(e.container.view)},willDetachView(e){this.owner.canvas.setView(null),this.owner.container.setView(null)},didDetachView(e){this.owner.callObservers("controllerDidDetachMapView",e,this.owner)},viewWillSetGeoViewport(e,t){this.owner.callObservers("controllerWillSetGeoViewport",e,t,this.owner)},viewDidSetGeoViewport(e,t){this.owner.callObservers("controllerDidSetGeoViewport",e,t,this.owner)},viewWillAttachMapCanvas(e){this.owner.canvas.setView(e)},viewDidDetachMapCanvas(e){this.owner.canvas.setView(null)},viewWillAttachMapContainer(e){this.owner.container.setView(e)},viewDidDetachMapContainer(e){this.owner.container.setView(null)}})],i=[o.ViewRef({viewType:l.CanvasView,willAttachView(e){this.owner.callObservers("controllerWillAttachMapCanvasView",e,this.owner)},didDetachView(e){this.owner.callObservers("controllerDidDetachMapCanvasView",e,this.owner)}})],s=[o.ViewRef({viewType:d.HtmlView,willAttachView(e){this.owner.callObservers("controllerWillAttachMapContainerView",e,this.owner)},didAttachView(e){let t=this.owner.map.view;null===t&&(t=this.owner.createMapView(e),this.owner.map.setView(t)),null!==t&&t.container.setView(e)},didDetachView(e){this.owner.callObservers("controllerDidDetachMapContainerView",e,this.owner)}})],n=[h.TraitViewControllerSet({controllerType:V,binds:!0,observes:!0,get parentView(){return this.owner.map.view},getTraitViewRef:e=>e.geo,willAttachController(e){this.owner.callObservers("controllerWillAttachLayer",e,this.owner)},didAttachController(e){const t=e.geo.trait;null!==t&&this.attachLayerTrait(t,e);const i=e.geo.view;null!==i&&this.attachLayerView(i,e)},willDetachController(e){const t=e.geo.view;null!==t&&this.detachLayerView(t,e);const i=e.geo.trait;null!==i&&this.detachLayerTrait(i,e)},didDetachController(e){this.owner.callObservers("controllerDidDetachLayer",e,this.owner)},controllerWillAttachGeoTrait(e,t){this.owner.callObservers("controllerWillAttachLayerTrait",e,t,this.owner),this.attachLayerTrait(e,t)},controllerDidDetachGeoTrait(e,t){this.detachLayerTrait(e,t),this.owner.callObservers("controllerDidDetachLayerTrait",e,t,this.owner)},attachLayerTrait(e,t){},detachLayerTrait(e,t){this.deleteController(t)},controllerWillAttachGeoView(e,t){this.owner.callObservers("controllerWillAttachLayerView",e,t,this.owner),this.attachLayerView(e,t)},controllerDidDetachGeoView(e,t){this.detachLayerView(e,t),this.owner.callObservers("controllerDidDetachLayerView",e,t,this.owner)},attachLayerView(e,t){const i=this.owner.map.view;null!==i&&null===e.parent&&t.geo.insertView(i)},detachLayerView(e,t){e.remove()},controllerDidSetGeoPerspective(e,t){this.owner.callObservers("controllerDidSetLayerGeoPerspective",e,t,this.owner)},createController(e){return void 0!==e?e.createGeoController():super.createController()}})],c(null,null,t,{kind:"field",name:"map",static:!1,private:!1,access:{has:e=>"map"in e,get:e=>e.map,set:(e,t)=>{e.map=t}}},a,r),c(null,null,i,{kind:"field",name:"canvas",static:!1,private:!1,access:{has:e=>"canvas"in e,get:e=>e.canvas,set:(e,t)=>{e.canvas=t}}},u,r),c(null,null,s,{kind:"field",name:"container",static:!1,private:!1,access:{has:e=>"container"in e,get:e=>e.container,set:(e,t)=>{e.container=t}}},v,r),c(null,null,n,{kind:"field",name:"layers",static:!1,private:!1,access:{has:e=>"layers"in e,get:e=>e.layers,set:(e,t)=>{e.layers=t}}},w,r),e})();class _{get geoFrame(){return i.GeoBox.globe()}get geoCenter(){return i.GeoPoint.origin()}get zoom(){return 0}get heading(){return 0}get tilt(){return 0}canEqual(e){return e instanceof _&&this.constructor===e.constructor}equals(e){return this===e||e instanceof _&&(e.canEqual(this)&&this.viewFrame.equals(e.viewFrame))}}class X extends _{constructor(e){super(),this.viewFrame=e}withViewFrame(e){let t=e.xMin,i=e.yMin,s=e.xMax,n=e.yMax;const r=s-t,o=n-i,l=r/o;if(l<2){const l=(o-r/2)/2;i+=l,n-=l,e=new u.R2Box(t,i,s,n)}else if(l>2){const l=(r-2*o)/2;t+=l,s-=l,e=new u.R2Box(t,i,s,n)}return new X(e)}project(e,t){1===arguments.length&&(Array.isArray(e)?(t=e[1],e=e[0]):(t=e.lat,e=e.lng));const i=this.viewFrame,s=i.xMin+(180+e)/360*i.width,n=i.yMax-(90+t)/180*i.height;return new u.R2Point(s,n)}unproject(e,t){1===arguments.length&&(Array.isArray(e)?(t=e[1],e=e[0]):(t=e.y,e=e.x));const s=this.viewFrame,n=360*(e-s.xMin)/s.width-180,r=180*(s.yMax-t)/s.height-90;return new i.GeoPoint(n,r)}}let Y=(()=>{var e;let t,i,n,r=[],l=[],a=[],h=[];return e=class e extends H{constructor(e){super(),this.geoViewport=(p(this,r),p(this,l,void 0)),this.canvas=p(this,a,void 0),this.container=p(this,h,void 0),this.geoViewport.value=e}willProcess(e){0!=(e&o.View.NeedsProject)&&this.geoViewport.update(),super.willProcess(e)}moveTo(e,t){}static create(t){return void 0===t&&(t=new X(u.R2Box.undefined())),new e(t)}},t=[s.Property({extends:!0,update(){this.hasAffinity(s.Affinity.Intrinsic)&&this.value instanceof _&&this.setIntrinsic(this.value.withViewFrame(this.owner.viewFrame))}})],i=[o.ViewRef({extends:!0,didAttachView(e,t){null===this.owner.parent&&e.appendChild(this.owner),super.didAttachView(e,t)},willDetachView(e){super.willDetachView(e),this.owner.parent===e&&e.removeChild(this.owner)}})],n=[o.ViewRef({extends:!0,didAttachView(e,t){this.owner.canvas.insertView(e),super.didAttachView(e,t)},willDetachView(e){super.willDetachView(e);const t=this.owner.canvas.view;null!==t&&t.parent===e&&e.removeChild(t)}})],c(null,null,t,{kind:"field",name:"geoViewport",static:!1,private:!1,access:{has:e=>"geoViewport"in e,get:e=>e.geoViewport,set:(e,t)=>{e.geoViewport=t}}},l,r),c(null,null,i,{kind:"field",name:"canvas",static:!1,private:!1,access:{has:e=>"canvas"in e,get:e=>e.canvas,set:(e,t)=>{e.canvas=t}}},a,r),c(null,null,n,{kind:"field",name:"container",static:!1,private:!1,access:{has:e=>"container"in e,get:e=>e.container,set:(e,t)=>{e.container=t}}},h,r),e})();class Z{constructor(e,t,i,s,n,r){this.map=e,this.geoFrame=t,this.geoCenter=i,this.zoom=s,this.heading=n,this.tilt=r}project(e,t){let i;i="number"==typeof e?new mapboxgl.LngLat(e,t):e;const s=this.map.project(i);return new u.R2Point(s.x,s.y)}unproject(e,t){let s;s="number"==typeof e?new mapboxgl.Point(e,t):Array.isArray(e)?e:new mapboxgl.Point(e.x,e.y);const n=this.map.unproject(s);return new i.GeoPoint(n.lng,n.lat)}equals(e){return this===e||e instanceof Z&&(this.map===e.map&&this.geoFrame.equals(e.geoFrame)&&this.geoCenter.equals(e.geoCenter)&&this.zoom===e.zoom&&this.heading===e.heading&&this.tilt===e.tilt)}static create(e){const t=e.getBounds(),s=new i.GeoBox(t.getWest(),t.getSouth(),t.getEast(),t.getNorth()),n=e.getCenter(),r=new i.GeoPoint(n.lng,n.lat),o=e.getZoom(),l=e.getBearing(),a=e.getPitch();return new Z(e,s,r,o,l,a)}}let J=(()=>{var e;let i,n,l,a,h,u,v,w,m,f,y,V=[],C=[],T=[],x=[],k=[],b=[],R=[],P=[],S=[],A=[];return e=class extends H{constructor(e){super(),this.map=void p(this,V),this.geoViewport=p(this,C,void 0),this.canvas=p(this,T,void 0),this.container=p(this,x,void 0),this.controlContainer=p(this,k,void 0),this.topLeftControls=p(this,b,void 0),this.topRightControls=p(this,R,void 0),this.bottomLeftControls=p(this,P,void 0),this.bottomRightControls=p(this,S,void 0),this.mapStyle=p(this,A,void 0),this.map=e,this.geoViewport.value=Z.create(e),this.onMapRender=this.onMapRender.bind(this),this.onMoveStart=this.onMoveStart.bind(this),this.onMoveEnd=this.onMoveEnd.bind(this),this.initMap(e)}initMap(e){e.on("render",this.onMapRender),e.on("movestart",this.onMoveStart),e.on("moveend",this.onMoveEnd),void 0===e.style?this.mapStyle.update():this.mapStyle.setAffinity(s.Affinity.Extrinsic)}onMapRender(){this.geoViewport.update()}onMoveStart(){this.willMoveMap()}onMoveEnd(){this.didMoveMap()}moveTo(e,i){const s=this.geoViewport.value;if(null===s)return;let n;const l={},a=(e=g.fromLike(e)).geoFrame;null!==a&&(n=[a.west,a.south,a.east,a.north]);const h=e.geoCenter;null===h||s.geoCenter.equivalentTo(h,1e-5)||(l.center=h);const u=e.zoom;void 0===u||t.Equivalent(s.zoom,u,1e-5)||(l.zoom=u);const d=e.heading;void 0===d||t.Equivalent(s.heading,d,1e-5)||(l.bearing=d);const c=e.tilt;void 0===c||t.Equivalent(s.tilt,c,1e-5)||(l.pitch=c),(i=void 0===i||!0===i?this.getLookOr(r.Look.timing,r.Mood.ambient,!1):t.Timing.fromLike(i))instanceof t.Timing?l.duration=i.duration:l.duration=0,l.padding=this.edgeInsets.padding,void 0!==n?this.map.fitBounds(n,l):this.map.flyTo(l),0===l.duration&&setTimeout(this.requireUpdate.bind(this,o.View.NeedsProject))}willMoveMap(){this.callObservers("viewWillMoveMap",this)}didMoveMap(){this.callObservers("viewDidMoveMap",this)}get edgeInsets(){return s.Property.getter()}onResize(){super.onResize(),this.map.resize()}onLayout(){super.onLayout(),this.layoutControls()}layoutControls(){const e=this.container.view;if(null===e)return;const t=e.edgeInsets.value,i=Math.max(e.style.paddingTop.pxState(),t.insetTop),s=Math.max(e.style.paddingRight.pxState(),t.insetRight),n=Math.max(e.style.paddingBottom.pxState(),t.insetBottom),r=Math.max(e.style.paddingLeft.pxState(),t.insetLeft),o=this.topLeftControls.view;null!==o&&(o.style.top.setIntrinsic(i),o.style.left.setIntrinsic(r));const l=this.topRightControls.view;null!==l&&(l.style.top.setIntrinsic(i),l.style.right.setIntrinsic(s));const a=this.bottomLeftControls.view;null!==a&&(a.style.bottom.setIntrinsic(n),a.style.left.setIntrinsic(r));const h=this.bottomRightControls.view;null!==h&&(h.style.bottom.setIntrinsic(n),h.style.right.setIntrinsic(s))}get viewport(){return s.Provider.getter()}onMount(){super.onMount(),this.mapStyle.update()}},i=[s.Property({extends:!0,didSetValue(e,t){super.didSetValue(e,t);const i=!this.owner.hidden&&!this.owner.culled;this.owner.requireUpdate(o.View.NeedsProject,i)},update(){this.hasAffinity(s.Affinity.Intrinsic)&&this.setIntrinsic(Z.create(this.owner.map))}})],n=[o.ViewRef({extends:!0,didAttachView(e,t){null===this.owner.parent&&(e.appendChild(this.owner),e.setEventTarget(this.owner.map.getCanvasContainer())),super.didAttachView(e,t)},willDetachView(e){super.willDetachView(e),this.owner.parent===e&&e.removeChild(this.owner)}})],l=[o.ViewRef({extends:!0,didAttachView(e,t){d.HtmlView.fromNode(this.owner.map.getContainer());const i=d.HtmlView.fromNode(this.owner.map.getCanvasContainer());this.owner.canvas.insertView(i);const s=e.node.querySelector(".mapboxgl-control-container");if(null!==s){this.owner.controlContainer.setView(d.HtmlView.fromNode(s));const e=s.querySelector(".mapboxgl-ctrl-top-left");null!==e&&this.owner.topLeftControls.setView(d.HtmlView.fromNode(e));const t=s.querySelector(".mapboxgl-ctrl-top-right");null!==t&&this.owner.topRightControls.setView(d.HtmlView.fromNode(t));const i=s.querySelector(".mapboxgl-ctrl-bottom-left");null!==i&&this.owner.bottomLeftControls.setView(d.HtmlView.fromNode(i));const n=s.querySelector(".mapboxgl-ctrl-bottom-right");null!==n&&this.owner.bottomRightControls.setView(d.HtmlView.fromNode(n))}super.didAttachView(e,t)},willDetachView(e){super.willDetachView(e);const t=this.owner.canvas.view,i=d.HtmlView.fromNode(this.owner.map.getCanvasContainer());null!==t&&t.parent===i&&i.removeChild(e),this.owner.controlContainer.setView(null),this.owner.topLeftControls.setView(null),this.owner.topRightControls.setView(null),this.owner.bottomLeftControls.setView(null),this.owner.bottomRightControls.setView(null)}})],a=[o.ViewRef({viewType:d.HtmlView})],h=[o.ViewRef({viewType:d.HtmlView})],u=[o.ViewRef({viewType:d.HtmlView})],v=[o.ViewRef({viewType:d.HtmlView})],w=[o.ViewRef({viewType:d.HtmlView})],m=[s.Property({extends:!0,get padding(){const e=this.value;let t=e.insetTop,i=e.insetRight,s=e.insetBottom,n=e.insetLeft;const r=this.owner.container.view;return null!==r&&(t=Math.max(r.style.paddingTop.pxState(),t),i=Math.max(r.style.paddingRight.pxState(),i),s=Math.max(r.style.paddingBottom.pxState(),s),n=Math.max(r.style.paddingLeft.pxState(),n)),{top:t,right:i,bottom:s,left:n}}})],f=[s.Provider({extends:!0,observes:!0,serviceDidSetViewportColorScheme(e){this.owner.mapStyle.update()}})],y=[s.Property({value:null,init(){this.dark="mapbox://styles/mapbox/dark-v10",this.light="mapbox://styles/mapbox/light-v10"},didSetValue(e){null!==e&&this.owner.map.setStyle(e)},update(){if(!this.hasAffinity(s.Affinity.Intrinsic))return;const e=this.owner.viewport.service;null!==e&&("dark"===e.colorScheme.value?this.setIntrinsic(this.dark):this.setIntrinsic(this.light))}})],c(e,null,m,{kind:"getter",name:"edgeInsets",static:!1,private:!1,access:{has:e=>"edgeInsets"in e,get:e=>e.edgeInsets}},null,V),c(e,null,f,{kind:"getter",name:"viewport",static:!1,private:!1,access:{has:e=>"viewport"in e,get:e=>e.viewport}},null,V),c(null,null,i,{kind:"field",name:"geoViewport",static:!1,private:!1,access:{has:e=>"geoViewport"in e,get:e=>e.geoViewport,set:(e,t)=>{e.geoViewport=t}}},C,V),c(null,null,n,{kind:"field",name:"canvas",static:!1,private:!1,access:{has:e=>"canvas"in e,get:e=>e.canvas,set:(e,t)=>{e.canvas=t}}},T,V),c(null,null,l,{kind:"field",name:"container",static:!1,private:!1,access:{has:e=>"container"in e,get:e=>e.container,set:(e,t)=>{e.container=t}}},x,V),c(null,null,a,{kind:"field",name:"controlContainer",static:!1,private:!1,access:{has:e=>"controlContainer"in e,get:e=>e.controlContainer,set:(e,t)=>{e.controlContainer=t}}},k,V),c(null,null,h,{kind:"field",name:"topLeftControls",static:!1,private:!1,access:{has:e=>"topLeftControls"in e,get:e=>e.topLeftControls,set:(e,t)=>{e.topLeftControls=t}}},b,V),c(null,null,u,{kind:"field",name:"topRightControls",static:!1,private:!1,access:{has:e=>"topRightControls"in e,get:e=>e.topRightControls,set:(e,t)=>{e.topRightControls=t}}},R,V),c(null,null,v,{kind:"field",name:"bottomLeftControls",static:!1,private:!1,access:{has:e=>"bottomLeftControls"in e,get:e=>e.bottomLeftControls,set:(e,t)=>{e.bottomLeftControls=t}}},P,V),c(null,null,w,{kind:"field",name:"bottomRightControls",static:!1,private:!1,access:{has:e=>"bottomRightControls"in e,get:e=>e.bottomRightControls,set:(e,t)=>{e.bottomRightControls=t}}},S,V),c(null,null,y,{kind:"field",name:"mapStyle",static:!1,private:!1,access:{has:e=>"mapStyle"in e,get:e=>e.mapStyle,set:(e,t)=>{e.mapStyle=t}}},A,V),e})();class Q{constructor(e,t,i,s,n,r,o){this.map=e,this.geoFrame=t,this.geoCenter=i,this.viewOrigin=s,this.zoom=n,this.heading=r,this.tilt=o}project(e,t){const i=this.viewOrigin;let s;s="number"==typeof e?new L.LatLng(t,e):Array.isArray(e)?new L.LatLng(e[1],e[0]):e;const n=this.map.project(s,this.zoom);return new u.R2Point(n.x-i.x,n.y-i.y)}unproject(e,t){const s=this.viewOrigin;let n;n="number"==typeof e?new L.Point(e+s.x,t+s.y):Array.isArray(e)?new L.Point(e[0]+s.x,e[1]+s.y):new L.Point(e.x+s.x,e.y+s.y);const r=this.map.unproject(n,this.zoom);return new i.GeoPoint(r.lng,r.lat)}equals(e){return this===e||e instanceof Q&&(this.map===e.map&&this.geoFrame.equals(e.geoFrame)&&this.geoCenter.equals(e.geoCenter)&&this.viewOrigin.equals(e.viewOrigin)&&this.zoom===e.zoom&&this.heading===e.heading&&this.tilt===e.tilt)}static create(e){const t=e.getBounds(),s=new i.GeoBox(t.getWest(),t.getSouth(),t.getEast(),t.getNorth()),n=e.getCenter(),r=new i.GeoPoint(n.lng,n.lat);let{x:o,y:l}=e.getPixelOrigin();try{const t=u.Transform.parse(e.getPane("mapPane").style.transform);t instanceof u.TranslateTransform&&(o-=t.x.pxValue(),l-=t.y.pxValue())}catch(e){}const a=new u.R2Point(o,l),h=e.getZoom();return new Q(e,s,r,a,h,0,0)}}let $=(()=>{var e;let i,n,l,a=[],h=[],u=[],v=[];return e=class extends H{constructor(e){super(),this.map=void p(this,a),this.geoViewport=p(this,h,void 0),this.canvas=p(this,u,void 0),this.container=p(this,v,void 0),this.map=e,this.geoViewport.value=Q.create(e),this.onMapRender=this.onMapRender.bind(this),this.onMoveStart=this.onMoveStart.bind(this),this.onMoveEnd=this.onMoveEnd.bind(this),this.initMap(e)}initMap(e){e.on("move",this.onMapRender),e.on("movestart",this.onMoveStart),e.on("moveend",this.onMoveEnd)}onMapRender(){this.geoViewport.update()}onMoveStart(){this.willMoveMap()}onMoveEnd(){this.didMoveMap()}moveTo(e,i){const s=this.geoViewport.value;if(null===s)return;const n={};let o=(e=g.fromLike(e)).geoCenter;null===o&&(o=s.geoCenter);const l=e.zoom;(i=void 0===i||!0===i?this.getLookOr(r.Look.timing,r.Mood.ambient,!1):t.Timing.fromLike(i))instanceof t.Timing?(n.animate=!0,n.duration=i.duration):n.duration=0,this.map.flyTo(o,l,n)}willMoveMap(){this.callObservers("viewWillMoveMap",this)}didMoveMap(){this.callObservers("viewDidMoveMap",this)}},i=[s.Property({extends:!0,didSetValue(e,t){super.didSetValue(e,t);const i=!this.owner.hidden&&!this.owner.culled;this.owner.requireUpdate(o.View.NeedsProject,i)},update(){this.hasAffinity(s.Affinity.Intrinsic)&&this.setIntrinsic(Q.create(this.owner.map))}})],n=[o.ViewRef({extends:!0,didAttachView(e,t){null===this.owner.parent&&e.appendChild(this.owner),super.didAttachView(e,t)},willDetachView(e){super.willDetachView(e),this.owner.parent===e&&e.removeChild(this.owner)}})],l=[o.ViewRef({extends:!0,didAttachView(e,t){const i=d.HtmlView.fromNode(e.node.querySelector(".leaflet-control-container")),s=this.owner.canvas.insertView(e,void 0,i);null!==s&&s.style.zIndex.setIntrinsic(500),super.didAttachView(e,t)},willDetachView(e){super.willDetachView(e);const t=this.owner.canvas.view;null!==t&&t.parent===e&&e.removeChild(e)}})],c(null,null,i,{kind:"field",name:"geoViewport",static:!1,private:!1,access:{has:e=>"geoViewport"in e,get:e=>e.geoViewport,set:(e,t)=>{e.geoViewport=t}}},h,a),c(null,null,n,{kind:"field",name:"canvas",static:!1,private:!1,access:{has:e=>"canvas"in e,get:e=>e.canvas,set:(e,t)=>{e.canvas=t}}},u,a),c(null,null,l,{kind:"field",name:"container",static:!1,private:!1,access:{has:e=>"container"in e,get:e=>e.container,set:(e,t)=>{e.container=t}}},v,a),e})();class ee{constructor(e,t,i,s,n,r){this.projection=e,this.geoFrame=t,this.geoCenter=i,this.zoom=s,this.heading=n,this.tilt=r}project(e,t){const i=this.projection;if(null===i)return u.R2Point.undefined();let s;s="number"==typeof e?new google.maps.LatLng(t,e):Array.isArray(e)?new google.maps.LatLng(e[1],e[0]):new google.maps.LatLng(e.lat,e.lng);const n=i.fromLatLngToContainerPixel(s);return null===n?u.R2Point.undefined():new u.R2Point(n.x,n.y)}unproject(e,t){const s=this.projection;if(null===s)return i.GeoPoint.undefined();let n;n="number"==typeof e?new google.maps.Point(e,t):Array.isArray(e)?new google.maps.Point(e[0],e[1]):new google.maps.Point(e.x,e.y);const r=s.fromContainerPixelToLatLng(n);return null===r?i.GeoPoint.undefined():new i.GeoPoint(r.lng(),r.lat())}equals(e){return this===e||e instanceof ee&&(this.projection===e.projection&&this.geoFrame.equals(e.geoFrame)&&this.geoCenter.equals(e.geoCenter)&&this.zoom===e.zoom&&this.heading===e.heading&&this.tilt===e.tilt)}static create(e,t){void 0===t&&(t=null);const s=e.getBounds();let n;if(null!=s){const e=s.getSouthWest(),t=s.getNorthEast();n=new i.GeoBox(e.lng(),e.lat(),t.lng(),t.lat())}else n=i.GeoBox.undefined();const r=e.getCenter(),o=void 0!==r?new i.GeoPoint(r.lng(),r.lat()):i.GeoPoint.origin();let l=e.getZoom();void 0===l&&(l=0);let a=e.getHeading();void 0===a&&(a=0);let h=e.getTilt();return void 0===h&&(h=0),new ee(t,n,o,l,a,h)}}let te=(()=>{var e;let i,n,r,l,a=[],h=[],u=[],v=[],w=[];return e=class e extends H{constructor(e){super(),this.map=void p(this,h),this.geoViewport=p(this,u,void 0),this.canvas=p(this,v,void 0),this.container=p(this,w,void 0),this.map=e,this.mapOverlay=this.createMapOverlay(e),this.geoViewport.value=ee.create(e,this.mapOverlay.getProjection()),this.onMapDraw=this.onMapDraw.bind(this),this.onMapIdle=this.onMapIdle.bind(this),this.initMap(e)}initMap(e){e.addListener("idle",this.onMapIdle)}createMapOverlay(t){const i=new e.MapOverlay(this);return i.setMap(t),i}static get MapOverlay(){return class extends google.maps.OverlayView{constructor(e){super(),this.owner=e}onAdd(){const e=this.owner.container.view;null!==e&&this.owner.container.materializeView(e)}onRemove(){this.owner.canvas.removeView()}draw(){this.owner.onMapDraw()}}}willProcess(e){this.geoViewport.update(),super.willProcess(e)}onMapDraw(){this.geoViewport.update()}onMapIdle(){this.requireUpdate(o.View.NeedsProject)}moveTo(e,i){const s=this.geoViewport.value;if(null===s)return;const n=(e=g.fromLike(e)).geoCenter;null===n||s.geoCenter.equivalentTo(n,1e-5)||this.map.panTo(n);const r=e.zoom;void 0===r||t.Equivalent(s.zoom,r,1e-5)||this.map.setZoom(r);const o=e.heading;void 0===o||t.Equivalent(s.heading,o,1e-5)||this.map.setHeading(o);const l=e.tilt;void 0===l||t.Equivalent(s.tilt,l,1e-5)||this.map.setTilt(l)}},i=[t.Lazy],n=[s.Property({extends:!0,didSetValue(e,t){super.didSetValue(e,t);const i=!this.owner.hidden&&!this.owner.culled;this.owner.requireUpdate(o.View.NeedsProject,i)},update(){this.hasAffinity(s.Affinity.Intrinsic)&&this.setIntrinsic(ee.create(this.owner.map,this.owner.mapOverlay.getProjection()))}})],r=[o.ViewRef({extends:!0,didAttachView(e,t){null===this.owner.parent&&e.appendChild(this.owner),super.didAttachView(e,t)},willDetachView(e){super.willDetachView(e),this.owner.parent===e&&e.removeChild(this.owner)}})],l=[o.ViewRef({extends:!0,didAttachView(e,t){this.materializeView(e),super.didAttachView(e,t)},willDetachView(e){super.willDetachView(e);const t=this.owner.canvas.view,i=this.owner.mapOverlay.getPanes();if(null===t||null==i)return;const s=d.HtmlView.get(i.overlayMouseTarget),n=null!==s?s.parent:null,r=null!==n?n.parent:null;null!==r&&t.parent===r&&r.removeChild(e)},materializeView(e){const t=this.owner.mapOverlay.getPanes();if(null!=t){!function e(t){const i=t.parentNode;return i instanceof HTMLElement&&null===d.HtmlView.get(i)&&e(i),d.HtmlView.fromNode(t)}(t.overlayMouseTarget);const e=d.HtmlView.get(t.overlayMouseTarget),i=null!==e?e.parent:null,s=null!==i?i.parent:null;this.owner.canvas.insertView(s)}else null===this.owner.canvas.view&&this.owner.canvas.attachView()}})],c(e,null,i,{kind:"getter",name:"MapOverlay",static:!0,private:!1,access:{has:e=>"MapOverlay"in e,get:e=>e.MapOverlay}},null,a),c(null,null,n,{kind:"field",name:"geoViewport",static:!1,private:!1,access:{has:e=>"geoViewport"in e,get:e=>e.geoViewport,set:(e,t)=>{e.geoViewport=t}}},u,h),c(null,null,r,{kind:"field",name:"canvas",static:!1,private:!1,access:{has:e=>"canvas"in e,get:e=>e.canvas,set:(e,t)=>{e.canvas=t}}},v,h),c(null,null,l,{kind:"field",name:"container",static:!1,private:!1,access:{has:e=>"container"in e,get:e=>e.container,set:(e,t)=>{e.container=t}}},w,h),p(e,a),e})();class ie{constructor(e,t,i,s,n,r){this.map=e,this.geoFrame=t,this.geoCenter=i,this.zoom=s,this.heading=n,this.tilt=r}equals(e){return this===e||e instanceof ie&&(this.map===e.map&&this.geoFrame.equals(e.geoFrame)&&this.geoCenter.equals(e.geoCenter)&&this.zoom===e.zoom&&this.heading===e.heading&&this.tilt===e.tilt)}static init(){void 0===ie.webMercatorUtils&&window.require(["esri/geometry/support/webMercatorUtils"],(function(e){ie.webMercatorUtils=e}))}}ie.webMercatorUtils=void 0;class se extends H{constructor(){super(),ie.init()}}class ne extends ie{constructor(e,t,i,s,n,r){super(e,t,i,s,n,r)}project(e,t){let i;i="number"==typeof e?{x:e,y:t,spatialReference:{wkid:4326}}:Array.isArray(e)?{x:e[0],y:e[1],spatialReference:{wkid:4326}}:{x:e.lng,y:e.lat,spatialReference:{wkid:4326}};const s=this.map.toScreen(i);return null!==s?new u.R2Point(s.x,s.y):u.R2Point.origin()}unproject(e,t){let s;s="number"==typeof e?{x:e,y:t}:Array.isArray(e)?{x:e[0],y:e[1]}:e;const n=this.map.toMap(s);return null!==n?new i.GeoPoint(n.longitude,n.latitude):i.GeoPoint.origin()}static create(e){let t,s=e.extent;null===s?t=i.GeoBox.undefined():(s=ie.webMercatorUtils.webMercatorToGeographic(s,!1),t=new i.GeoBox(s.xmin,s.ymin,s.xmax,s.ymax));const n=e.center,r=new i.GeoPoint(n.longitude,n.latitude),o=e.zoom,l=e.rotation;return new ne(e,t,r,o,l,0)}}let re=(()=>{var e;let i,n,l,a=[],h=[],u=[],v=[];return e=class extends se{constructor(e){super(),this.map=void p(this,a),this.geoViewport=p(this,h,void 0),this.canvas=p(this,u,void 0),this.container=p(this,v,void 0),this.map=e,this.geoViewport.value=ne.create(e),this.onMapRender=this.onMapRender.bind(this),this.initMap(e)}initMap(e){e.watch("extent",this.onMapRender)}onMapRender(){this.geoViewport.update()}moveTo(e,i){const s=this.geoViewport.value;if(null===s)return;const n={},o={},l=(e=g.fromLike(e)).geoCenter;null===l||s.geoCenter.equivalentTo(l,1e-5)||(n.center=[l.lng,l.lat]);const a=e.zoom;void 0===a||t.Equivalent(s.zoom,a,1e-5)||(n.zoom=a);const h=e.heading;void 0===h||t.Equivalent(s.heading,h,1e-5)||(n.heading=h);const u=e.tilt;void 0===u||t.Equivalent(s.tilt,u,1e-5)||(n.tilt=u),(i=void 0===i||!0===i?this.getLookOr(r.Look.timing,r.Mood.ambient,!1):t.Timing.fromLike(i))instanceof t.Timing?o.duration=i.duration:o.duration=0,this.map.goTo(n,o)}},i=[s.Property({extends:!0,didSetValue(e,t){super.didSetValue(e,t);const i=!this.owner.hidden&&!this.owner.culled;this.owner.requireUpdate(o.View.NeedsProject,i)},update(){this.hasAffinity(s.Affinity.Intrinsic)&&this.setIntrinsic(ne.create(this.owner.map))}})],n=[o.ViewRef({extends:!0,didAttachView(e,t){null===this.owner.parent&&(e.appendChild(this.owner),e.setEventTarget(this.owner.map.container.querySelector(".esri-view-root"))),super.didAttachView(e,t)},willDetachView(e){super.willDetachView(e),this.owner.parent===e&&e.removeChild(this.owner)}})],l=[o.ViewRef({extends:!0,didAttachView(e,t){const i=d.HtmlView.fromNode(this.owner.map.container),s=d.HtmlView.fromNode(i.node.querySelector(".esri-view-root")),n=d.HtmlView.fromNode(s.node.querySelector(".esri-overlay-surface"));this.owner.canvas.insertView(n),super.didAttachView(e,t)},willDetachView(e){super.willDetachView(e);const t=this.owner.canvas.view,i=d.HtmlView.fromNode(this.owner.map.container),s=d.HtmlView.fromNode(i.node.querySelector(".esri-view-root")),n=d.HtmlView.fromNode(s.node.querySelector(".esri-overlay-surface"));null!==t&&t.parent===n&&n.removeChild(e)}})],c(null,null,i,{kind:"field",name:"geoViewport",static:!1,private:!1,access:{has:e=>"geoViewport"in e,get:e=>e.geoViewport,set:(e,t)=>{e.geoViewport=t}}},h,a),c(null,null,n,{kind:"field",name:"canvas",static:!1,private:!1,access:{has:e=>"canvas"in e,get:e=>e.canvas,set:(e,t)=>{e.canvas=t}}},u,a),c(null,null,l,{kind:"field",name:"container",static:!1,private:!1,access:{has:e=>"container"in e,get:e=>e.container,set:(e,t)=>{e.container=t}}},v,a),e})();class oe extends ie{constructor(e,t,i,s,n,r){super(e,t,i,s,n,r)}project(e,t){let i;i="number"==typeof e?{x:e,y:t,spatialReference:{wkid:4326}}:Array.isArray(e)?{x:e[0],y:e[1],spatialReference:{wkid:4326}}:{x:e.lng,y:e.lat,spatialReference:{wkid:4326}};const s=this.map.toScreen(i);return null!==s?new u.R2Point(s.x,s.y):u.R2Point.origin()}unproject(e,t){let s;s="number"==typeof e?{x:e,y:t}:Array.isArray(e)?{x:e[0],y:e[1]}:e;const n=this.map.toMap(s);return null!==n?new i.GeoPoint(n.longitude,n.latitude):i.GeoPoint.origin()}static create(e){let t,s=e.extent;null===s?t=i.GeoBox.undefined():(s=ie.webMercatorUtils.webMercatorToGeographic(s,!1),t=new i.GeoBox(s.xmin,s.ymin,s.xmax,s.ymax));const n=e.center,r=new i.GeoPoint(n.longitude,n.latitude),o=e.zoom,l=e.camera.heading,a=e.camera.tilt;return new oe(e,t,r,o,l,a)}}let le=(()=>{var e;let i,n,l,a=[],h=[],u=[],v=[];return e=class extends se{constructor(e){super(),this.map=void p(this,a),this.geoViewport=p(this,h,void 0),this.canvas=p(this,u,void 0),this.container=p(this,v,void 0),this.map=e,this.geoViewport.value=oe.create(e),this.onMapRender=this.onMapRender.bind(this),this.initMap(e)}initMap(e){e.watch("extent",this.onMapRender)}onMapRender(){this.geoViewport.update()}moveTo(e,i){const s=this.geoViewport.value;if(null===s)return;const n={},o={},l=(e=g.fromLike(e)).geoCenter;null===l||s.geoCenter.equivalentTo(l,1e-5)||(n.center=[l.lng,l.lat]);const a=e.zoom;void 0===a||t.Equivalent(s.zoom,a,1e-5)||(n.zoom=a);const h=e.heading;void 0===h||t.Equivalent(s.heading,h,1e-5)||(n.heading=h);const u=e.tilt;void 0===u||t.Equivalent(s.tilt,u,1e-5)||(n.tilt=u),(i=void 0===i||!0===i?this.getLookOr(r.Look.timing,r.Mood.ambient,!1):t.Timing.fromLike(i))instanceof t.Timing?o.duration=i.duration:o.duration=0,this.map.goTo(n,o)}},i=[s.Property({extends:!0,didSetValue(e,t){super.didSetValue(e,t);const i=!this.owner.hidden&&!this.owner.culled;this.owner.requireUpdate(o.View.NeedsProject,i)},update(){this.hasAffinity(s.Affinity.Intrinsic)&&this.setIntrinsic(oe.create(this.owner.map))}})],n=[o.ViewRef({extends:!0,didAttachView(e,t){null===this.owner.parent&&(e.appendChild(this.owner),e.setEventTarget(this.owner.map.container.querySelector(".esri-view-root"))),super.didAttachView(e,t)},willDetachView(e){super.willDetachView(e),this.owner.parent===e&&e.removeChild(this.owner)}})],l=[o.ViewRef({extends:!0,didAttachView(e,t){const i=d.HtmlView.fromNode(this.owner.map.container),s=d.HtmlView.fromNode(i.node.querySelector(".esri-view-root")),n=d.HtmlView.fromNode(s.node.querySelector(".esri-view-surface"));this.owner.canvas.insertView(n),super.didAttachView(e,t)},willDetachView(e){super.willDetachView(e);const t=this.owner.canvas.view,i=d.HtmlView.fromNode(this.owner.map.container),s=d.HtmlView.fromNode(i.node.querySelector(".esri-view-root")),n=d.HtmlView.fromNode(s.node.querySelector(".esri-view-surface"));null!==t&&t.parent===n&&n.removeChild(e)}})],c(null,null,i,{kind:"field",name:"geoViewport",static:!1,private:!1,access:{has:e=>"geoViewport"in e,get:e=>e.geoViewport,set:(e,t)=>{e.geoViewport=t}}},h,a),c(null,null,n,{kind:"field",name:"canvas",static:!1,private:!1,access:{has:e=>"canvas"in e,get:e=>e.canvas,set:(e,t)=>{e.canvas=t}}},u,a),c(null,null,l,{kind:"field",name:"container",static:!1,private:!1,access:{has:e=>"container"in e,get:e=>e.container,set:(e,t)=>{e.container=t}}},v,a),e})();e.EquirectangularMapViewport=X,e.EsriMapView=re,e.EsriMapViewport=ne,e.EsriSceneView=le,e.EsriSceneViewport=oe,e.EsriView=se,e.EsriViewport=ie,e.GeoArcView=E,e.GeoCircleView=O,e.GeoController=V,e.GeoFeatureController=k,e.GeoFeatureTrait=x,e.GeoFeatureView=T,e.GeoIconController=q,e.GeoIconTrait=z,e.GeoIconView=j,e.GeoLayerController=S,e.GeoLayerTrait=b,e.GeoPerspective=g,e.GeoPerspectiveInit=w,e.GeoPerspectiveLike=v,e.GeoPlotView=N,e.GeoPointView=I,e.GeoRasterView=A,e.GeoRippleView=C,e.GeoShapeController=B,e.GeoShapeTrait=F,e.GeoShapeView=D,e.GeoTileController=W,e.GeoTileTrait=M,e.GeoTileView=G,e.GeoTrait=y,e.GeoTree=R,e.GeoTreeView=P,e.GeoView=f,e.GeoViewport=m,e.GoogleMapView=te,e.GoogleMapViewport=ee,e.LeafletView=$,e.LeafletViewport=Q,e.MapController=K,e.MapTrait=U,e.MapView=H,e.MapboxView=J,e.MapboxViewport=Z,e.WorldMapView=Y,e.WorldMapViewport=_,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
//# sourceMappingURL=swim-maps.min.js.map
