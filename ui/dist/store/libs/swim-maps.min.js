// @swim/maps v4.0.0-dev.20220527.3 (c) 2015-2023 Nstream, inc.
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@swim/core"),require("@swim/core"),require("@swim/core"),require("@swim/ui"),require("@swim/ui"),require("@swim/ui"),require("@swim/ui"),require("@swim/ui"),require("@swim/ui"),require("@swim/core"),require("@swim/ui")):"function"==typeof define&&define.amd?define(["exports","@swim/core","@swim/core","@swim/core","@swim/ui","@swim/ui","@swim/ui","@swim/ui","@swim/ui","@swim/ui","@swim/core","@swim/ui"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).swim=e.swim||{},e.swim,e.swim,e.swim,e.swim,e.swim,e.swim,e.swim,e.swim,e.swim,e.swim,e.swim)}(this,(function(e,t,i,n,s,r,o,a,l,h,u,d){"use strict";function c(e,t,i,n,s,r){function o(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var a,l=n.kind,h="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?n.static?e:e.prototype:null,d=t||(u?Object.getOwnPropertyDescriptor(u,n.name):{}),c=!1,p=i.length-1;p>=0;p--){var v={};for(var w in n)v[w]="access"===w?{}:n[w];for(var w in n.access)v.access[w]=n.access[w];v.addInitializer=function(e){if(c)throw new TypeError("Cannot add initializers after decoration has completed");r.push(o(e||null))};var m=(0,i[p])("accessor"===l?{get:d.get,set:d.set}:d[h],v);if("accessor"===l){if(void 0===m)continue;if(null===m||"object"!=typeof m)throw new TypeError("Object expected");(a=o(m.get))&&(d.get=a),(a=o(m.set))&&(d.set=a),(a=o(m.init))&&s.unshift(a)}else(a=o(m))&&("field"===l?s.unshift(a):d[h]=a)}u&&Object.defineProperty(u,n.name,d),c=!0}function p(e,t,i){for(var n=arguments.length>2,s=0;s<t.length;s++)i=n?t[s].call(e,i):t[s].call(e);return n?i:void 0}"function"==typeof SuppressedError&&SuppressedError;const v={[Symbol.hasInstance]:e=>m[Symbol.hasInstance](e)||e instanceof i.GeoShape||w[Symbol.hasInstance](e)||i.GeoBoxInit[Symbol.hasInstance](e)},w={[Symbol.hasInstance]:e=>t.Objects.hasAnyKey(e,"geoFrame","geoCenter")},m={fromLike:e=>null==e||m[Symbol.hasInstance](e)?e:e instanceof i.GeoShape||i.GeoBoxLike[Symbol.hasInstance](e)?{geoFrame:i.GeoBox.fromLike(e),geoCenter:null,zoom:void 0,heading:void 0,tilt:void 0}:{geoFrame:void 0!==e.geoFrame&&null!==e.geoFrame?i.GeoBox.fromLike(e.geoFrame):null,geoCenter:void 0!==e.geoCenter&&null!==e.geoCenter?i.GeoPoint.fromLike(e.geoCenter):null,zoom:e.zoom,heading:e.heading,tilt:e.tilt},[Symbol.hasInstance]:e=>t.Objects.hasAllKeys(e,"geoFrame","geoCenter","zoom","heading","tilt")},g={[Symbol.hasInstance]:e=>i.GeoProjection[Symbol.hasInstance](e)&&m[Symbol.hasInstance](e)};let f=(()=>{var e;let t,l,h=a.GraphicsView,u=[],d=[];return e=class extends h{constructor(){super(),this.geoViewport=(p(this,u),p(this,d,void 0)),this.geoBounds=i.GeoBox.undefined()}get geoBoundsColor(){return r.ThemeAnimator.getter()}didInsertChild(t,i){t instanceof e&&this.onInsertChildGeoBounds(t,t.geoBounds),super.didInsertChild(t,i)}didRemoveChild(t){t instanceof e&&this.onRemoveChildGeoBounds(t,t.geoBounds),super.didRemoveChild(t)}onRender(){super.onRender();const e=r.ThemeAnimator.tryValue(this,"geoBoundsColor");null!==e&&this.renderGeoBounds(e,1)}renderGeoBounds(e,t){const i=this.renderer.value;i instanceof a.PaintingRenderer&&!this.hidden&&!this.culled&&!this.unbounded&&this.renderGeoOutline(this.geoBounds,i.context,e,t)}renderGeoOutline(e,t,i,n){const s=this.geoViewport.value;if(!e.isDefined()||null===s)return;const r=t.lineWidth,o=t.strokeStyle,a=s.project(e.southWest.normalized()),l=s.project(e.northWest.normalized()),h=s.project(e.northEast.normalized()),u=s.project(e.southEast.normalized());t.beginPath(),t.moveTo(a.x,a.y),t.lineTo(l.x,l.y),t.lineTo(h.x,h.y),t.lineTo(u.x,u.y),t.closePath(),t.lineWidth=n,t.strokeStyle=i.toString(),t.stroke(),t.lineWidth=r,t.strokeStyle=o}onHide(){super.onHide();const t=this.parent;t instanceof e&&t.onHideChild(this)}onUnhide(){super.onUnhide();const t=this.parent;t instanceof e&&t.onUnhideChild(this)}onSetUnbounded(t){const i=this.parent;i instanceof e&&i.onSetChildUnbounded(this,t)}cullGeoFrame(e=this.geoFrame){this.setCulled(!e.intersects(this.geoBounds))}get geoFrame(){const t=this.parent;return t instanceof e?t.geoFrame:i.GeoBox.globe()}setGeoBounds(e){const t=this.geoBounds;t.equals(e)||(this.willSetGeoBounds(e,t),this.geoBounds=e,this.onSetGeoBounds(e,t),this.didSetGeoBounds(e,t))}willSetGeoBounds(e,t){this.callObservers("viewWillSetGeoBounds",e,t,this)}onSetGeoBounds(t,i){if(this.unbounded)return;const n=this.parent;n instanceof e&&n.onSetChildGeoBounds(this,t,i)}didSetGeoBounds(e,t){this.callObservers("viewDidSetGeoBounds",e,t,this)}updateGeoBounds(){this.setGeoBounds(this.deriveGeoBounds())}onInsertChildGeoBounds(e,t){this.updateGeoBounds()}onRemoveChildGeoBounds(e,t){this.updateGeoBounds()}onSetChildGeoBounds(e,t,i){this.updateGeoBounds()}onHideChild(e){this.updateGeoBounds()}onUnhideChild(e){this.updateGeoBounds()}onSetChildUnbounded(e,t){this.updateGeoBounds()}get ownGeoBounds(){return null}deriveGeoBounds(){let t=this.ownGeoBounds,i=this.firstChild;for(;null!==i;){if(i instanceof e&&!i.hidden&&!i.unbounded){const e=i.geoBounds;e.isDefined()&&(t=null!==t?t.union(e):e)}i=i.nextSibling}return null===t&&(t=this.geoFrame),t}},(()=>{var i;const o="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(i=h[Symbol.metadata])&&void 0!==i?i:null):void 0;t=[r.ThemeAnimator({valueType:s.Color,value:null,inherits:!0})],l=[n.Property({valueType:g,value:null,inherits:!0})],c(e,null,t,{kind:"getter",name:"geoBoundsColor",static:!1,private:!1,access:{has:e=>"geoBoundsColor"in e,get:e=>e.geoBoundsColor},metadata:o},null,u),c(null,null,l,{kind:"field",name:"geoViewport",static:!1,private:!1,access:{has:e=>"geoViewport"in e,get:e=>e.geoViewport,set:(e,t)=>{e.geoViewport=t}},metadata:o},d,u),o&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:o})})(),e.MountFlags=a.GraphicsView.MountFlags|o.View.NeedsProject,e.UncullFlags=a.GraphicsView.UncullFlags|o.View.NeedsProject,e})(),y=(()=>{var e;let t,i=l.Trait,s=[],r=[];return e=class extends i{constructor(){super(...arguments),this.geoPerspective=(p(this,s),p(this,r,void 0))}createGeoController(){return new b}},(()=>{var o;const a="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(o=i[Symbol.metadata])&&void 0!==o?o:null):void 0;t=[n.Property({valueType:m,value:null,didSetValue(e){this.owner.callObservers("traitDidSetGeoPerspective",e,this.owner)}})],c(null,null,t,{kind:"field",name:"geoPerspective",static:!1,private:!1,access:{has:e=>"geoPerspective"in e,get:e=>e.geoPerspective,set:(e,t)=>{e.geoPerspective=t}},metadata:a},r,s),a&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:a})})(),e})(),b=(()=>{var e;let t,i,s=h.Controller,r=[],a=[],l=[];return e=class extends s{constructor(){super(...arguments),this.geoPerspective=(p(this,r),p(this,a,void 0)),this.geo=p(this,l,void 0)}},(()=>{var u;const d="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(u=s[Symbol.metadata])&&void 0!==u?u:null):void 0;t=[n.Property({valueType:m,value:null,didSetValue(e){this.owner.callObservers("controllerDidSetGeoPerspective",e,this.owner)}})],i=[h.TraitViewRef({traitType:y,willAttachTrait(e){this.owner.callObservers("controllerWillAttachGeoTrait",e,this.owner)},initTrait(e){this.owner.geoPerspective.bindInlet(e.geoPerspective)},deinitTrait(e){this.owner.geoPerspective.unbindInlet(e.geoPerspective)},didDetachTrait(e){this.owner.callObservers("controllerDidDetachGeoTrait",e,this.owner)},viewType:f,willAttachView(e){e.requireUpdate(o.View.NeedsProject),this.owner.callObservers("controllerWillAttachGeoView",e,this.owner)},didDetachView(e){this.owner.callObservers("controllerDidDetachGeoView",e,this.owner)}})],c(null,null,t,{kind:"field",name:"geoPerspective",static:!1,private:!1,access:{has:e=>"geoPerspective"in e,get:e=>e.geoPerspective,set:(e,t)=>{e.geoPerspective=t}},metadata:d},a,r),c(null,null,i,{kind:"field",name:"geo",static:!1,private:!1,access:{has:e=>"geo"in e,get:e=>e.geo,set:(e,t)=>{e.geo=t}},metadata:d},l,r),d&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:d})})(),e})(),V=(()=>{var e;let l,h,d,v,w,m,g=f,y=[],b=[],V=[],C=[],T=[],S=[],x=[];return e=class extends g{constructor(){super(),this.geoCenter=(p(this,y),p(this,b,void 0)),this.viewCenter=p(this,V,void 0),this.radius=p(this,C,void 0),this.stroke=p(this,T,void 0),this.strokeWidth=p(this,S,void 0),this.source=p(this,x,void 0),Object.defineProperty(this,"viewBounds",{value:u.R2Box.undefined(),writable:!0,enumerable:!0,configurable:!0}),this.setFlags(this.flags|o.View.UnboundedFlag)}onProject(){super.onProject(),this.projectRipple()}projectGeoCenter(e){const t=this.geoViewport.value;if(!this.mounted||null===t)return;const i=null!==e&&e.isDefined()?t.project(e):null;this.viewCenter.setInterpolatedValue(this.viewCenter.value,i),this.projectRipple()}projectRipple(){const e=this.geoViewport.value;if(!this.viewCenter.hasAffinity(n.Affinity.Intrinsic)||null===e)return;const t=this.geoCenter.value,i=null!==t&&t.isDefined()?e.project(t):null;this.viewCenter.setIntrinsic(i)}onRender(){super.onRender();const e=this.renderer.value;e instanceof a.PaintingRenderer&&!this.hidden&&!this.culled&&this.renderRipple(e.context,this.viewFrame)}renderRipple(e,t){const i=this.viewCenter.value;if(null===i||!i.isDefined())return;const n=Math.min(t.width,t.height),s=this.radius.getValue().pxValue(n),r=this.stroke.value;if(null===r)return;const o=e.lineWidth,a=e.strokeStyle;e.beginPath(),e.arc(i.x,i.y,s,0,2*Math.PI);const l=this.strokeWidth.value;null!==l&&(e.lineWidth=l.pxValue(n)),e.strokeStyle=r.toString(),e.stroke(),e.lineWidth=o,e.strokeStyle=a}renderGeoBounds(e,t){}updateGeoBounds(){}updateViewBounds(){this.viewBounds=this.deriveViewBounds()}deriveViewBounds(){const e=this.viewCenter.value;return null!==e&&e.isDefined()?e.bounds:u.R2Box.undefined()}ripple(e){let n,o,a,l,h,d;n=void 0===e||void 0===e.source?null:e.source,o=void 0===e||void 0===e.center||null===e.center?null:i.GeoPoint.fromLike(e.center),a=void 0===e||void 0===e.width||null===e.width?null:u.Length.fromLike(e.width),l=void 0===e||void 0===e.radius||null===e.radius?u.Length.pct(12.5):u.Length.fromLike(e.radius),h=void 0===e||void 0===e.color||null===e.color?this.getLookOr(r.Look.accentColor,null):e.color instanceof r.Look?this.getLookOr(e.color,null):s.Color.fromLike(e.color),d=void 0===e||void 0===e.timing||!0===e.timing?this.getLookOr(r.Look.timing,r.Mood.ambient,!1):"number"==typeof e.timing?t.Easing.linear.withDuration(e.timing):t.Timing.fromLike(e.timing);const c=void 0!==e?e.opacity:void 0;return null!==n&&this.source.setView(n),null!==o&&this.geoCenter.setIntrinsic(o),null!==a&&this.strokeWidth.setIntrinsic(a),this.radius.set(l,d),null!==h&&(this.stroke.set(void 0!==c?h.alpha(c):h),this.stroke.set(h.alpha(0),d)),this}static ripple(t,i){let n;if(document.hidden||t.hidden||t.culled||null===(n=t.geoViewport.value)||!t.geoBounds.intersects(n.geoFrame))return null;const s=e.create();s.source.setView(t);let r=t.getRoot(f);return null===r&&(r=t),r.appendChild(s),s.ripple(i),s}},(()=>{var t;const a="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(t=g[Symbol.metadata])&&void 0!==t?t:null):void 0;l=[n.Animator({valueType:i.GeoPoint,value:null,didSetState(e){this.owner.projectGeoCenter(e)},didSetValue(e){this.owner.setGeoBounds(null!==e?e.bounds:i.GeoBox.undefined()),this.mounted&&this.owner.projectRipple(),this.owner.callObservers("viewDidSetGeoCenter",e,this.owner)}})],h=[n.Animator({valueType:u.R2Point,value:u.R2Point.undefined(),updateFlags:o.View.NeedsRender,didSetValue(e){this.owner.updateViewBounds()}})],d=[r.ThemeAnimator({valueType:u.Length,value:u.Length.zero(),updateFlags:o.View.NeedsRender,didTransition(){this.owner.source.setView(null),this.owner.remove()}})],v=[r.ThemeAnimator({valueType:s.Color,value:null,look:r.Look.accentColor,inherits:!0,updateFlags:o.View.NeedsRender})],w=[r.ThemeAnimator({valueType:u.Length,value:u.Length.px(1),inherits:!0,updateFlags:o.View.NeedsRender})],m=[o.ViewRef({observes:!0,didAttachView(e){this.owner.geoCenter.setIntrinsic(e.geoBounds.center)},viewDidUnmount(e){this.owner.remove()},viewDidSetGeoBounds(e){this.owner.geoCenter.setIntrinsic(e.center)}})],c(null,null,l,{kind:"field",name:"geoCenter",static:!1,private:!1,access:{has:e=>"geoCenter"in e,get:e=>e.geoCenter,set:(e,t)=>{e.geoCenter=t}},metadata:a},b,y),c(null,null,h,{kind:"field",name:"viewCenter",static:!1,private:!1,access:{has:e=>"viewCenter"in e,get:e=>e.viewCenter,set:(e,t)=>{e.viewCenter=t}},metadata:a},V,y),c(null,null,d,{kind:"field",name:"radius",static:!1,private:!1,access:{has:e=>"radius"in e,get:e=>e.radius,set:(e,t)=>{e.radius=t}},metadata:a},C,y),c(null,null,v,{kind:"field",name:"stroke",static:!1,private:!1,access:{has:e=>"stroke"in e,get:e=>e.stroke,set:(e,t)=>{e.stroke=t}},metadata:a},T,y),c(null,null,w,{kind:"field",name:"strokeWidth",static:!1,private:!1,access:{has:e=>"strokeWidth"in e,get:e=>e.strokeWidth,set:(e,t)=>{e.strokeWidth=t}},metadata:a},S,y),c(null,null,m,{kind:"field",name:"source",static:!1,private:!1,access:{has:e=>"source"in e,get:e=>e.source,set:(e,t)=>{e.source=t}},metadata:a},x,y),a&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:a})})(),e})(),C=(()=>{var e;let t,i,s=f,r=[],a=[];return e=class extends s{constructor(){super(...arguments),this.gesture=(p(this,r),p(this,a,void 0))}get hyperlink(){return n.Property.getter()}didPress(e,t){if(e.defaultPrevented)return;this.callObservers("viewDidPress",e,t,this);const i=this.hyperlink.value;null===i||e.defaultPrevented||(e.preventDefault(),i.activate(t))}didLongPress(e){e.defaultPrevented||this.callObservers("viewDidLongPress",e,this)}ripple(e){return V.ripple(this,e)}},(()=>{var l;const u="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(l=s[Symbol.metadata])&&void 0!==l?l:null):void 0;t=[n.Property({valueType:h.Hyperlink,value:null})],i=[o.PositionGesture({bindsOwner:!0,didMovePress(e,t){const i=e.x-e.x0,n=e.y-e.y0;i*i+n*n>16&&this.cancelPress(e,t)},didStartHovering(){this.owner.callObservers("viewDidEnter",this.owner)},didStopHovering(){this.owner.callObservers("viewDidLeave",this.owner)},didPress(e,t){e.defaultPrevented||this.owner.didPress(e,t)},didLongPress(e){e.defaultPrevented||this.owner.didLongPress(e)}})],c(e,null,t,{kind:"getter",name:"hyperlink",static:!1,private:!1,access:{has:e=>"hyperlink"in e,get:e=>e.hyperlink},metadata:u},null,r),c(null,null,i,{kind:"field",name:"gesture",static:!1,private:!1,access:{has:e=>"gesture"in e,get:e=>e.gesture,set:(e,t)=>{e.gesture=t}},metadata:u},a,r),u&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:u})})(),e})(),T=(()=>{var e;let t,i=y,s=[];return e=class extends i{get hyperlink(){return n.Property.getter()}createGeoController(){return new S}constructor(){super(...arguments),p(this,s)}},(()=>{var r;const o="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(r=i[Symbol.metadata])&&void 0!==r?r:null):void 0;t=[n.Property({valueType:h.Hyperlink,value:null})],c(e,null,t,{kind:"getter",name:"hyperlink",static:!1,private:!1,access:{has:e=>"hyperlink"in e,get:e=>e.hyperlink},metadata:o},null,s),o&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:o})})(),e})(),S=(()=>{var e;let t,i,s,r,o,a,l,u=b,d=[],v=[],w=[],m=[],g=[];return e=class extends u{constructor(){super(...arguments),this.intersectsViewport=(p(this,d),p(this,v,void 0)),this.visible=p(this,w,void 0),this.consumable=p(this,m,void 0),this.geo=p(this,g,void 0)}get visibleRange(){return n.Property.getter()}get consumeRange(){return n.Property.getter()}get hyperlink(){return n.Property.getter()}},(()=>{var p;const f="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(p=u[Symbol.metadata])&&void 0!==p?p:null):void 0;t=[n.Property({inherits:!0,value:[0,1/0],didSetValue(e){this.owner.visible.decohere()},setMin(e,t){this.setValue([e,this.value[1]],t)},setMax(e,t){this.setValue([this.value[0],e],t)}})],i=[n.Property({inherits:!0,value:[0,1/0],didSetValue(e){this.owner.consumable.decohere()},setMin(e,t){this.setValue([e,this.value[1]],t)},setMax(e,t){this.setValue([this.value[0],e],t)}})],s=[n.Property({valueType:Boolean,value:!1,inletKeys:[],deriveValue(){let e,t;return!(!this.owner.mounted||null===(e=this.owner.geo.view)||null===(t=e.geoViewport.value))&&t.geoFrame.intersects(e.geoBounds)}})],r=[n.Property({valueType:Boolean,value:!1,inletKeys:["intersectsViewport"],deriveValue(e){let t,i;if(!this.owner.mounted||null===(t=this.owner.geo.view)||null===(i=t.geoViewport.value))return!1;const[n,s]=this.owner.visibleRange.value;return e&&i.zoom>=n&&i.zoom<s},didSetValue(e){const t=this.owner.geo.view;null!==t&&t.setCulled(!e)}})],o=[n.Property({valueType:Boolean,value:!1,inletKeys:["intersectsViewport"],deriveValue(e){let t,i;if(!this.owner.mounted||null===(t=this.owner.geo.view)||null===(i=t.geoViewport.value))return!1;const[n,s]=this.owner.consumeRange.value;return e&&i.zoom>=n&&i.zoom<s},didSetValue(e){const t=this.owner.geo.view;null!==t&&(e?this.owner.consume(t):this.owner.unconsume(t))}})],a=[h.TraitViewRef({extends:!0,traitType:T,initTrait(e){this.owner.hyperlink.bindInlet(e.hyperlink)},deinitTrait(e){this.owner.hyperlink.unbindInlet(e.hyperlink)},viewType:C,observesView:!0,willAttachView(e){e.setCulled(!0),super.willAttachView(e)},initView(e){super.initView(e),e.hyperlink.bindInlet(this.owner.hyperlink)},deinitView(e){e.hyperlink.unbindInlet(this.owner.hyperlink),super.deinitView(e)},viewDidProject(e){this.owner.intersectsViewport.decohere(),this.owner.visible.decohere(),this.owner.consumable.decohere()},viewDidEnter(e){this.owner.callObservers("controllerDidEnterGeoView",e,this.owner)},viewDidLeave(e){this.owner.callObservers("controllerDidLeaveGeoView",e,this.owner)},viewDidPress(e,t,i){this.owner.callObservers("controllerDidPressGeoView",e,t,i,this.owner)},viewDidLongPress(e,t){this.owner.callObservers("controllerDidLongPressGeoView",e,t,this.owner)}})],l=[n.Property({valueType:h.Hyperlink,value:null})],c(e,null,t,{kind:"getter",name:"visibleRange",static:!1,private:!1,access:{has:e=>"visibleRange"in e,get:e=>e.visibleRange},metadata:f},null,d),c(e,null,i,{kind:"getter",name:"consumeRange",static:!1,private:!1,access:{has:e=>"consumeRange"in e,get:e=>e.consumeRange},metadata:f},null,d),c(e,null,l,{kind:"getter",name:"hyperlink",static:!1,private:!1,access:{has:e=>"hyperlink"in e,get:e=>e.hyperlink},metadata:f},null,d),c(null,null,s,{kind:"field",name:"intersectsViewport",static:!1,private:!1,access:{has:e=>"intersectsViewport"in e,get:e=>e.intersectsViewport,set:(e,t)=>{e.intersectsViewport=t}},metadata:f},v,d),c(null,null,r,{kind:"field",name:"visible",static:!1,private:!1,access:{has:e=>"visible"in e,get:e=>e.visible,set:(e,t)=>{e.visible=t}},metadata:f},w,d),c(null,null,o,{kind:"field",name:"consumable",static:!1,private:!1,access:{has:e=>"consumable"in e,get:e=>e.consumable,set:(e,t)=>{e.consumable=t}},metadata:f},m,d),c(null,null,a,{kind:"field",name:"geo",static:!1,private:!1,access:{has:e=>"geo"in e,get:e=>e.geo,set:(e,t)=>{e.geo=t}},metadata:f},g,d),f&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:f})})(),e})(),x=(()=>{var e;let t,s,r,o,a=y,h=[],u=[],d=[],v=[];return e=class extends a{constructor(){super(...arguments),this.geoBounds=(p(this,h),p(this,u,void 0)),this.layers=p(this,d,void 0),this.features=p(this,v,void 0)}get nodeUri(){return n.Property.getter()}consumeLayers(){}unconsumeLayers(){}onStartConsuming(){super.onStartConsuming(),this.features.consumeTraits(this),this.consumeLayers()}onStopConsuming(){super.onStopConsuming(),this.features.unconsumeTraits(this)}createGeoController(){return new R}},(()=>{var p;const w="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(p=a[Symbol.metadata])&&void 0!==p?p:null):void 0;t=[n.Property({extends:!0,inherits:!1})],s=[n.Property({valueType:i.GeoBox,value:null,didSetValue(e){this.owner.callObservers("traitDidSetGeoBounds",e,this.owner),this.owner.geoPerspective.setIntrinsic(e)}})],r=[l.TraitModelSet({get traitType(){return x},traitKey:"layer",modelType:l.Model,binds:!0,willAttachTrait(e){this.owner.callObservers("traitWillAttachLayer",e,this.owner)},didDetachTrait(e){this.owner.callObservers("traitDidDetachLayer",e,this.owner)}})],o=[l.TraitModelSet({traitType:T,traitKey:"feature",modelType:l.Model,binds:!0,willAttachTrait(e){this.owner.callObservers("traitWillAttachFeature",e,this.owner)},didAttachTrait(e){this.owner.consuming&&e.consume(this.owner)},willDetachTrait(e){this.owner.consuming&&e.unconsume(this.owner)},didDetachTrait(e){this.owner.callObservers("traitDidDetachFeature",e,this.owner)}})],c(e,null,t,{kind:"getter",name:"nodeUri",static:!1,private:!1,access:{has:e=>"nodeUri"in e,get:e=>e.nodeUri},metadata:w},null,h),c(null,null,s,{kind:"field",name:"geoBounds",static:!1,private:!1,access:{has:e=>"geoBounds"in e,get:e=>e.geoBounds,set:(e,t)=>{e.geoBounds=t}},metadata:w},u,h),c(null,null,r,{kind:"field",name:"layers",static:!1,private:!1,access:{has:e=>"layers"in e,get:e=>e.layers,set:(e,t)=>{e.layers=t}},metadata:w},d,h),c(null,null,o,{kind:"field",name:"features",static:!1,private:!1,access:{has:e=>"features"in e,get:e=>e.features,set:(e,t)=>{e.features=t}},metadata:w},v,h),w&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:w})})(),e})();class k{constructor(e,t,i,n,s,r,o,a,l,h,u,d){this.depth=e,this.maxDepth=t,this.density=i,this.geoFrame=n,this.geoBounds=s,this.geoCenter=r,this.southWest=o,this.northWest=a,this.southEast=l,this.northEast=h,this.views=u,this.size=d}isEmpty(){return 0===this.size}contains(e){return this.geoFrame.contains(e)}intersects(e){return this.geoFrame.intersects(e)}getTree(e){if(this.depth>=this.maxDepth||this.size<=this.density)return this;const t=this.geoCenter,i=e.lngMin<=t.lng,n=e.latMin<=t.lat,s=e.lngMax>t.lng,r=e.latMax>t.lat;if(i===s||n===r)return this;if(n&&i){const t=this.southWest;if(null!==t)return t.getTree(e)}else if(r&&i){const t=this.northWest;if(null!==t)return t.getTree(e)}else if(n&&s){const t=this.southEast;if(null!==t)return t.getTree(e)}else if(r&&s){const t=this.northEast;if(null!==t)return t.getTree(e)}return this}has(e,t){if(this.depth<this.maxDepth&&this.size>this.density){const i=this.hasNode(e,t);if(void 0!==i)return i}return this.hasLeaf(e,t)}hasNode(e,t){const i=this.geoCenter,n=t.lngMin<=i.lng,s=t.latMin<=i.lat,r=t.lngMax>i.lng,o=t.latMax>i.lat;if(n!==r&&s!==o)if(s&&n){const i=this.southWest;if(null!==i)return i.has(e,t)}else if(o&&n){const i=this.northWest;if(null!==i)return i.has(e,t)}else if(s&&r){const i=this.southEast;if(null!==i)return i.has(e,t)}else if(o&&r){const i=this.northEast;if(null!==i)return i.has(e,t)}}hasLeaf(e,t){return this.views.indexOf(e)>=0}inserted(e,t){let i=this;if(i.depth<i.maxDepth&&i.size>i.density){const n=i.insertedNode(e,t);if(null!==n)return i=n,this!==i&&i.size===i.density+1&&(i=i.reinsertedNode()),i}return i=i.insertedLeaf(e,t),this!==i&&i.depth<i.maxDepth&&i.size===i.density+1&&(i=i.reinsertedNode()),i}insertedNode(e,t){const n=this.geoCenter,s=t.lngMin<=n.lng,r=t.latMin<=n.lat,o=t.lngMax>n.lng,a=t.latMax>n.lat;if(s===o||r===a)return null;if(r&&s){const n=this.southWest;let s=n;return null===s&&(s=this.createTree(this.depth+1,this.maxDepth,this.density,new i.GeoBox(this.geoFrame.lngMin,this.geoFrame.latMin,this.geoCenter.lng,this.geoCenter.lat))),s=s.inserted(e,t),n===s?this:this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,s,this.northWest,this.southEast,this.northEast,this.views,this.size+1)}if(a&&s){const n=this.northWest;let s=n;return null===s&&(s=this.createTree(this.depth+1,this.maxDepth,this.density,new i.GeoBox(this.geoFrame.lngMin,this.geoCenter.lat,this.geoCenter.lng,this.geoFrame.latMax))),s=s.inserted(e,t),n===s?this:this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,s,this.southEast,this.northEast,this.views,this.size+1)}if(r&&o){const n=this.southEast;let s=n;return null===s&&(s=this.createTree(this.depth+1,this.maxDepth,this.density,new i.GeoBox(this.geoCenter.lng,this.geoFrame.latMin,this.geoFrame.lngMax,this.geoCenter.lat))),s=s.inserted(e,t),n===s?this:this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,this.northWest,s,this.northEast,this.views,this.size+1)}if(a&&o){const n=this.northEast;let s=n;return null===s&&(s=this.createTree(this.depth+1,this.maxDepth,this.density,new i.GeoBox(this.geoCenter.lng,this.geoCenter.lat,this.geoFrame.lngMax,this.geoFrame.latMax))),s=s.inserted(e,t),n===s?this:this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,this.northWest,this.southEast,s,this.views,this.size+1)}return null}insertedLeaf(e,t){const i=this.views;if(i.indexOf(e)>=0)return this;const n=i.slice(0);return n.push(e),this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,this.northWest,this.southEast,this.northEast,n,this.size+1)}removed(e,t){let i=this;if(i.depth<i.maxDepth&&i.size>i.density){const n=i.removedNode(e,t);if(null!==n)return i=n,this!==i&&i.size===i.density&&(i=i.reinsertedLeaf()),i}return i=i.removedLeaf(e,t),this!==i&&i.size===i.density&&(i=i.reinsertedLeaf()),i}removedNode(e,t){const i=this.geoCenter,n=t.lngMin<=i.lng,s=t.latMin<=i.lat,r=t.lngMax>i.lng,o=t.latMax>i.lat;if(n===r||s===o)return null;if(s&&n){const i=this.southWest;if(null===i)return this;let n=i.removed(e,t);return n.isEmpty()&&(n=null),this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,n,this.northWest,this.southEast,this.northEast,this.views,this.size-1)}if(o&&n){const i=this.northWest;if(null===i)return this;let n=i.removed(e,t);return n.isEmpty()&&(n=null),this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,n,this.southEast,this.northEast,this.views,this.size-1)}if(s&&r){const i=this.southEast;if(null===i)return this;let n=i.removed(e,t);return n.isEmpty()&&(n=null),this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,this.northWest,n,this.northEast,this.views,this.size-1)}if(o&&r){const i=this.northEast;if(null===i)return this;let n=i.removed(e,t);return n.isEmpty()&&(n=null),this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,this.northWest,this.southEast,n,this.views,this.size-1)}return null}removedLeaf(e,t){const i=this.views,n=i.indexOf(e);if(n<0)return this;const s=i.slice(0);return s.splice(n,1),this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,this.northWest,this.southEast,this.northEast,s,this.size-1)}reinsertedNode(){let e=this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter);return this.forEach((function(t){const i=t.geoBounds,n=e.insertedNode(t,i);e=null!==n?n:e.insertedLeaf(t,i)}),this),e}reinsertedLeaf(){let e=this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter);return this.forEach((function(t){e=e.insertedLeaf(t,t.geoBounds)}),this),e}moved(e,t,i){if(this.depth>=this.maxDepth||this.size<=this.density)return this;const n=this.geoCenter,s=t.lngMin<=n.lng,r=t.latMin<=n.lat,o=t.lngMax>n.lng,a=t.latMax>n.lat,l=i.lngMin<=n.lng,h=i.latMin<=n.lat,u=i.lngMax>n.lng,d=i.latMax>n.lat;if(s!==l||r!==h||o!==u||a!==d)return this.removed(e,i).inserted(e,t);if(s===o||r===a)return this;if(r&&s){const n=this.southWest,s=n.moved(e,t,i);return n===s?this:this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,s,this.northWest,this.southEast,this.northEast,this.views,this.size)}if(a&&s){const n=this.northWest,s=n.moved(e,t,i);return n===s?this:this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,s,this.southEast,this.northEast,this.views,this.size)}if(r&&o){const n=this.southEast,s=n.moved(e,t,i);return n===s?this:this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,this.northWest,s,this.northEast,this.views,this.size)}if(a&&o){const n=this.northEast,s=n.moved(e,t,i);return n===s?this:this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,this.northWest,this.southEast,s,this.views,this.size)}return this}forEach(e,t){if(null!==this.southWest){const i=this.southWest.forEach(e,t);if(void 0!==i)return i}if(null!==this.northWest){const i=this.northWest.forEach(e,t);if(void 0!==i)return i}if(null!==this.southEast){const i=this.southEast.forEach(e,t);if(void 0!==i)return i}if(null!==this.northEast){const i=this.northEast.forEach(e,t);if(void 0!==i)return i}const i=this.views;for(let n=0;n<i.length;n+=1){const s=e.call(t,i[n]);if(void 0!==s)return s}}forEachReverse(e,t){const i=this.views;for(let n=i.length-1;n>=0;n-=1){const s=e.call(t,i[n]);if(void 0!==s)return s}if(null!==this.northEast){const i=this.northEast.forEachReverse(e,t);if(void 0!==i)return i}if(null!==this.southEast){const i=this.southEast.forEachReverse(e,t);if(void 0!==i)return i}if(null!==this.northWest){const i=this.northWest.forEachReverse(e,t);if(void 0!==i)return i}if(null!==this.southWest){const i=this.southWest.forEachReverse(e,t);if(void 0!==i)return i}}forEachIntersecting(e,t,i){if(!this.geoFrame.intersects(e))return;if(null!==this.southWest){const n=this.southWest.forEachIntersecting(e,t,i);if(void 0!==n)return n}if(null!==this.northWest){const n=this.northWest.forEachIntersecting(e,t,i);if(void 0!==n)return n}if(null!==this.southEast){const n=this.southEast.forEachIntersecting(e,t,i);if(void 0!==n)return n}if(null!==this.northEast){const n=this.northEast.forEachIntersecting(e,t,i);if(void 0!==n)return n}const n=this.views;for(let e=0;e<n.length;e+=1){const s=t.call(i,n[e]);if(void 0!==s)return s}}forEachNonIntersecting(e,t,i){if(this.geoFrame.intersects(e))return;if(null!==this.southWest){const n=this.southWest.forEachNonIntersecting(e,t,i);if(void 0!==n)return n}if(null!==this.northWest){const n=this.northWest.forEachNonIntersecting(e,t,i);if(void 0!==n)return n}if(null!==this.southEast){const n=this.southEast.forEachNonIntersecting(e,t,i);if(void 0!==n)return n}if(null!==this.northEast){const n=this.northEast.forEachNonIntersecting(e,t,i);if(void 0!==n)return n}const n=this.views;for(let e=0;e<n.length;e+=1){const s=t.call(i,n[e]);if(void 0!==s)return s}}createTree(e,i,n,s,r,o,a=null,l=null,h=null,u=null,d=t.Arrays.empty(),c=0){if(void 0===o&&(o=s.center),void 0===r){null!==a&&(r=a.geoBounds),null!==l&&(r=void 0!==r?r.union(l.geoBounds):l.geoBounds),null!==h&&(r=void 0!==r?r.union(h.geoBounds):h.geoBounds),null!==u&&(r=void 0!==r?r.union(u.geoBounds):u.geoBounds);for(let e=0;e<d.length;e+=1){const t=d[e];r=void 0!==r?r.union(t.geoBounds):t.geoBounds}void 0===r&&(r=s)}return new k(e,i,n,s,r,o,a,l,h,u,d,c)}static empty(e,n,s,r){return void 0===e&&(e=i.GeoBox.globe()),void 0===n&&(n=0),void 0===s&&(s=20),s=Math.max(n,s),void 0===r&&(r=8),new k(n,s,r,e,e,e.center,null,null,null,null,t.Arrays.empty(),0)}}let P=(()=>{var e;let t,i=f,n=[];return e=class extends i{constructor(e,t,i,s){super(),this.root=void p(this,n),this.root=k.empty(e,t,i,s),this.stem=null}updateRoot(e){this.root=e,this.stem=null,this.setGeoBounds(e.geoBounds)}getStem(e){let t=this.stem;return null===t&&(t=this.root.getTree(e),this.stem=t),t}onInsertChild(e,t){super.onInsertChild(e,t),e instanceof f&&this.updateRoot(this.root.inserted(e,e.geoBounds))}onRemoveChild(e){super.onRemoveChild(e),e instanceof f&&this.updateRoot(this.root.removed(e,e.geoBounds))}willProject(){super.willProject(),this.stem=null}processChildren(e,t){const i=this.geoViewport.value;if(null===i)return;const n=i.geoFrame,s=this.getStem(n);this.processTree(s,n,e,t)}processTree(e,t,i,n){null!==e.southWest&&e.southWest.geoFrame.intersects(t)&&this.processTree(e.southWest,t,i,n),null!==e.northWest&&e.northWest.geoFrame.intersects(t)&&this.processTree(e.northWest,t,i,n),null!==e.southEast&&e.southEast.geoFrame.intersects(t)&&this.processTree(e.southEast,t,i,n),null!==e.northEast&&e.northEast.geoFrame.intersects(t)&&this.processTree(e.northEast,t,i,n);const s=e.views;for(let e=0;e<s.length;e+=1){const t=s[e];n.call(this,t,i),0!=(t.flags&o.View.RemovingFlag)&&(t.setFlags(t.flags&~o.View.RemovingFlag),this.removeChild(t))}}get geoTreeColor(){return r.ThemeAnimator.getter()}onRender(){super.onRender();const e=r.ThemeAnimator.tryValue(this,"geoTreeColor");null!==e&&this.renderGeoTree(e)}renderGeoTree(e){const t=this.geoViewport.value;if(null===t)return;const i=this.renderer.value;i instanceof a.PaintingRenderer&&!this.hidden&&!this.culled&&this.renderGeoTreeOutline(this.root,t,i.context,e)}renderGeoTreeOutline(e,t,i,n){null!==e.southWest&&this.renderGeoTreeOutline(e.southWest,t,i,n),null!==e.northWest&&this.renderGeoTreeOutline(e.northWest,t,i,n),null!==e.southEast&&this.renderGeoTreeOutline(e.southEast,t,i,n),null!==e.northEast&&this.renderGeoTreeOutline(e.northEast,t,i,n);if(e.depth>=2){const t=(e.depth-2)/(e.maxDepth-2),s=4*(1-t)+.5*t;this.renderGeoOutline(e.geoFrame,i,n,s)}}displayChildren(e,t){const i=this.geoViewport.value;if(null===i)return;const n=i.geoFrame,s=this.getStem(n);this.displayTree(s,n,e,t)}displayTree(e,t,i,n){null!==e.southWest&&e.southWest.geoFrame.intersects(t)&&this.displayTree(e.southWest,t,i,n),null!==e.northWest&&e.northWest.geoFrame.intersects(t)&&this.displayTree(e.northWest,t,i,n),null!==e.southEast&&e.southEast.geoFrame.intersects(t)&&this.displayTree(e.southEast,t,i,n),null!==e.northEast&&e.northEast.geoFrame.intersects(t)&&this.displayTree(e.northEast,t,i,n);const s=e.views;for(let e=0;e<s.length;e+=1){const t=s[e];n.call(this,t,i),0!=(t.flags&o.View.RemovingFlag)&&(t.setFlags(t.flags&~o.View.RemovingFlag),this.removeChild(t))}}updateGeoBounds(){}onSetChildGeoBounds(e,t,i){this.updateRoot(this.root.moved(e,t,i))}hitTest(e,t){const i=this.geoViewport.value;if(null===i)return null;const n=i.unproject(e,t),s=this.getStem(i.geoFrame);return this.hitTestTree(s,e,t,n)}hitTestTree(e,t,i,n){let s=null;if(null!==e.southWest&&e.southWest.geoFrame.contains(n)&&(s=this.hitTestTree(e.southWest,t,i,n)),null===s&&null!==e.northWest&&e.northWest.geoFrame.contains(n)&&(s=this.hitTestTree(e.northWest,t,i,n)),null===s&&null!==e.southEast&&e.southEast.geoFrame.contains(n)&&(s=this.hitTestTree(e.southEast,t,i,n)),null===s&&null!==e.northEast&&e.northEast.geoFrame.contains(n)&&(s=this.hitTestTree(e.northEast,t,i,n)),null===s){const n=e.views;for(let e=0;e<n.length;e+=1){if(s=n[e].cascadeHitTest(t,i),null!==s)break}}return s}},(()=>{var o;const a="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(o=i[Symbol.metadata])&&void 0!==o?o:null):void 0;t=[r.ThemeAnimator({valueType:s.Color,value:null})],c(e,null,t,{kind:"getter",name:"geoTreeColor",static:!1,private:!1,access:{has:e=>"geoTreeColor"in e,get:e=>e.geoTreeColor},metadata:a},null,n),a&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:a})})(),e})(),R=(()=>{var e;let t,i,s,r,o,a,l,u,d,v=b,w=[],m=[],g=[],f=[],y=[],V=[],C=[];return e=class extends v{constructor(){super(...arguments),this.intersectsViewport=(p(this,w),p(this,m,void 0)),this.visible=p(this,g,void 0),this.consumable=p(this,f,void 0),this.geo=p(this,y,void 0),this.layers=p(this,V,void 0),this.features=p(this,C,void 0)}get nodeUri(){return n.Property.getter()}get visibleRange(){return n.Property.getter()}get consumeRange(){return n.Property.getter()}consumeLayers(){}unconsumeLayers(){}onStartConsuming(){super.onStartConsuming(),this.consumeLayers()}},(()=>{var p;const b="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(p=v[Symbol.metadata])&&void 0!==p?p:null):void 0;t=[n.Property({extends:!0,inherits:!1})],i=[n.Property({inherits:!0,value:[0,1/0],didSetValue(e){this.owner.visible.decohere()},setMin(e,t){this.setValue([e,this.value[1]],t)},setMax(e,t){this.setValue([this.value[0],e],t)}})],s=[n.Property({inherits:!0,value:[0,1/0],didSetValue(e){this.owner.consumable.decohere()},setMin(e,t){this.setValue([e,this.value[1]],t)},setMax(e,t){this.setValue([this.value[0],e],t)}})],r=[n.Property({valueType:Boolean,value:!1,inletKeys:[],deriveValue(){let e,t;return!(!this.owner.mounted||null===(e=this.owner.geo.view)||null===(t=e.geoViewport.value))&&t.geoFrame.intersects(e.geoBounds)}})],o=[n.Property({valueType:Boolean,value:!1,inletKeys:["intersectsViewport"],deriveValue(e){let t,i;if(!this.owner.mounted||null===(t=this.owner.geo.view)||null===(i=t.geoViewport.value))return!1;const[n]=this.owner.visibleRange.value;return e&&i.zoom>=n},didSetValue(e){const t=this.owner.geo.view;null!==t&&t.setCulled(!e)}})],a=[n.Property({valueType:Boolean,value:!1,inletKeys:["intersectsViewport"],deriveValue(e){let t,i;if(!this.owner.mounted||null===(t=this.owner.geo.view)||null===(i=t.geoViewport.value))return!1;const[n,s]=this.owner.consumeRange.value;if(e&&i.zoom>=s){const e=this.owner.geo.trait;null!==e&&e.consumeLayers(),this.owner.consumeLayers()}else if(!e||i.zoom<n){const e=this.owner.geo.trait;null!==e&&e.unconsumeLayers(),this.owner.unconsumeLayers()}return e&&i.zoom>=n&&i.zoom<s},didSetValue(e){const t=this.owner.geo.view;null!==t&&(e?this.owner.consume(t):this.owner.unconsume(t))}})],l=[h.TraitViewRef({extends:!0,consumed:!0,traitType:x,observesTrait:!0,initTrait(e){super.initTrait(e),this.owner.layers.addTraits(e.layers.traits),this.owner.features.addTraits(e.features.traits)},deinitTrait(e){this.owner.features.deleteTraits(e.features.traits),this.owner.layers.deleteTraits(e.layers.traits),super.deinitTrait(e)},traitWillAttachLayer(e,t){this.owner.layers.addTrait(e,t)},traitDidDetachLayer(e){this.owner.layers.deleteTrait(e)},traitWillAttachFeature(e,t){this.owner.features.addTrait(e,t)},traitDidDetachFeature(e){this.owner.features.deleteTrait(e)},viewType:P,observesView:!0,initView(e){super.initView(e);const t=this.owner.layers.controllers;for(const i in t){t[i].geo.insertView(e)}const i=this.owner.features.controllers;for(const t in i){i[t].geo.insertView(e)}},deinitView(e){this.owner.unconsume(e),super.deinitView(e)},viewDidProject(e){this.owner.intersectsViewport.decohere(),this.owner.visible.decohere(),this.owner.consumable.decohere()}})],u=[h.TraitViewControllerSet({get controllerType(){return R},binds:!0,observes:!0,get parentView(){return this.owner.geo.attachView()},getTraitViewRef:e=>e.geo,willAttachController(e){this.owner.callObservers("controllerWillAttachLayer",e,this.owner)},didAttachController(e){const t=e.geo.trait;null!==t&&this.attachLayerTrait(t,e);const i=e.geo.attachView();this.attachLayerView(i,e)},willDetachController(e){const t=e.geo.view;null!==t&&this.detachLayerView(t,e);const i=e.geo.trait;null!==i&&this.detachLayerTrait(i,e)},didDetachController(e){this.owner.callObservers("controllerDidDetachLayer",e,this.owner)},controllerWillAttachGeoTrait(e,t){this.owner.callObservers("controllerWillAttachLayerTrait",e,t,this.owner),this.attachLayerTrait(e,t)},controllerDidDetachGeoTrait(e,t){this.detachLayerTrait(e,t),this.owner.callObservers("controllerDidDetachLayerTrait",e,t,this.owner)},attachLayerTrait(e,t){},detachLayerTrait(e,t){this.deleteController(t)},controllerWillAttachGeoView(e,t){this.owner.callObservers("controllerWillAttachLayerView",e,t,this.owner),this.attachLayerView(e,t)},controllerDidDetachGeoView(e,t){this.detachLayerView(e,t),this.owner.callObservers("controllerDidDetachLayerView",e,t,this.owner)},attachLayerView(e,t){const i=this.owner.geo.attachView();t.geo.insertView(i)},detachLayerView(e,t){e.remove()},createController(e){return void 0!==e?e.createGeoController():super.createController()}})],d=[h.TraitViewControllerSet({controllerType:S,binds:!0,observes:!0,get parentView(){return this.owner.geo.attachView()},getTraitViewRef:e=>e.geo,willAttachController(e){this.owner.callObservers("controllerWillAttachFeature",e,this.owner)},didAttachController(e){const t=e.geo.trait;null!==t&&this.attachFeatureTrait(t,e);const i=e.geo.attachView();this.attachFeatureView(i,e)},willDetachController(e){const t=e.geo.view;null!==t&&this.detachFeatureView(t,e);const i=e.geo.trait;null!==i&&this.detachFeatureTrait(i,e)},didDetachController(e){this.owner.callObservers("controllerDidDetachFeature",e,this.owner)},controllerWillAttachGeoTrait(e,t){this.owner.callObservers("controllerWillAttachFeatureTrait",e,t,this.owner),this.attachFeatureTrait(e,t)},controllerDidDetachGeoTrait(e,t){this.detachFeatureTrait(e,t),this.owner.callObservers("controllerDidDetachFeatureTrait",e,t,this.owner)},attachFeatureTrait(e,t){},detachFeatureTrait(e,t){this.deleteController(t)},controllerWillAttachGeoView(e,t){this.owner.callObservers("controllerWillAttachFeatureView",e,t,this.owner),this.attachFeatureView(e,t)},controllerDidDetachGeoView(e,t){this.detachFeatureView(e,t),this.owner.callObservers("controllerDidDetachFeatureView",e,t,this.owner)},attachFeatureView(e,t){const i=this.owner.geo.attachView();t.geo.insertView(i)},detachFeatureView(e,t){e.remove()},controllerDidSetGeoPerspective(e,t){this.owner.callObservers("controllerDidSetFeatureGeoPerspective",e,t,this.owner)},controllerDidEnterGeoView(e,t){this.owner.callObservers("controllerDidEnterFeatureView",e,t,this.owner)},controllerDidLeaveGeoView(e,t){this.owner.callObservers("controllerDidLeaveFeatureView",e,t,this.owner)},controllerDidPressGeoView(e,t,i,n){this.owner.callObservers("controllerDidPressFeatureView",e,t,i,n,this.owner)},controllerDidLongPressGeoView(e,t,i){this.owner.callObservers("controllerDidLongPressFeatureView",e,t,i,this.owner)},createController(e){return void 0!==e?e.createGeoController():super.createController()}})],c(e,null,t,{kind:"getter",name:"nodeUri",static:!1,private:!1,access:{has:e=>"nodeUri"in e,get:e=>e.nodeUri},metadata:b},null,w),c(e,null,i,{kind:"getter",name:"visibleRange",static:!1,private:!1,access:{has:e=>"visibleRange"in e,get:e=>e.visibleRange},metadata:b},null,w),c(e,null,s,{kind:"getter",name:"consumeRange",static:!1,private:!1,access:{has:e=>"consumeRange"in e,get:e=>e.consumeRange},metadata:b},null,w),c(null,null,r,{kind:"field",name:"intersectsViewport",static:!1,private:!1,access:{has:e=>"intersectsViewport"in e,get:e=>e.intersectsViewport,set:(e,t)=>{e.intersectsViewport=t}},metadata:b},m,w),c(null,null,o,{kind:"field",name:"visible",static:!1,private:!1,access:{has:e=>"visible"in e,get:e=>e.visible,set:(e,t)=>{e.visible=t}},metadata:b},g,w),c(null,null,a,{kind:"field",name:"consumable",static:!1,private:!1,access:{has:e=>"consumable"in e,get:e=>e.consumable,set:(e,t)=>{e.consumable=t}},metadata:b},f,w),c(null,null,l,{kind:"field",name:"geo",static:!1,private:!1,access:{has:e=>"geo"in e,get:e=>e.geo,set:(e,t)=>{e.geo=t}},metadata:b},y,w),c(null,null,u,{kind:"field",name:"layers",static:!1,private:!1,access:{has:e=>"layers"in e,get:e=>e.layers,set:(e,t)=>{e.layers=t}},metadata:b},V,w),c(null,null,d,{kind:"field",name:"features",static:!1,private:!1,access:{has:e=>"features"in e,get:e=>e.features,set:(e,t)=>{e.features=t}},metadata:b},C,w),b&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:b})})(),e})(),A=(()=>{var e;let t,s,l,h,d,v,w,m,g,y,b=f,C=[],T=[],S=[],x=[],k=[],P=[],R=[],A=[],G=[],M=[],O=[];return e=class extends b{constructor(){super(),this.geoAnchor=(p(this,C),p(this,T,void 0)),this.viewAnchor=p(this,S,void 0),this.xAlign=p(this,x,void 0),this.yAlign=p(this,k,void 0),this.width=p(this,P,void 0),this.height=p(this,R,void 0),this.opacity=p(this,A,void 0),this.compositeOperation=p(this,G,void 0),this.compositor=p(this,M,void 0),this.renderer=p(this,O,void 0),this.canvas=this.createCanvas(),this.ownRasterFrame=null,this.renderer.value=this.createRenderer()}get pixelRatio(){return window.devicePixelRatio||1}createRenderer(e="canvas"){if("canvas"===e){const e=this.canvas.getContext("2d");if(null===e)throw new Error("Failed to create canvas rendering context");return new a.CanvasRenderer(e,u.Transform.identity(),this.pixelRatio)}if("webgl"===e){const e=this.canvas.getContext("webgl");if(null===e)throw new Error("Failed to create webgl rendering context");return new a.WebGLRenderer(e,this.pixelRatio)}throw new Error("Failed to create "+e+" renderer")}needsUpdate(e,t){const i=(e=super.needsUpdate(e,t))&(o.View.NeedsRender|o.View.NeedsComposite);return 0!==i&&(e|=o.View.NeedsComposite,this.setFlags(this.flags|o.View.NeedsDisplay|o.View.NeedsComposite|i)),e}needsProcess(e){return 0==(this.flags&o.View.ProcessMask)&&0==(e&(o.View.NeedsResize|o.View.NeedsProject))&&(e=0),e}onResize(){super.onResize(),this.requireUpdate(o.View.NeedsRender|o.View.NeedsComposite)}onProject(){super.onProject(),this.projectRaster()}projectGeoAnchor(e){const t=this.geoViewport.value;if(!this.mounted||null===t)return;const i=null!==e&&e.isDefined()?t.project(e):null;this.viewAnchor.setInterpolatedValue(this.viewAnchor.value,i),this.projectRaster()}projectRaster(){const e=this.geoViewport.value;if(null===e)return;let t;if(this.viewAnchor.hasAffinity(n.Affinity.Intrinsic)){const i=this.geoAnchor.value;t=null!==i&&i.isDefined()?e.project(i):null,this.viewAnchor.setIntrinsic(t)}else t=this.viewAnchor.value;if(null===t)return void this.setCulled(!this.viewFrame.intersects(this.rasterFrame));const i=this.viewFrame,s=i.width,r=i.height,o=Math.min(s,r);let a=this.width.value;a=a instanceof u.Length?a.pxValue(o):s;let l=this.height.value;l=l instanceof u.Length?l.pxValue(o):r;const h=t.x-a*this.xAlign.getValue(),d=t.y-l*this.yAlign.getValue(),c=new u.R2Box(h,d,h+a,d+l);this.setRasterFrame(c),this.setViewFrame(c),this.setCulled(!i.intersects(c))}needsDisplay(e){return 0!=(this.flags&o.View.DisplayMask)?e|=o.View.NeedsComposite:e=0!=(e&o.View.NeedsComposite)?o.View.NeedsDisplay|o.View.NeedsComposite:0,e}onRender(){const e=this.rasterFrame;this.resizeCanvas(this.canvas,e),this.resetRenderer(e),this.clearCanvas(e),super.onRender()}didComposite(){this.compositeImage(),super.didComposite()}get rasterFrame(){let e=this.ownRasterFrame;return null===e&&(e=this.deriveRasterFrame()),e}setRasterFrame(e){this.ownRasterFrame=e}deriveRasterFrame(){return this.deriveViewBounds()}createCanvas(){return document.createElement("canvas")}resizeCanvas(e,t){const i=this.pixelRatio,n=t.width,s=t.height,r=n*i,o=s*i,a=e.width,l=e.height;r===a&&o===l||(e.width=r,e.height=o,e.style.width=n+"px",e.style.height=s+"px")}clearCanvas(e){const t=this.renderer.value;if(t instanceof a.CanvasRenderer)t.context.clearRect(0,0,e.xMax,e.yMax);else if(t instanceof a.WebGLRenderer){const e=t.context;e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}}resetRenderer(e){const t=this.renderer.value;if(t instanceof a.CanvasRenderer){const i=this.pixelRatio,n=e.xMin*i,s=e.yMin*i;t.context.setTransform(i,0,0,i,-n,-s),t.setTransform(u.Transform.affine(i,0,0,i,-n,-s))}else t instanceof a.WebGLRenderer&&t.context.viewport(e.x,e.y,e.xMax,e.yMax)}compositeImage(){const e=this.compositor.value;if(!(e instanceof a.CanvasRenderer))return;const t=this.rasterFrame,i=this.canvas;if(!t.isDefined()||0===t.width||0===t.height||0===i.width||0===i.height)return;const n=e.context,s=n.globalAlpha,r=n.globalCompositeOperation;n.globalAlpha=this.opacity.getValue(),n.globalCompositeOperation=this.compositeOperation.getValue(),n.drawImage(i,t.x,t.y,t.width,t.height),n.globalAlpha=s,n.globalCompositeOperation=r}ripple(e){return V.ripple(this,e)}},(()=>{var p;const f="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(p=b[Symbol.metadata])&&void 0!==p?p:null):void 0;t=[n.Animator({valueType:i.GeoPoint,value:null,didSetState(e,t){this.owner.projectGeoAnchor(e)},didSetValue(e,t){this.owner.setGeoBounds(null!==e?e.bounds:i.GeoBox.undefined()),this.mounted&&this.owner.projectRaster(),this.owner.callObservers("viewDidSetGeoAnchor",e,this.owner)}})],s=[n.Animator({valueType:u.R2Point,value:u.R2Point.undefined()})],l=[n.Animator({valueType:Number,value:.5,updateFlags:o.View.NeedsComposite})],h=[n.Animator({valueType:Number,value:.5,updateFlags:o.View.NeedsComposite})],d=[r.ThemeAnimator({valueType:u.Length,value:null,updateFlags:o.View.NeedsResize|o.View.NeedsLayout|o.View.NeedsRender|o.View.NeedsComposite})],v=[r.ThemeAnimator({valueType:u.Length,value:null,updateFlags:o.View.NeedsResize|o.View.NeedsLayout|o.View.NeedsRender|o.View.NeedsComposite})],w=[r.ThemeAnimator({valueType:Number,value:1,updateFlags:o.View.NeedsComposite})],m=[n.Animator({valueType:String,value:"source-over",updateFlags:o.View.NeedsComposite})],g=[n.Property({valueType:a.GraphicsRenderer,value:null,inherits:"renderer"})],y=[n.Property({extends:!0,inherits:!1,updateFlags:o.View.NeedsRender|o.View.NeedsComposite,fromLike(e){return"string"==typeof e&&(e=this.owner.createRenderer(e)),e}})],c(null,null,t,{kind:"field",name:"geoAnchor",static:!1,private:!1,access:{has:e=>"geoAnchor"in e,get:e=>e.geoAnchor,set:(e,t)=>{e.geoAnchor=t}},metadata:f},T,C),c(null,null,s,{kind:"field",name:"viewAnchor",static:!1,private:!1,access:{has:e=>"viewAnchor"in e,get:e=>e.viewAnchor,set:(e,t)=>{e.viewAnchor=t}},metadata:f},S,C),c(null,null,l,{kind:"field",name:"xAlign",static:!1,private:!1,access:{has:e=>"xAlign"in e,get:e=>e.xAlign,set:(e,t)=>{e.xAlign=t}},metadata:f},x,C),c(null,null,h,{kind:"field",name:"yAlign",static:!1,private:!1,access:{has:e=>"yAlign"in e,get:e=>e.yAlign,set:(e,t)=>{e.yAlign=t}},metadata:f},k,C),c(null,null,d,{kind:"field",name:"width",static:!1,private:!1,access:{has:e=>"width"in e,get:e=>e.width,set:(e,t)=>{e.width=t}},metadata:f},P,C),c(null,null,v,{kind:"field",name:"height",static:!1,private:!1,access:{has:e=>"height"in e,get:e=>e.height,set:(e,t)=>{e.height=t}},metadata:f},R,C),c(null,null,w,{kind:"field",name:"opacity",static:!1,private:!1,access:{has:e=>"opacity"in e,get:e=>e.opacity,set:(e,t)=>{e.opacity=t}},metadata:f},A,C),c(null,null,m,{kind:"field",name:"compositeOperation",static:!1,private:!1,access:{has:e=>"compositeOperation"in e,get:e=>e.compositeOperation,set:(e,t)=>{e.compositeOperation=t}},metadata:f},G,C),c(null,null,g,{kind:"field",name:"compositor",static:!1,private:!1,access:{has:e=>"compositor"in e,get:e=>e.compositor,set:(e,t)=>{e.compositor=t}},metadata:f},M,C),c(null,null,y,{kind:"field",name:"renderer",static:!1,private:!1,access:{has:e=>"renderer"in e,get:e=>e.renderer,set:(e,t)=>{e.renderer=t}},metadata:f},O,C),f&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:f})})(),e.MountFlags=f.MountFlags|o.View.NeedsComposite,e.UncullFlags=f.UncullFlags|o.View.NeedsComposite,e.UnhideFlags=f.UnhideFlags|o.View.NeedsComposite,e})();class G extends f{constructor(e){super(),this.geoTile=e,this.geoBounds=e.bounds}setGeoBounds(e){}updateGeoBounds(){}}let M=(()=>{var e;let t,i,n,s,r=x,o=[],a=[],h=[],u=[],d=[];return e=class extends r{constructor(e){super(),this.geoTile=void p(this,o),this.southWest=p(this,a,void 0),this.northWest=p(this,h,void 0),this.southEast=p(this,u,void 0),this.northEast=p(this,d,void 0),this.geoTile=e}createTileTrait(e){return new this.constructor(e)}consumeLayers(){this.southWest.insertModel(),this.northWest.insertModel(),this.southEast.insertModel(),this.northEast.insertModel()}unconsumeLayers(){this.southWest.deleteModel(),this.northWest.deleteModel(),this.southEast.deleteModel(),this.northEast.deleteModel()}createGeoController(){return new O(this.geoTile)}},(()=>{var p;const v="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(p=r[Symbol.metadata])&&void 0!==p?p:null):void 0;t=[l.TraitModelRef({get traitType(){return M},traitKey:"layer",modelType:l.Model,modelKey:"southWest",binds:!0,createTrait(){return this.owner.createTileTrait(this.owner.geoTile.southWestTile)}})],i=[l.TraitModelRef({get traitType(){return M},traitKey:"layer",modelType:l.Model,modelKey:"northWest",binds:!0,createTrait(){return this.owner.createTileTrait(this.owner.geoTile.northWestTile)}})],n=[l.TraitModelRef({get traitType(){return M},traitKey:"layer",modelType:l.Model,modelKey:"southEast",binds:!0,createTrait(){return this.owner.createTileTrait(this.owner.geoTile.southEastTile)}})],s=[l.TraitModelRef({get traitType(){return M},traitKey:"layer",modelType:l.Model,modelKey:"northEast",binds:!0,createTrait(){return this.owner.createTileTrait(this.owner.geoTile.northEastTile)}})],c(null,null,t,{kind:"field",name:"southWest",static:!1,private:!1,access:{has:e=>"southWest"in e,get:e=>e.southWest,set:(e,t)=>{e.southWest=t}},metadata:v},a,o),c(null,null,i,{kind:"field",name:"northWest",static:!1,private:!1,access:{has:e=>"northWest"in e,get:e=>e.northWest,set:(e,t)=>{e.northWest=t}},metadata:v},h,o),c(null,null,n,{kind:"field",name:"southEast",static:!1,private:!1,access:{has:e=>"southEast"in e,get:e=>e.southEast,set:(e,t)=>{e.southEast=t}},metadata:v},u,o),c(null,null,s,{kind:"field",name:"northEast",static:!1,private:!1,access:{has:e=>"northEast"in e,get:e=>e.northEast,set:(e,t)=>{e.northEast=t}},metadata:v},d,o),v&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:v})})(),e})(),O=(()=>{var e;let t,i,s,r,o,a,l,u,d=R,v=[],w=[],m=[],g=[],f=[],y=[],b=[];return e=class extends d{constructor(e){super(),this.geoTile=void p(this,v),this.geo=p(this,w,void 0),this.layers=p(this,m,void 0),this.southWest=p(this,g,void 0),this.northWest=p(this,f,void 0),this.southEast=p(this,y,void 0),this.northEast=p(this,b,void 0),this.geoTile=e,this.visibleRange.setIntrinsic([e.z,e.z+1]),this.consumeRange.setIntrinsic([e.z,e.z+1])}get visibleRange(){return n.Property.getter()}get consumeRange(){return n.Property.getter()}createTileController(e,t){return new this.constructor(e)}consumeLayers(){this.southWest.insertController(),this.northWest.insertController(),this.southEast.insertController(),this.northEast.insertController()}unconsumeLayers(){this.southWest.deleteController(),this.northWest.deleteController(),this.southEast.deleteController(),this.northEast.deleteController()}},(()=>{var p;const V="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(p=d[Symbol.metadata])&&void 0!==p?p:null):void 0;t=[n.Property({extends:!0,inherits:!1})],i=[n.Property({extends:!0,inherits:!1})],s=[h.TraitViewRef({extends:!0,traitType:M,viewType:G,createView(){return new G(this.owner.geoTile)}})],r=[h.TraitViewControllerSet({extends:!0,createController(e){return e instanceof M?this.owner.createTileController(e.geoTile,e):super.createController()}})],o=[h.TraitViewControllerRef({get controllerType(){return O},controllerKey:!0,binds:!0,get parentView(){return this.owner.geo.attachView()},getTraitViewRef:e=>e.geo,createController(e){return this.owner.createTileController(this.owner.geoTile.southWestTile,e)}})],a=[h.TraitViewControllerRef({get controllerType(){return O},controllerKey:!0,binds:!0,get parentView(){return this.owner.geo.attachView()},getTraitViewRef:e=>e.geo,createController(e){return this.owner.createTileController(this.owner.geoTile.northWestTile,e)}})],l=[h.TraitViewControllerRef({get controllerType(){return O},controllerKey:!0,binds:!0,get parentView(){return this.owner.geo.attachView()},getTraitViewRef:e=>e.geo,createController(e){return this.owner.createTileController(this.owner.geoTile.southEastTile,e)}})],u=[h.TraitViewControllerRef({get controllerType(){return O},controllerKey:!0,binds:!0,get parentView(){return this.owner.geo.attachView()},getTraitViewRef:e=>e.geo,createController(e){return this.owner.createTileController(this.owner.geoTile.northEastTile,e)}})],c(e,null,t,{kind:"getter",name:"visibleRange",static:!1,private:!1,access:{has:e=>"visibleRange"in e,get:e=>e.visibleRange},metadata:V},null,v),c(e,null,i,{kind:"getter",name:"consumeRange",static:!1,private:!1,access:{has:e=>"consumeRange"in e,get:e=>e.consumeRange},metadata:V},null,v),c(null,null,s,{kind:"field",name:"geo",static:!1,private:!1,access:{has:e=>"geo"in e,get:e=>e.geo,set:(e,t)=>{e.geo=t}},metadata:V},w,v),c(null,null,r,{kind:"field",name:"layers",static:!1,private:!1,access:{has:e=>"layers"in e,get:e=>e.layers,set:(e,t)=>{e.layers=t}},metadata:V},m,v),c(null,null,o,{kind:"field",name:"southWest",static:!1,private:!1,access:{has:e=>"southWest"in e,get:e=>e.southWest,set:(e,t)=>{e.southWest=t}},metadata:V},g,v),c(null,null,a,{kind:"field",name:"northWest",static:!1,private:!1,access:{has:e=>"northWest"in e,get:e=>e.northWest,set:(e,t)=>{e.northWest=t}},metadata:V},f,v),c(null,null,l,{kind:"field",name:"southEast",static:!1,private:!1,access:{has:e=>"southEast"in e,get:e=>e.southEast,set:(e,t)=>{e.southEast=t}},metadata:V},y,v),c(null,null,u,{kind:"field",name:"northEast",static:!1,private:!1,access:{has:e=>"northEast"in e,get:e=>e.northEast,set:(e,t)=>{e.northEast=t}},metadata:V},b,v),V&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:V})})(),e})(),W=(()=>{var e;let t,l,h,d,v,w,m,g,f,y,b=C,V=[],T=[],S=[],x=[],k=[],P=[],R=[],A=[],G=[],M=[],O=[];return e=class extends b{constructor(){super(),this.geoShape=(p(this,V),p(this,T,void 0)),this.viewShape=p(this,S,void 0),this.geoCentroid=p(this,x,void 0),this.viewCentroid=p(this,k,void 0),this.fill=p(this,P,void 0),this.fillOpacity=p(this,R,void 0),this.stroke=p(this,A,void 0),this.strokeOpacity=p(this,G,void 0),this.strokeWidth=p(this,M,void 0),this.strokeHitWidth=p(this,O,void 0),Object.defineProperty(this,"viewBounds",{value:u.R2Box.undefined(),writable:!0,enumerable:!0,configurable:!0})}onProject(){super.onProject(),this.projectShape()}projectShape(){const e=this.geoViewport.value;if(null===e)return;let t;if(this.viewShape.hasAffinity(n.Affinity.Intrinsic)){const i=this.geoShape.value;t=null!==i&&i.isDefined()?i.project(e):null,this.viewShape.setIntrinsic(t)}else t=this.viewShape.value;if(this.viewCentroid.hasAffinity(n.Affinity.Intrinsic)){const t=this.geoCentroid.value,i=null!==t&&t.isDefined()?e.project(t):null;this.viewCentroid.setIntrinsic(i)}this.viewBounds=null!==t?t.bounds:this.viewFrame}onRender(){super.onRender();const e=this.renderer.value;if(e instanceof a.PaintingRenderer&&!this.hidden&&!this.culled){const t=this.viewShape.value;null!==t&&t.isDefined()&&this.renderShape(t,e.context,this.viewFrame)}}renderShape(e,t,i){e instanceof u.R2Group?this.renderGroup(e,t,i):e instanceof u.R2Path?this.renderPath(e,t,i):e instanceof u.R2Spline?this.renderPath(u.R2Path.of(e),t,i):e instanceof u.R2Curve&&this.renderPath(u.R2Path.open(e),t,i)}renderGroup(e,t,i){const n=e.shapes;for(let e=0;e<n.length;e+=1){const s=n[e];s.isDefined()&&this.renderShape(s,t,i)}}renderPath(e,t,i){const n=t.fillStyle,s=t.lineWidth,r=t.strokeStyle;t.beginPath(),e.draw(t);let o=this.fill.value;if(null!==o){const e=this.fillOpacity.value;void 0!==e&&(o=o.alpha(e)),t.fillStyle=o.toString(),t.fill()}let a=this.stroke.value;const l=this.strokeWidth.value;if(null!==a&&null!==l){const e=this.strokeOpacity.value;void 0!==e&&(a=a.alpha(e));const n=Math.min(i.width,i.height);t.lineWidth=l.pxValue(n),t.strokeStyle=a.toString(),t.stroke()}t.fillStyle=n,t.lineWidth=s,t.strokeStyle=r}hitTest(e,t){const i=this.renderer.value;if(i instanceof a.CanvasRenderer){const n=this.viewShape.value;if(null!==n&&n.isDefined()){const s=i.transform.transform(e,t);return this.hitTestShape(s.x,s.y,n,i.context,this.viewFrame)}}return null}hitTestShape(e,t,i,n,s){return i instanceof u.R2Group?this.hitTestGroup(e,t,i,n,s):i instanceof u.R2Path?this.hitTestPath(e,t,i,n,s):i instanceof u.R2Spline?this.hitTestPath(e,t,u.R2Path.of(i),n,s):i instanceof u.R2Curve?this.hitTestPath(e,t,u.R2Path.open(i),n,s):null}hitTestGroup(e,t,i,n,s){const r=i.shapes;for(let i=0;i<r.length;i+=1){const o=r[i];if(o.isDefined()){const i=this.hitTestShape(e,t,o,n,s);if(null!==i)return i}}return null}hitTestPath(e,t,i,n,s){if(n.beginPath(),i.draw(n),null!==this.fill.value&&n.isPointInPath(e,t))return this;const r=n.lineWidth;let o=!1;const a=this.strokeWidth.value;if(null!==this.stroke.value&&null!==a){const i=Math.min(s.width,s.height),r=Math.max(this.strokeHitWidth.getValueOr(0),a.pxValue(i));0!==r&&(n.lineWidth=r,o=n.isPointInStroke(e,t))}return n.lineWidth=r,o?this:null}updateGeoBounds(){}get popoverFrame(){const e=this.pageTransform.inverse(),t=this.viewCentroid.value;if(null===t||!t.isDefined())return this.viewBounds.transform(e);const i=e.transformX(t.x,t.y),n=e.transformY(t.x,t.y);return new u.R2Box(i,n,i,n)}},(()=>{var a;const p="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(a=b[Symbol.metadata])&&void 0!==a?a:null):void 0;t=[n.Animator({valueType:i.GeoShape,value:null,didSetValue(e){null!==e?(this.owner.setGeoBounds(e.bounds),this.owner.geoCentroid.setIntrinsic(e.bounds.center)):(this.owner.setGeoBounds(i.GeoBox.undefined()),this.owner.geoCentroid.setIntrinsic(null)),this.mounted&&this.owner.projectShape(),this.owner.callObservers("viewDidSetGeoShape",e,this.owner)}})],l=[n.Animator({valueType:u.R2Shape,value:null})],h=[n.Animator({valueType:i.GeoPoint,value:null})],d=[n.Animator({valueType:u.R2Point,value:null})],v=[r.ThemeAnimator({valueType:s.Color,value:null,updateFlags:o.View.NeedsRender})],w=[r.ThemeAnimator({valueType:Number,updateFlags:o.View.NeedsRender})],m=[r.ThemeAnimator({valueType:s.Color,value:null,updateFlags:o.View.NeedsRender})],g=[r.ThemeAnimator({valueType:Number,updateFlags:o.View.NeedsRender})],f=[r.ThemeAnimator({valueType:u.Length,value:null,updateFlags:o.View.NeedsRender})],y=[n.Property({valueType:Number})],c(null,null,t,{kind:"field",name:"geoShape",static:!1,private:!1,access:{has:e=>"geoShape"in e,get:e=>e.geoShape,set:(e,t)=>{e.geoShape=t}},metadata:p},T,V),c(null,null,l,{kind:"field",name:"viewShape",static:!1,private:!1,access:{has:e=>"viewShape"in e,get:e=>e.viewShape,set:(e,t)=>{e.viewShape=t}},metadata:p},S,V),c(null,null,h,{kind:"field",name:"geoCentroid",static:!1,private:!1,access:{has:e=>"geoCentroid"in e,get:e=>e.geoCentroid,set:(e,t)=>{e.geoCentroid=t}},metadata:p},x,V),c(null,null,d,{kind:"field",name:"viewCentroid",static:!1,private:!1,access:{has:e=>"viewCentroid"in e,get:e=>e.viewCentroid,set:(e,t)=>{e.viewCentroid=t}},metadata:p},k,V),c(null,null,v,{kind:"field",name:"fill",static:!1,private:!1,access:{has:e=>"fill"in e,get:e=>e.fill,set:(e,t)=>{e.fill=t}},metadata:p},P,V),c(null,null,w,{kind:"field",name:"fillOpacity",static:!1,private:!1,access:{has:e=>"fillOpacity"in e,get:e=>e.fillOpacity,set:(e,t)=>{e.fillOpacity=t}},metadata:p},R,V),c(null,null,m,{kind:"field",name:"stroke",static:!1,private:!1,access:{has:e=>"stroke"in e,get:e=>e.stroke,set:(e,t)=>{e.stroke=t}},metadata:p},A,V),c(null,null,g,{kind:"field",name:"strokeOpacity",static:!1,private:!1,access:{has:e=>"strokeOpacity"in e,get:e=>e.strokeOpacity,set:(e,t)=>{e.strokeOpacity=t}},metadata:p},G,V),c(null,null,f,{kind:"field",name:"strokeWidth",static:!1,private:!1,access:{has:e=>"strokeWidth"in e,get:e=>e.strokeWidth,set:(e,t)=>{e.strokeWidth=t}},metadata:p},M,V),c(null,null,y,{kind:"field",name:"strokeHitWidth",static:!1,private:!1,access:{has:e=>"strokeHitWidth"in e,get:e=>e.strokeHitWidth,set:(e,t)=>{e.strokeHitWidth=t}},metadata:p},O,V),p&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:p})})(),e})(),D=(()=>{var e;let t,s,o,a,l,h,d=T,v=[],w=[],m=[],g=[],f=[],y=[],b=[];return e=class extends d{constructor(){super(...arguments),this.geoShape=(p(this,v),p(this,w,void 0)),this.fill=p(this,m,void 0),this.fillOpacity=p(this,g,void 0),this.stroke=p(this,f,void 0),this.strokeOpacity=p(this,y,void 0),this.strokeWidth=p(this,b,void 0)}createGeoController(){return new F}},(()=>{var p;const V="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(p=d[Symbol.metadata])&&void 0!==p?p:null):void 0;t=[n.Property({valueType:i.GeoShape,value:null,didSetValue(e){this.owner.callObservers("traitDidSetGeoShape",e,this.owner),this.owner.geoPerspective.setIntrinsic(e)}})],s=[n.Property({valueType:r.ColorLook,value:null})],o=[n.Property({valueType:r.NumberLook})],a=[n.Property({valueType:r.ColorLook,value:null})],l=[n.Property({valueType:r.NumberLook})],h=[n.Property({valueType:u.Length,value:null})],c(null,null,t,{kind:"field",name:"geoShape",static:!1,private:!1,access:{has:e=>"geoShape"in e,get:e=>e.geoShape,set:(e,t)=>{e.geoShape=t}},metadata:V},w,v),c(null,null,s,{kind:"field",name:"fill",static:!1,private:!1,access:{has:e=>"fill"in e,get:e=>e.fill,set:(e,t)=>{e.fill=t}},metadata:V},m,v),c(null,null,o,{kind:"field",name:"fillOpacity",static:!1,private:!1,access:{has:e=>"fillOpacity"in e,get:e=>e.fillOpacity,set:(e,t)=>{e.fillOpacity=t}},metadata:V},g,v),c(null,null,a,{kind:"field",name:"stroke",static:!1,private:!1,access:{has:e=>"stroke"in e,get:e=>e.stroke,set:(e,t)=>{e.stroke=t}},metadata:V},f,v),c(null,null,l,{kind:"field",name:"strokeOpacity",static:!1,private:!1,access:{has:e=>"strokeOpacity"in e,get:e=>e.strokeOpacity,set:(e,t)=>{e.strokeOpacity=t}},metadata:V},y,v),c(null,null,h,{kind:"field",name:"strokeWidth",static:!1,private:!1,access:{has:e=>"strokeWidth"in e,get:e=>e.strokeWidth,set:(e,t)=>{e.strokeWidth=t}},metadata:V},b,v),V&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:V})})(),e})(),F=(()=>{var e;let t,s,o,a,l,d,v,w=S,m=[],g=[],f=[],y=[],b=[],V=[],C=[],T=[];return e=class extends w{constructor(){super(...arguments),this.geo=(p(this,m),p(this,g,void 0)),this.geoShape=p(this,f,void 0),this.fill=p(this,y,void 0),this.fillOpacity=p(this,b,void 0),this.stroke=p(this,V,void 0),this.strokeOpacity=p(this,C,void 0),this.strokeWidth=p(this,T,void 0)}},(()=>{var p;const S="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(p=w[Symbol.metadata])&&void 0!==p?p:null):void 0;t=[h.TraitViewRef({extends:!0,traitType:D,initTrait(e){super.initTrait(e),this.owner.geoShape.bindInlet(e.geoShape),this.owner.fill.bindInlet(e.fill),this.owner.fillOpacity.bindInlet(e.fillOpacity),this.owner.stroke.bindInlet(e.stroke),this.owner.strokeOpacity.bindInlet(e.strokeOpacity),this.owner.strokeWidth.bindInlet(e.strokeWidth)},deinitTrait(e){this.owner.geoShape.unbindInlet(e.geoShape),this.owner.fill.unbindInlet(e.fill),this.owner.fillOpacity.unbindInlet(e.fillOpacity),this.owner.stroke.unbindInlet(e.stroke),this.owner.strokeOpacity.unbindInlet(e.strokeOpacity),this.owner.strokeWidth.unbindInlet(e.strokeWidth),super.deinitTrait(e)},viewType:W,initView(e){super.initView(e),e.geoShape.bindInlet(this.owner.geoShape),e.fill.bindInlet(this.owner.fill),e.fillOpacity.bindInlet(this.owner.fillOpacity),e.stroke.bindInlet(this.owner.stroke),e.strokeOpacity.bindInlet(this.owner.strokeOpacity),e.strokeWidth.bindInlet(this.owner.strokeWidth)},deinitView(e){e.geoShape.unbindInlet(this.owner.geoShape),e.fill.unbindInlet(this.owner.fill),e.fillOpacity.unbindInlet(this.owner.fillOpacity),e.stroke.unbindInlet(this.owner.stroke),e.strokeOpacity.unbindInlet(this.owner.strokeOpacity),e.strokeWidth.unbindInlet(this.owner.strokeWidth),super.deinitView(e)}})],s=[n.Property({valueType:i.GeoShape,value:null,didSetValue(e){this.owner.callObservers("controllerDidSetGeoShape",e,this.owner),this.owner.geoPerspective.setIntrinsic(e)}})],o=[n.Property({valueType:r.ColorLook,value:null,transition:!0})],a=[n.Property({valueType:r.NumberLook,transition:!0})],l=[n.Property({valueType:r.ColorLook,value:null,transition:!0})],d=[n.Property({valueType:r.NumberLook,transition:!0})],v=[n.Property({valueType:u.Length,value:null,transition:!0})],c(null,null,t,{kind:"field",name:"geo",static:!1,private:!1,access:{has:e=>"geo"in e,get:e=>e.geo,set:(e,t)=>{e.geo=t}},metadata:S},g,m),c(null,null,s,{kind:"field",name:"geoShape",static:!1,private:!1,access:{has:e=>"geoShape"in e,get:e=>e.geoShape,set:(e,t)=>{e.geoShape=t}},metadata:S},f,m),c(null,null,o,{kind:"field",name:"fill",static:!1,private:!1,access:{has:e=>"fill"in e,get:e=>e.fill,set:(e,t)=>{e.fill=t}},metadata:S},y,m),c(null,null,a,{kind:"field",name:"fillOpacity",static:!1,private:!1,access:{has:e=>"fillOpacity"in e,get:e=>e.fillOpacity,set:(e,t)=>{e.fillOpacity=t}},metadata:S},b,m),c(null,null,l,{kind:"field",name:"stroke",static:!1,private:!1,access:{has:e=>"stroke"in e,get:e=>e.stroke,set:(e,t)=>{e.stroke=t}},metadata:S},V,m),c(null,null,d,{kind:"field",name:"strokeOpacity",static:!1,private:!1,access:{has:e=>"strokeOpacity"in e,get:e=>e.strokeOpacity,set:(e,t)=>{e.strokeOpacity=t}},metadata:S},C,m),c(null,null,v,{kind:"field",name:"strokeWidth",static:!1,private:!1,access:{has:e=>"strokeWidth"in e,get:e=>e.strokeWidth,set:(e,t)=>{e.strokeWidth=t}},metadata:S},T,m),S&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:S})})(),e})(),B=(()=>{var e;let t,l,h,d,v,w,m,g=f,y=[],b=[],C=[],T=[],S=[],x=[],k=[],P=[];return e=class extends g{constructor(){super(),this.geoCenter=(p(this,y),p(this,b,void 0)),this.viewCenter=p(this,C,void 0),this.radius=p(this,T,void 0),this.fill=p(this,S,void 0),this.stroke=p(this,x,void 0),this.strokeWidth=p(this,k,void 0),this.hitRadius=p(this,P,void 0),Object.defineProperty(this,"viewBounds",{value:u.R2Box.undefined(),writable:!0,enumerable:!0,configurable:!0})}onProject(){super.onProject(),this.projectCircle()}projectGeoCenter(e){const t=this.geoViewport.value;if(!this.mounted||null===t)return;const i=null!==e&&e.isDefined()?t.project(e):null;this.viewCenter.setInterpolatedValue(this.viewCenter.value,i),this.projectCircle()}projectCircle(){const e=this.geoViewport.value;if(null===e)return;if(n.Affinity.Intrinsic>=(this.viewCenter.flags&n.Affinity.Mask)){const t=this.geoCenter.value,i=null!==t&&t.isDefined()?e.project(t):null;this.viewCenter.value=i}const t=this.viewFrame,i=Math.min(t.width,t.height),s=this.radius.getValue().pxValue(i),r=this.viewCenter.value,o=this.viewCenter.state;null!==r&&null!==o&&(t.intersectsCircle(new u.R2Circle(r.x,r.y,s))||t.intersectsSegment(new u.R2Segment(r.x,r.y,o.x,o.y)))?this.setCulled(!1):this.setCulled(!0)}onRender(){super.onRender();const e=this.renderer.value;e instanceof a.PaintingRenderer&&!this.hidden&&!this.culled&&this.renderCircle(e.context,this.viewFrame)}renderCircle(e,t){const i=this.viewCenter.value;if(null===i||!i.isDefined())return;const n=e.fillStyle,s=e.lineWidth,r=e.strokeStyle,o=Math.min(t.width,t.height),a=this.radius.getValue().pxValue(o);e.beginPath(),e.arc(i.x,i.y,a,0,2*Math.PI);const l=this.fill.value;null!==l&&(e.fillStyle=l.toString(),e.fill());const h=this.stroke.value;if(null!==h){const t=this.strokeWidth.value;null!==t&&(e.lineWidth=t.pxValue(o)),e.strokeStyle=h.toString(),e.stroke()}e.fillStyle=n,e.lineWidth=s,e.strokeStyle=r}renderGeoBounds(e,t){}updateGeoBounds(){}deriveViewBounds(){const e=this.viewCenter.value;if(null===e||!e.isDefined())return u.R2Box.undefined();const t=this.viewFrame,i=Math.min(t.width,t.height),n=this.radius.getValue().pxValue(i);return new u.R2Box(e.x-n,e.y-n,e.x+n,e.y+n)}get popoverFrame(){const e=this.viewCenter.value;if(null===e||!e.isDefined())return this.pageBounds;const t=this.viewFrame,i=Math.min(t.width,t.height),n=this.pageTransform.inverse(),s=n.transformX(e.x,e.y),r=n.transformY(e.x,e.y),o=this.radius.getValue().pxValue(i);return new u.R2Box(s-o,r-o,s+o,r+o)}get hitBounds(){const e=this.viewCenter.value;if(null===e||!e.isDefined())return this.viewBounds;const t=this.viewFrame,i=Math.min(t.width,t.height),n=this.radius.getValue().pxValue(i),s=Math.max(this.hitRadius.getValueOr(n),n);return new u.R2Box(e.x-s,e.y-s,e.x+s,e.y+s)}hitTest(e,t){const i=this.renderer.value;return i instanceof a.CanvasRenderer?this.hitTestCircle(e,t,i.context,this.viewFrame,i.transform):null}hitTestCircle(e,t,i,n,s){const r=this.viewCenter.value;if(null===r||!r.isDefined())return null;const o=Math.min(n.width,n.height),a=this.radius.getValue().pxValue(o);if(null!==this.fill.value){const i=Math.max(this.hitRadius.getValueOr(a),a),n=r.x-e,s=r.y-t;if(n*n+s*s<i*i)return this}let l;if(null===this.stroke.value||null===(l=this.strokeWidth.value))return null;const h=i.lineWidth,u=s.transform(e,t);i.beginPath(),i.arc(r.x,r.y,a,0,2*Math.PI),i.lineWidth=l.pxValue(o);const d=i.isPointInStroke(u.x,u.y);return i.lineWidth=h,d?this:null}ripple(e){return V.ripple(this,e)}},(()=>{var a;const p="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(a=g[Symbol.metadata])&&void 0!==a?a:null):void 0;t=[n.Animator({valueType:i.GeoPoint,value:null,didSetState(e,t){this.owner.projectGeoCenter(e)},didSetValue(e,t){this.owner.setGeoBounds(null!==e?e.bounds:i.GeoBox.undefined()),this.mounted&&this.owner.projectCircle(),this.owner.callObservers("viewDidSetGeoCenter",e,this.owner)}})],l=[n.Animator({valueType:u.R2Point,value:u.R2Point.undefined(),updateFlags:o.View.NeedsRender})],h=[r.ThemeAnimator({valueType:u.Length,value:u.Length.zero(),updateFlags:o.View.NeedsRender})],d=[r.ThemeAnimator({valueType:s.Color,value:null,inherits:!0,updateFlags:o.View.NeedsRender})],v=[r.ThemeAnimator({valueType:s.Color,value:null,inherits:!0,updateFlags:o.View.NeedsRender})],w=[r.ThemeAnimator({valueType:u.Length,value:null,inherits:!0,updateFlags:o.View.NeedsRender})],m=[n.Property({valueType:Number})],c(null,null,t,{kind:"field",name:"geoCenter",static:!1,private:!1,access:{has:e=>"geoCenter"in e,get:e=>e.geoCenter,set:(e,t)=>{e.geoCenter=t}},metadata:p},b,y),c(null,null,l,{kind:"field",name:"viewCenter",static:!1,private:!1,access:{has:e=>"viewCenter"in e,get:e=>e.viewCenter,set:(e,t)=>{e.viewCenter=t}},metadata:p},C,y),c(null,null,h,{kind:"field",name:"radius",static:!1,private:!1,access:{has:e=>"radius"in e,get:e=>e.radius,set:(e,t)=>{e.radius=t}},metadata:p},T,y),c(null,null,d,{kind:"field",name:"fill",static:!1,private:!1,access:{has:e=>"fill"in e,get:e=>e.fill,set:(e,t)=>{e.fill=t}},metadata:p},S,y),c(null,null,v,{kind:"field",name:"stroke",static:!1,private:!1,access:{has:e=>"stroke"in e,get:e=>e.stroke,set:(e,t)=>{e.stroke=t}},metadata:p},x,y),c(null,null,w,{kind:"field",name:"strokeWidth",static:!1,private:!1,access:{has:e=>"strokeWidth"in e,get:e=>e.strokeWidth,set:(e,t)=>{e.strokeWidth=t}},metadata:p},k,y),c(null,null,m,{kind:"field",name:"hitRadius",static:!1,private:!1,access:{has:e=>"hitRadius"in e,get:e=>e.hitRadius,set:(e,t)=>{e.hitRadius=t}},metadata:p},P,y),p&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:p})})(),e})(),j=(()=>{var e;let t,l,h,d,v,w,m,g,y,b,C,T,S=f,x=[],k=[],P=[],R=[],A=[],G=[],M=[],O=[],W=[],L=[],D=[],F=[],B=[];return e=class extends S{constructor(){super(),this.geoCenter=(p(this,x),p(this,k,void 0)),this.viewCenter=p(this,P,void 0),this.innerRadius=p(this,R,void 0),this.outerRadius=p(this,A,void 0),this.startAngle=p(this,G,void 0),this.sweepAngle=p(this,M,void 0),this.padAngle=p(this,O,void 0),this.padRadius=p(this,W,void 0),this.cornerRadius=p(this,L,void 0),this.fill=p(this,D,void 0),this.stroke=p(this,F,void 0),this.strokeWidth=p(this,B,void 0),Object.defineProperty(this,"viewBounds",{value:u.R2Box.undefined(),writable:!0,enumerable:!0,configurable:!0})}get value(){const e=this.viewCenter.value;return null!==e&&e.isDefined()?new a.Arc(e,this.innerRadius.value,this.outerRadius.value,this.startAngle.value,this.sweepAngle.value,this.padAngle.value,this.padRadius.value,this.cornerRadius.value):null}get state(){const e=this.viewCenter.state;return null!==e&&e.isDefined()?new a.Arc(e,this.innerRadius.state,this.outerRadius.state,this.startAngle.state,this.sweepAngle.state,this.padAngle.state,this.padRadius.state,this.cornerRadius.state):null}onProject(){super.onProject(),this.projectArc()}projectGeoCenter(e){const t=this.geoViewport.value;if(!this.mounted||null===t)return;const i=null!==e&&e.isDefined()?t.project(e):null;this.viewCenter.setInterpolatedValue(this.viewCenter.value,i),this.projectArc()}projectArc(){const e=this.geoViewport.value;if(null===e)return;if(n.Affinity.Intrinsic>=(this.viewCenter.flags&n.Affinity.Mask)){const t=this.geoCenter.value,i=null!==t&&t.isDefined()?e.project(t):null;this.viewCenter.value=i}const t=this.viewFrame,i=Math.min(t.width,t.height),s=this.outerRadius.getValue().pxValue(i),r=this.viewCenter.value,o=this.viewCenter.state;null!==r&&null!==o&&(t.intersectsCircle(new u.R2Circle(r.x,r.y,s))||t.intersectsSegment(new u.R2Segment(r.x,r.y,o.x,o.y)))?this.setCulled(!1):this.setCulled(!0)}onRender(){super.onRender();const e=this.renderer.value;e instanceof a.PaintingRenderer&&!this.hidden&&!this.culled&&this.renderArc(e.context,this.viewFrame)}renderArc(e,t){const i=this.value;if(null===i||!t.isDefined())return;const n=e.fillStyle,s=e.lineWidth,r=e.strokeStyle;e.beginPath(),i.draw(e,t);const o=this.fill.value;null!==o&&(e.fillStyle=o.toString(),e.fill());const a=this.stroke.value;if(null!==a){const i=this.strokeWidth.value;if(null!==i){const n=Math.min(t.width,t.height);e.lineWidth=i.pxValue(n)}e.strokeStyle=a.toString(),e.stroke()}e.fillStyle=n,e.lineWidth=s,e.strokeStyle=r}renderGeoBounds(e,t){}updateGeoBounds(){}deriveViewBounds(){const e=this.viewCenter.value;if(null===e||!e.isDefined())return u.R2Box.undefined();const t=this.viewFrame,i=Math.min(t.width,t.height),n=this.outerRadius.getValue().pxValue(i);return new u.R2Box(e.x-n,e.y-n,e.x+n,e.y+n)}get popoverFrame(){const e=this.viewCenter.value;if(null===e||!e.isDefined())return this.pageBounds;const t=this.viewFrame,i=Math.min(t.width,t.height),n=this.pageTransform.inverse(),s=n.transformX(e.x,e.y),r=n.transformY(e.x,e.y),o=(this.innerRadius.getValue().pxValue(i)+this.outerRadius.getValue().pxValue(i))/2,a=this.startAngle.getValue().radValue()+this.sweepAngle.getValue().radValue()/2,l=s+o*Math.cos(a),h=r+o*Math.sin(a);return new u.R2Box(l,h,l,h)}hitTest(e,t){const i=this.renderer.value;if(i instanceof a.CanvasRenderer){const n=i.transform.transform(e,t);return this.hitTestArc(n.x,n.y,i.context,this.viewFrame)}return null}hitTestArc(e,t,i,n){const s=this.value;if(null===s)return null;if(i.beginPath(),s.draw(i,n),null!==this.fill.value&&i.isPointInPath(e,t))return this;let r;if(null===this.stroke.value||null===(r=this.strokeWidth.value))return null;const o=i.lineWidth,a=Math.min(n.width,n.height);i.lineWidth=r.pxValue(a);const l=i.isPointInStroke(e,t);return i.lineWidth=o,l?this:null}ripple(e){return V.ripple(this,e)}},(()=>{var a;const p="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(a=S[Symbol.metadata])&&void 0!==a?a:null):void 0;t=[n.Animator({valueType:i.GeoPoint,value:null,didSetState(e,t){this.owner.projectGeoCenter(e)},didSetValue(e,t){this.owner.setGeoBounds(null!==e?e.bounds:i.GeoBox.undefined()),this.mounted&&this.owner.projectArc(),this.owner.callObservers("viewDidSetGeoCenter",e,this.owner)}})],l=[n.Animator({valueType:u.R2Point,value:u.R2Point.undefined(),updateFlags:o.View.NeedsRender})],h=[r.ThemeAnimator({valueType:u.Length,value:u.Length.zero(),updateFlags:o.View.NeedsRender})],d=[r.ThemeAnimator({valueType:u.Length,value:u.Length.zero(),updateFlags:o.View.NeedsRender})],v=[r.ThemeAnimator({valueType:u.Angle,value:u.Angle.zero(),updateFlags:o.View.NeedsRender})],w=[r.ThemeAnimator({valueType:u.Angle,value:u.Angle.zero(),updateFlags:o.View.NeedsRender})],m=[r.ThemeAnimator({valueType:u.Angle,value:u.Angle.zero(),updateFlags:o.View.NeedsRender})],g=[r.ThemeAnimator({valueType:u.Length,value:null,updateFlags:o.View.NeedsRender})],y=[r.ThemeAnimator({valueType:u.Length,value:u.Length.zero(),updateFlags:o.View.NeedsRender})],b=[r.ThemeAnimator({valueType:s.Color,value:null,inherits:!0,updateFlags:o.View.NeedsRender})],C=[r.ThemeAnimator({valueType:s.Color,value:null,inherits:!0,updateFlags:o.View.NeedsRender})],T=[r.ThemeAnimator({valueType:u.Length,value:null,inherits:!0,updateFlags:o.View.NeedsRender})],c(null,null,t,{kind:"field",name:"geoCenter",static:!1,private:!1,access:{has:e=>"geoCenter"in e,get:e=>e.geoCenter,set:(e,t)=>{e.geoCenter=t}},metadata:p},k,x),c(null,null,l,{kind:"field",name:"viewCenter",static:!1,private:!1,access:{has:e=>"viewCenter"in e,get:e=>e.viewCenter,set:(e,t)=>{e.viewCenter=t}},metadata:p},P,x),c(null,null,h,{kind:"field",name:"innerRadius",static:!1,private:!1,access:{has:e=>"innerRadius"in e,get:e=>e.innerRadius,set:(e,t)=>{e.innerRadius=t}},metadata:p},R,x),c(null,null,d,{kind:"field",name:"outerRadius",static:!1,private:!1,access:{has:e=>"outerRadius"in e,get:e=>e.outerRadius,set:(e,t)=>{e.outerRadius=t}},metadata:p},A,x),c(null,null,v,{kind:"field",name:"startAngle",static:!1,private:!1,access:{has:e=>"startAngle"in e,get:e=>e.startAngle,set:(e,t)=>{e.startAngle=t}},metadata:p},G,x),c(null,null,w,{kind:"field",name:"sweepAngle",static:!1,private:!1,access:{has:e=>"sweepAngle"in e,get:e=>e.sweepAngle,set:(e,t)=>{e.sweepAngle=t}},metadata:p},M,x),c(null,null,m,{kind:"field",name:"padAngle",static:!1,private:!1,access:{has:e=>"padAngle"in e,get:e=>e.padAngle,set:(e,t)=>{e.padAngle=t}},metadata:p},O,x),c(null,null,g,{kind:"field",name:"padRadius",static:!1,private:!1,access:{has:e=>"padRadius"in e,get:e=>e.padRadius,set:(e,t)=>{e.padRadius=t}},metadata:p},W,x),c(null,null,y,{kind:"field",name:"cornerRadius",static:!1,private:!1,access:{has:e=>"cornerRadius"in e,get:e=>e.cornerRadius,set:(e,t)=>{e.cornerRadius=t}},metadata:p},L,x),c(null,null,b,{kind:"field",name:"fill",static:!1,private:!1,access:{has:e=>"fill"in e,get:e=>e.fill,set:(e,t)=>{e.fill=t}},metadata:p},D,x),c(null,null,C,{kind:"field",name:"stroke",static:!1,private:!1,access:{has:e=>"stroke"in e,get:e=>e.stroke,set:(e,t)=>{e.stroke=t}},metadata:p},F,x),c(null,null,T,{kind:"field",name:"strokeWidth",static:!1,private:!1,access:{has:e=>"strokeWidth"in e,get:e=>e.strokeWidth,set:(e,t)=>{e.strokeWidth=t}},metadata:p},B,x),p&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:p})})(),e})(),E=(()=>{var e;let t,l,h,d,v,w,m,g,y,b,C,T=f,S=[],x=[],k=[],P=[],R=[],A=[],G=[],M=[],O=[],W=[],L=[],D=[];return e=class extends T{constructor(){super(...arguments),this.geoPoint=(p(this,S),p(this,x,void 0)),this.viewPoint=p(this,k,void 0),this.radius=p(this,P,void 0),this.color=p(this,R,void 0),this.opacity=p(this,A,void 0),this.labelPadding=p(this,G,void 0),this.font=p(this,M,void 0),this.textColor=p(this,O,void 0),this.hitRadius=p(this,W,void 0),this.label=p(this,L,void 0),this.labelPlacement=p(this,D,void 0)}isGradientStop(){return null!==this.color.value||void 0!==this.opacity.value}needsProcess(e){return 0!=(e&o.View.NeedsProject)&&null!==this.label.view&&this.requireUpdate(o.View.NeedsLayout),e}onProject(){super.onProject();const e=this.geoViewport.value;if(null!==e&&this.viewPoint.hasAffinity(n.Affinity.Intrinsic)){const t=e.project(this.geoPoint.getValue());this.viewPoint.setInterpolatedValue(t,t)}}onLayout(){super.onLayout();const e=this.label.view;null!==e&&this.layoutLabel(e,this.viewFrame)}layoutLabel(e,t){const i=this.labelPlacement.value,n=Math.min(t.width,t.height),s=this.labelPadding.getValue().pxValue(n),{x:r,y:o}=this.viewPoint.getValue();let l=o;"top"===i?l-=s:"bottom"===i&&(l+=s),a.TypesetView[Symbol.hasInstance](e)&&e.setIntrinsic({textAlign:"center",textBaseline:"bottom",textOrigin:new u.R2Point(r,l)})}updateGeoBounds(){}get hitBounds(){const{x:e,y:t}=this.viewPoint.getValue(),i=this.hitRadius.getValueOr(0);return new u.R2Box(e-i,t-i,e+i,t+i)}hitTest(e,t){const i=this.renderer.value;return i instanceof a.CanvasRenderer?this.hitTestPoint(e,t,i.context,this.viewFrame):null}hitTestPoint(e,t,i,n){const{x:s,y:r}=this.viewPoint.getValue(),o=this.radius.value;let a=this.hitRadius.getValueOr(0);if(null!==o){const e=Math.min(n.width,n.height);a=Math.max(a,o.pxValue(e))}const l=s-e,h=r-t;return l*l+h*h<a*a?this:null}ripple(e){return V.ripple(this,e)}},(()=>{var p;const f="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(p=T[Symbol.metadata])&&void 0!==p?p:null):void 0;t=[n.Animator({valueType:i.GeoPoint,value:i.GeoPoint.origin(),updateFlags:o.View.NeedsProject,didSetValue(e,t){this.owner.setGeoBounds(e.bounds),this.owner.callObservers("viewDidSetGeoPoint",e,this.owner)}})],l=[n.Animator({valueType:u.R2Point,value:u.R2Point.origin()})],h=[r.ThemeAnimator({valueType:u.Length,value:null})],d=[r.ThemeAnimator({valueType:s.Color,value:null})],v=[r.ThemeAnimator({valueType:Number})],w=[r.ThemeAnimator({valueType:u.Length,value:null})],m=[r.ThemeAnimator({valueType:s.Font,value:null,inherits:!0})],g=[r.ThemeAnimator({valueType:s.Color,value:null,inherits:!0})],y=[n.Property({valueType:Number})],b=[o.ViewRef({viewType:a.TextRunView,viewKey:!0,binds:!0,willAttachView(e){this.owner.callObservers("viewWillAttachGeoLabel",e,this.owner)},didDetachView(e){this.owner.callObservers("viewDidDetachGeoLabel",e,this.owner)},fromLike(e){if(void 0===e||"string"==typeof e){let t=this.view;return null===t&&(t=this.createView()),t instanceof a.TextRunView&&t.text.setState(void 0!==e?e:""),t}return super.fromLike(e)}})],C=[n.Property({valueType:String,value:"auto"})],c(null,null,t,{kind:"field",name:"geoPoint",static:!1,private:!1,access:{has:e=>"geoPoint"in e,get:e=>e.geoPoint,set:(e,t)=>{e.geoPoint=t}},metadata:f},x,S),c(null,null,l,{kind:"field",name:"viewPoint",static:!1,private:!1,access:{has:e=>"viewPoint"in e,get:e=>e.viewPoint,set:(e,t)=>{e.viewPoint=t}},metadata:f},k,S),c(null,null,h,{kind:"field",name:"radius",static:!1,private:!1,access:{has:e=>"radius"in e,get:e=>e.radius,set:(e,t)=>{e.radius=t}},metadata:f},P,S),c(null,null,d,{kind:"field",name:"color",static:!1,private:!1,access:{has:e=>"color"in e,get:e=>e.color,set:(e,t)=>{e.color=t}},metadata:f},R,S),c(null,null,v,{kind:"field",name:"opacity",static:!1,private:!1,access:{has:e=>"opacity"in e,get:e=>e.opacity,set:(e,t)=>{e.opacity=t}},metadata:f},A,S),c(null,null,w,{kind:"field",name:"labelPadding",static:!1,private:!1,access:{has:e=>"labelPadding"in e,get:e=>e.labelPadding,set:(e,t)=>{e.labelPadding=t}},metadata:f},G,S),c(null,null,m,{kind:"field",name:"font",static:!1,private:!1,access:{has:e=>"font"in e,get:e=>e.font,set:(e,t)=>{e.font=t}},metadata:f},M,S),c(null,null,g,{kind:"field",name:"textColor",static:!1,private:!1,access:{has:e=>"textColor"in e,get:e=>e.textColor,set:(e,t)=>{e.textColor=t}},metadata:f},O,S),c(null,null,y,{kind:"field",name:"hitRadius",static:!1,private:!1,access:{has:e=>"hitRadius"in e,get:e=>e.hitRadius,set:(e,t)=>{e.hitRadius=t}},metadata:f},W,S),c(null,null,b,{kind:"field",name:"label",static:!1,private:!1,access:{has:e=>"label"in e,get:e=>e.label,set:(e,t)=>{e.label=t}},metadata:f},L,S),c(null,null,C,{kind:"field",name:"labelPlacement",static:!1,private:!1,access:{has:e=>"labelPlacement"in e,get:e=>e.labelPlacement,set:(e,t)=>{e.labelPlacement=t}},metadata:f},D,S),f&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:f})})(),e})();Object.defineProperty(E.prototype,"viewBounds",{get(){const{x:e,y:t}=this.viewPoint.getValue();return new u.R2Box(e,t,e,t)},configurable:!0});let I=(()=>{var e;let t,l,h,d,v,w,m,g=f,y=[],b=[],C=[],T=[],S=[],x=[],k=[],P=[];return e=class extends g{constructor(){super(),this.geoCentroid=(p(this,y),p(this,b,void 0)),this.viewCentroid=p(this,C,void 0),this.stroke=p(this,T,void 0),this.strokeWidth=p(this,S,void 0),this.font=p(this,x,void 0),this.textColor=p(this,k,void 0),this.hitWidth=p(this,P,void 0),this.gradientStops=0,Object.defineProperty(this,"viewBounds",{value:u.R2Box.undefined(),writable:!0,enumerable:!0,configurable:!0})}points(){const e=[];let t=this.firstChild;for(;null!==t;)t instanceof E&&e.push(t),t=t.nextSibling;return e}appendPoint(e,t){return this.appendChild(e,t),e}setPoint(e,t){return this.setChild(e,t),t}onInsertChild(e,t){super.onInsertChild(e,t),e instanceof E&&this.onInsertPoint(e)}onInsertPoint(e){e.requireUpdate(o.View.NeedsAnimate|o.View.NeedsProject)}didProject(){const e=this.geoViewport.value;if(null===e)return;const t=this.geoBounds;let n=1/0,s=1/0,r=-1/0,o=-1/0,a=0,l=0,h=1/0,d=1/0,c=-1/0,p=-1/0,v=0,w=0,m=!1,g=0,f=0,y=this.firstChild;for(;null!==y;){if(y instanceof E){const{lng:e,lat:t}=y.geoPoint.getValue();a+=e,l+=t,n=Math.min(n,e),s=Math.min(s,t),r=Math.max(e,r),o=Math.max(t,o),m=m||!isFinite(e)||!isFinite(t);const{x:i,y:u}=y.viewPoint.getValue();h=Math.min(h,i),d=Math.min(d,u),c=Math.max(i,c),p=Math.max(u,p),v+=i,w+=u,m=m||!isFinite(i)||!isFinite(u),y.isGradientStop()&&(g+=1),f+=1}y=y.nextSibling}m||0===f?(this.geoCentroid.setIntrinsic(i.GeoPoint.origin()),this.geoBounds=i.GeoBox.undefined(),this.viewCentroid.setIntrinsic(u.R2Point.origin()),this.viewBounds=u.R2Box.undefined(),this.setCulled(!0)):(a/=f,l/=f,this.geoCentroid.setIntrinsic(new i.GeoPoint(a,l)),this.geoBounds=new i.GeoBox(n,s,r,o),v/=f,w/=f,this.viewCentroid.setIntrinsic(new u.R2Point(v,w)),this.viewBounds=new u.R2Box(h,d,c,p),this.cullGeoFrame(e.geoFrame)),this.gradientStops=g;const b=this.geoBounds;t.equals(b)||(this.willSetGeoBounds(b,t),this.onSetGeoBounds(b,t),this.didSetGeoBounds(b,t)),super.didProject()}onRender(){super.onRender();const e=this.renderer.value;e instanceof a.PaintingRenderer&&!this.hidden&&!this.culled&&(0!==this.gradientStops&&e instanceof a.CanvasRenderer?this.renderPlotGradient(e.context,this.viewFrame):this.renderPlotStroke(e.context,this.viewFrame))}renderPlotStroke(e,t){const i=this.stroke.value;if(null===i)return;let n=0;e.beginPath();let s=this.firstChild;for(;null!==s;){if(s instanceof E){const{x:t,y:i}=s.viewPoint.getValue();0===n?e.moveTo(t,i):e.lineTo(t,i),n+=1}s=s.nextSibling}if(0===n)return;const r=e.lineWidth,o=e.strokeStyle,a=Math.min(t.width,t.height),l=this.strokeWidth.getValue().pxValue(a);e.lineWidth=l,e.strokeStyle=i.toString(),e.stroke(),e.lineWidth=r,e.strokeStyle=o}renderPlotGradient(e,t){const i=this.stroke.getValue(),n=Math.min(t.width,t.height),s=this.strokeWidth.getValue().pxValue(n),r=e.lineWidth,o=e.strokeStyle;let a,l=this.firstChild;for(;null!==l;){if(l instanceof E){if(void 0!==a){const t=a.viewPoint.getValue().x,n=a.viewPoint.getValue().y,r=l.viewPoint.getValue().x,o=l.viewPoint.getValue().y,h=e.createLinearGradient(t,n,r,o);let u=a.color.getValueOr(i),d=a.opacity.value;"number"==typeof d&&(u=u.alpha(d)),h.addColorStop(0,u.toString()),u=l.color.getValueOr(i),d=l.opacity.value,"number"==typeof d&&(u=u.alpha(d)),h.addColorStop(1,u.toString()),e.beginPath(),e.moveTo(t,n),e.lineTo(r,o),e.lineWidth=s,e.strokeStyle=h,e.stroke()}a=l}l=l.nextSibling}e.lineWidth=r,e.strokeStyle=o}updateGeoBounds(){}get popoverFrame(){const e=this.viewCentroid.value,t=this.pageTransform.inverse(),i=t.transformX(e.x,e.y),n=t.transformY(e.x,e.y);return new u.R2Box(i,n,i,n)}hitTest(e,t){const i=this.renderer.value;if(i instanceof a.CanvasRenderer){const n=i.transform.transform(e,t);return this.hitTestPlot(n.x,n.y,i.context,this.viewFrame)}return null}hitTestPlot(e,t,i,n){let s=0;i.beginPath();let r=this.firstChild;for(;null!==r;){if(r instanceof E){const{x:e,y:t}=r.viewPoint.getValue();0===s?i.moveTo(e,t):i.lineTo(e,t),s+=1}r=r.nextSibling}if(0===s)return null;const o=i.lineWidth;let a=this.hitWidth.getValueOr(0);const l=this.strokeWidth.value;if(null!==l){const e=Math.min(n.width,n.height);a=Math.max(a,l.pxValue(e))}i.lineWidth=a;const h=i.isPointInStroke(e,t);return i.lineWidth=o,h?this:null}ripple(e){return V.ripple(this,e)}},(()=>{var a;const p="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(a=g[Symbol.metadata])&&void 0!==a?a:null):void 0;t=[n.Property({valueType:i.GeoPoint,value:i.GeoPoint.origin()})],l=[n.Property({valueType:u.R2Point,value:u.R2Point.origin()})],h=[r.ThemeAnimator({valueType:s.Color,value:null,inherits:!0,updateFlags:o.View.NeedsRender})],d=[r.ThemeAnimator({valueType:u.Length,value:null,inherits:!0,updateFlags:o.View.NeedsRender})],v=[r.ThemeAnimator({valueType:s.Font,value:null,inherits:!0})],w=[r.ThemeAnimator({valueType:s.Color,value:null,inherits:!0})],m=[n.Property({valueType:Number})],c(null,null,t,{kind:"field",name:"geoCentroid",static:!1,private:!1,access:{has:e=>"geoCentroid"in e,get:e=>e.geoCentroid,set:(e,t)=>{e.geoCentroid=t}},metadata:p},b,y),c(null,null,l,{kind:"field",name:"viewCentroid",static:!1,private:!1,access:{has:e=>"viewCentroid"in e,get:e=>e.viewCentroid,set:(e,t)=>{e.viewCentroid=t}},metadata:p},C,y),c(null,null,h,{kind:"field",name:"stroke",static:!1,private:!1,access:{has:e=>"stroke"in e,get:e=>e.stroke,set:(e,t)=>{e.stroke=t}},metadata:p},T,y),c(null,null,d,{kind:"field",name:"strokeWidth",static:!1,private:!1,access:{has:e=>"strokeWidth"in e,get:e=>e.strokeWidth,set:(e,t)=>{e.strokeWidth=t}},metadata:p},S,y),c(null,null,v,{kind:"field",name:"font",static:!1,private:!1,access:{has:e=>"font"in e,get:e=>e.font,set:(e,t)=>{e.font=t}},metadata:p},x,y),c(null,null,w,{kind:"field",name:"textColor",static:!1,private:!1,access:{has:e=>"textColor"in e,get:e=>e.textColor,set:(e,t)=>{e.textColor=t}},metadata:p},k,y),c(null,null,m,{kind:"field",name:"hitWidth",static:!1,private:!1,access:{has:e=>"hitWidth"in e,get:e=>e.hitWidth,set:(e,t)=>{e.hitWidth=t}},metadata:p},P,y),p&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:p})})(),e})(),N=(()=>{var e;let t,l,h,d,v,w=C,m=[],g=[],f=[],y=[],b=[];return e=class extends w{constructor(){super(),this.sprite=void p(this,m),this.geoCenter=p(this,g,void 0),this.viewCenter=p(this,f,void 0),this.iconLayout=p(this,y,void 0),this.graphics=p(this,b,void 0),this.sprite=null,Object.defineProperty(this,"viewBounds",{value:u.R2Box.undefined(),writable:!0,enumerable:!0,configurable:!0})}get iconColor(){return r.ThemeAnimator.getter()}onApplyTheme(e,t,i){if(super.onApplyTheme(e,t,i),this.graphics.derived)return;const s=this.graphics.value;if(!(s instanceof a.Icon))return;const r=s.withTheme(e,t);this.graphics.setState(r,!!s.isThemed()&&i,n.Affinity.Reflexive)}onProject(){super.onProject(),this.projectIcon()}projectGeoCenter(e){const t=this.geoViewport.value;if(!this.mounted||null===t)return;const i=null!==e&&e.isDefined()?t.project(e):null;this.viewCenter.setInterpolatedValue(this.viewCenter.value,i),this.projectIcon()}projectIcon(){const e=this.geoViewport.value;if(null===e)return;if(n.Affinity.Intrinsic>=(this.viewCenter.flags&n.Affinity.Mask)){const t=this.geoCenter.value,i=null!==t&&t.isDefined()?e.project(t):null;this.viewCenter.value=i}const t=this.viewFrame;this.viewBounds=this.deriveViewBounds(t);const i=this.viewCenter.value,s=this.viewCenter.state;null!==i&&null!==s&&(t.intersectsBox(this.viewBounds)||t.intersectsSegment(new u.R2Segment(i.x,i.y,s.x,s.y)))?this.setCulled(!1):this.setCulled(!0)}onRasterize(){super.onRasterize(),this.hidden||this.culled||this.rasterizeIcon(this.viewBounds)}rasterizeIcon(e){let t=this.sprite;const i=this.graphics.value;if(null!==i&&e.isDefined()){const n=e.width,s=e.height;null!==t&&(t.width<n||t.height<s||n<t.width/2&&s<t.height/2)&&(this.sprite=null,t.release(),t=null),null===t&&(t=this.sprites.getService().acquireSprite(n,s),this.sprite=t);const r=t.getRenderer(),o=r.context;o.clearRect(0,0,t.width,t.height),o.beginPath(),i.render(r,new u.R2Box(0,0,n,s))}else null!==t&&(this.sprite=null,t.release())}onComposite(){super.onComposite();const e=this.renderer.value;e instanceof a.CanvasRenderer&&!this.hidden&&!this.culled&&this.compositeIcon(e,this.viewBounds)}compositeIcon(e,t){const i=this.sprite;null!==i&&i.draw(e.context,t)}renderGeoBounds(e,t){}updateGeoBounds(){}deriveViewBounds(e){const t=this.viewCenter.value;if(null===t||!t.isDefined())return u.R2Box.undefined();void 0===e&&(e=this.viewFrame);const i=Math.min(e.width,e.height),n=this.iconLayout.value,s=null!==n?n.width.pxValue(i):i,r=null!==n?n.height.pxValue(i):i,o=null!==n?n.xAlign:.5,a=null!==n?n.yAlign:.5,l=t.x-s*o,h=t.y-r*a;return new u.R2Box(l,h,l+s,h+r)}get popoverFrame(){const e=this.viewCenter.value;if(null===e||!e.isDefined())return this.pageBounds;const t=this.viewFrame,i=Math.min(t.width,t.height),n=this.iconLayout.value,s=null!==n?n.width.pxValue(i):i,r=null!==n?n.height.pxValue(i):i,o=null!==n?n.xAlign:.5,a=null!==n?n.yAlign:.5,l=this.pageTransform.inverse(),h=l.transformX(e.x,e.y)-s*o,d=l.transformY(e.x,e.y)-r*a;return new u.R2Box(h,d,h+s,d+r)}hitTest(e,t){const i=this.renderer.value;return i instanceof a.CanvasRenderer?this.hitTestIcon(e,t,i,this.viewBounds):null}hitTestIcon(e,t,i,n){return this.hitBounds.contains(e,t)?this:null}onUnmount(){super.onUnmount();const e=this.sprite;null!==e&&(this.sprite=null,e.release())}},(()=>{var p;const V="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(p=w[Symbol.metadata])&&void 0!==p?p:null):void 0;t=[n.Animator({valueType:i.GeoPoint,value:null,didSetState(e){this.owner.projectGeoCenter(e)},didSetValue(e){this.owner.setGeoBounds(null!==e?e.bounds:i.GeoBox.undefined()),this.mounted&&this.owner.projectIcon(),this.owner.callObservers("viewDidSetGeoCenter",e,this.owner)},decohere(e){this.owner.culled?this.recohere(performance.now()):super.decohere(e)}})],l=[n.Animator({valueType:u.R2Point,value:u.R2Point.undefined(),updateFlags:o.View.NeedsComposite})],h=[n.Animator({valueType:a.IconLayout,value:null,updateFlags:o.View.NeedsProject|o.View.NeedsRender|o.View.NeedsRasterize|o.View.NeedsComposite})],d=[r.ThemeAnimator({valueType:s.Color,value:null,updateFlags:o.View.NeedsRender|o.View.NeedsRasterize|o.View.NeedsComposite,didSetState(e){const t=null!==this.timing&&this.timing;this.owner.graphics.setState(this.owner.graphics.state,t,n.Affinity.Reflexive)}})],v=[r.ThemeAnimator({extends:a.IconGraphicsAnimator,valueType:a.Graphics,value:null,updateFlags:o.View.NeedsRender|o.View.NeedsRasterize|o.View.NeedsComposite,didSetValue(e){this.owner.callObservers("viewDidSetGraphics",e,this.owner)}})],c(e,null,d,{kind:"getter",name:"iconColor",static:!1,private:!1,access:{has:e=>"iconColor"in e,get:e=>e.iconColor},metadata:V},null,m),c(null,null,t,{kind:"field",name:"geoCenter",static:!1,private:!1,access:{has:e=>"geoCenter"in e,get:e=>e.geoCenter,set:(e,t)=>{e.geoCenter=t}},metadata:V},g,m),c(null,null,l,{kind:"field",name:"viewCenter",static:!1,private:!1,access:{has:e=>"viewCenter"in e,get:e=>e.viewCenter,set:(e,t)=>{e.viewCenter=t}},metadata:V},f,m),c(null,null,h,{kind:"field",name:"iconLayout",static:!1,private:!1,access:{has:e=>"iconLayout"in e,get:e=>e.iconLayout,set:(e,t)=>{e.iconLayout=t}},metadata:V},y,m),c(null,null,v,{kind:"field",name:"graphics",static:!1,private:!1,access:{has:e=>"graphics"in e,get:e=>e.graphics,set:(e,t)=>{e.graphics=t}},metadata:V},b,m),V&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:V})})(),e.MountFlags=C.MountFlags|o.View.NeedsRasterize,e.UncullFlags=C.UncullFlags|o.View.NeedsRasterize,e})(),z=(()=>{var e;let t,s,o,l,h=T,u=[],d=[],v=[],w=[],m=[];return e=class extends h{constructor(){super(...arguments),this.geoCenter=(p(this,u),p(this,d,void 0)),this.iconLayout=p(this,v,void 0),this.iconColor=p(this,w,void 0),this.graphics=p(this,m,void 0)}createGeoController(){return new q}},(()=>{var p;const g="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(p=h[Symbol.metadata])&&void 0!==p?p:null):void 0;t=[n.Property({valueType:i.GeoPoint,value:null,didSetValue(e){this.owner.callObservers("traitDidSetGeoCenter",e,this.owner),this.owner.geoPerspective.setIntrinsic(e)}})],s=[n.Property({valueType:a.IconLayout,value:null,didSetValue(e){this.owner.callObservers("traitDidSetIconLayout",e,this.owner)}})],o=[n.Property({valueType:r.ColorLook,value:null})],l=[n.Property({valueType:a.Graphics,value:null,didSetValue(e){this.owner.callObservers("traitDidSetGraphics",e,this.owner)}})],c(null,null,t,{kind:"field",name:"geoCenter",static:!1,private:!1,access:{has:e=>"geoCenter"in e,get:e=>e.geoCenter,set:(e,t)=>{e.geoCenter=t}},metadata:g},d,u),c(null,null,s,{kind:"field",name:"iconLayout",static:!1,private:!1,access:{has:e=>"iconLayout"in e,get:e=>e.iconLayout,set:(e,t)=>{e.iconLayout=t}},metadata:g},v,u),c(null,null,o,{kind:"field",name:"iconColor",static:!1,private:!1,access:{has:e=>"iconColor"in e,get:e=>e.iconColor,set:(e,t)=>{e.iconColor=t}},metadata:g},w,u),c(null,null,l,{kind:"field",name:"graphics",static:!1,private:!1,access:{has:e=>"graphics"in e,get:e=>e.graphics,set:(e,t)=>{e.graphics=t}},metadata:g},m,u),g&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:g})})(),e})(),q=(()=>{var e;let t,s,o,l,u,d=S,v=[],w=[],m=[],g=[],f=[],y=[];return e=class extends d{constructor(){super(...arguments),this.geo=(p(this,v),p(this,w,void 0)),this.geoCenter=p(this,m,void 0),this.iconLayout=p(this,g,void 0),this.iconColor=p(this,f,void 0),this.graphics=p(this,y,void 0)}},(()=>{var p;const b="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(p=d[Symbol.metadata])&&void 0!==p?p:null):void 0;t=[h.TraitViewRef({extends:!0,traitType:z,initTrait(e){super.initTrait(e),this.owner.geoPerspective.bindInlet(e.geoPerspective),this.owner.geoCenter.bindInlet(e.geoCenter),this.owner.iconLayout.bindInlet(e.iconLayout),this.owner.iconColor.bindInlet(e.iconColor),this.owner.graphics.bindInlet(e.graphics)},deinitTrait(e){this.owner.geoPerspective.unbindInlet(e.geoPerspective),this.owner.geoCenter.unbindInlet(e.geoCenter),this.owner.iconLayout.unbindInlet(e.iconLayout),this.owner.iconColor.unbindInlet(e.iconColor),this.owner.graphics.unbindInlet(e.graphics),super.deinitTrait(e)},viewType:N,initView(e){super.initView(e),e.geoCenter.bindInlet(this.owner.geoCenter),e.iconLayout.bindInlet(this.owner.iconLayout),e.iconColor.bindInlet(this.owner.iconColor),e.graphics.bindInlet(this.owner.graphics)},deinitView(e){e.geoCenter.unbindInlet(this.owner.geoCenter),e.iconLayout.unbindInlet(this.owner.iconLayout),e.iconColor.unbindInlet(this.owner.iconColor),e.graphics.unbindInlet(this.owner.graphics),super.deinitView(e)}})],s=[n.Property({valueType:i.GeoPoint,value:null,transition:!0,didSetValue(e){this.owner.callObservers("controllerDidSetGeoCenter",e,this.owner),this.owner.geoPerspective.setIntrinsic(e)}})],o=[n.Property({valueType:a.IconLayout,value:null})],l=[n.Property({valueType:r.ColorLook,value:null,transition:!0})],u=[n.Property({valueType:a.Graphics,value:null})],c(null,null,t,{kind:"field",name:"geo",static:!1,private:!1,access:{has:e=>"geo"in e,get:e=>e.geo,set:(e,t)=>{e.geo=t}},metadata:b},w,v),c(null,null,s,{kind:"field",name:"geoCenter",static:!1,private:!1,access:{has:e=>"geoCenter"in e,get:e=>e.geoCenter,set:(e,t)=>{e.geoCenter=t}},metadata:b},m,v),c(null,null,o,{kind:"field",name:"iconLayout",static:!1,private:!1,access:{has:e=>"iconLayout"in e,get:e=>e.iconLayout,set:(e,t)=>{e.iconLayout=t}},metadata:b},g,v),c(null,null,l,{kind:"field",name:"iconColor",static:!1,private:!1,access:{has:e=>"iconColor"in e,get:e=>e.iconColor,set:(e,t)=>{e.iconColor=t}},metadata:b},f,v),c(null,null,u,{kind:"field",name:"graphics",static:!1,private:!1,access:{has:e=>"graphics"in e,get:e=>e.graphics,set:(e,t)=>{e.graphics=t}},metadata:b},y,v),b&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:b})})(),e})(),H=(()=>{var e;let t,s,r,l=f,h=[],u=[],v=[],w=[];return e=class extends l{constructor(){super(...arguments),this.geoViewport=(p(this,h),p(this,u,void 0)),this.canvas=p(this,v,void 0),this.container=p(this,w,void 0)}needsProcess(e){return 0!=(e&o.View.NeedsResize)&&(e|=o.View.NeedsProject),e}get geoFrame(){const e=this.geoViewport.value;return null!==e?e.geoFrame:i.GeoBox.globe()}},(()=>{var i;const p="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(i=l[Symbol.metadata])&&void 0!==i?i:null):void 0;t=[n.Property({extends:!0,inherits:!1,willSetValue(e,t){this.owner.callObservers("viewWillSetGeoViewport",e,t,this.owner)},didSetValue(e,t){this.owner.callObservers("viewDidSetGeoViewport",e,t,this.owner)}})],s=[o.ViewRef({viewType:a.CanvasView,willAttachView(e){this.owner.callObservers("viewWillAttachMapCanvas",e,this.owner)},didDetachView(e){this.owner.callObservers("viewDidDetachMapCanvas",e,this.owner)}})],r=[o.ViewRef({viewType:d.HtmlView,willAttachView(e){this.owner.callObservers("viewWillAttachMapContainer",e,this.owner)},didDetachView(e){this.owner.callObservers("viewDidDetachMapContainer",e,this.owner)}})],c(null,null,t,{kind:"field",name:"geoViewport",static:!1,private:!1,access:{has:e=>"geoViewport"in e,get:e=>e.geoViewport,set:(e,t)=>{e.geoViewport=t}},metadata:p},u,h),c(null,null,s,{kind:"field",name:"canvas",static:!1,private:!1,access:{has:e=>"canvas"in e,get:e=>e.canvas,set:(e,t)=>{e.canvas=t}},metadata:p},v,h),c(null,null,r,{kind:"field",name:"container",static:!1,private:!1,access:{has:e=>"container"in e,get:e=>e.container,set:(e,t)=>{e.container=t}},metadata:p},w,h),p&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:p})})(),e})(),U=(()=>{var e;let t,i,s=l.Trait,r=[],o=[],a=[];return e=class extends s{constructor(){super(...arguments),this.geoPerspective=(p(this,r),p(this,o,void 0)),this.layers=p(this,a,void 0)}onStartConsuming(){super.onStartConsuming(),this.layers.consumeTraits(this)}onStopConsuming(){super.onStopConsuming(),this.layers.unconsumeTraits(this)}},(()=>{var h;const u="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(h=s[Symbol.metadata])&&void 0!==h?h:null):void 0;t=[n.Property({valueType:m,value:null,didSetValue(e){this.owner.callObservers("traitDidSetGeoPerspective",e,this.owner)}})],i=[l.TraitSet({traitType:y,binds:!0,willAttachTrait(e,t){this.owner.callObservers("traitWillAttachLayer",e,t,this.owner)},didAttachTrait(e){this.owner.consuming&&e.consume(this.owner)},willDetachTrait(e){this.owner.consuming&&e.unconsume(this.owner)},didDetachTrait(e){this.owner.callObservers("traitDidDetachLayer",e,this.owner)},detectModel:e=>e.getTrait(y),detectTrait:e=>null})],c(null,null,t,{kind:"field",name:"geoPerspective",static:!1,private:!1,access:{has:e=>"geoPerspective"in e,get:e=>e.geoPerspective,set:(e,t)=>{e.geoPerspective=t}},metadata:u},o,r),c(null,null,i,{kind:"field",name:"layers",static:!1,private:!1,access:{has:e=>"layers"in e,get:e=>e.layers,set:(e,t)=>{e.layers=t}},metadata:u},a,r),u&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:u})})(),e})(),K=(()=>{var e;let t,i,n,s,r=h.Controller,l=[],u=[],v=[],w=[],m=[];return e=class extends r{constructor(){super(...arguments),this.map=(p(this,l),p(this,u,void 0)),this.canvas=p(this,v,void 0),this.container=p(this,w,void 0),this.layers=p(this,m,void 0)}createMapView(e){return null}setGeoPerspective(e){if(null===e)return;const t=this.map.view;null!==t&&t.moveTo(e)}},(()=>{var p;const g="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(p=r[Symbol.metadata])&&void 0!==p?p:null):void 0;t=[h.TraitViewRef({consumed:!0,traitType:U,observesTrait:!0,willAttachTrait(e){this.owner.callObservers("controllerWillAttachMapTrait",e,this.owner)},initTrait(e){null!==this.view&&this.owner.setGeoPerspective(e.geoPerspective.value),this.owner.layers.addTraits(e.layers.traits)},deinitTrait(e){this.owner.layers.deleteTraits(e.layers.traits)},didDetachTrait(e){this.owner.callObservers("controllerDidDetachMapTrait",e,this.owner)},traitDidSetGeoPerspective(e){this.owner.setGeoPerspective(e)},traitWillAttachLayer(e,t){this.owner.layers.addTrait(e,t)},traitDidDetachLayer(e){this.owner.layers.deleteTrait(e)},viewType:H,observesView:!0,initView(e){const t=this.trait;null!==t&&this.owner.setGeoPerspective(t.geoPerspective.value);const i=this.owner.layers.controllers;for(const t in i){const n=i[t],s=n.geo.view;null!==s&&null===s.parent&&n.geo.insertView(e)}},willAttachView(e){this.owner.callObservers("controllerWillAttachMapView",e,this.owner)},didAttachView(e){this.owner.canvas.setView(e.canvas.view),this.owner.container.setView(e.container.view)},willDetachView(e){this.owner.canvas.setView(null),this.owner.container.setView(null)},didDetachView(e){this.owner.callObservers("controllerDidDetachMapView",e,this.owner)},viewWillSetGeoViewport(e,t){this.owner.callObservers("controllerWillSetGeoViewport",e,t,this.owner)},viewDidSetGeoViewport(e,t){this.owner.callObservers("controllerDidSetGeoViewport",e,t,this.owner)},viewWillAttachMapCanvas(e){this.owner.canvas.setView(e)},viewDidDetachMapCanvas(e){this.owner.canvas.setView(null)},viewWillAttachMapContainer(e){this.owner.container.setView(e)},viewDidDetachMapContainer(e){this.owner.container.setView(null)}})],i=[o.ViewRef({viewType:a.CanvasView,willAttachView(e){this.owner.callObservers("controllerWillAttachMapCanvasView",e,this.owner)},didDetachView(e){this.owner.callObservers("controllerDidDetachMapCanvasView",e,this.owner)}})],n=[o.ViewRef({viewType:d.HtmlView,willAttachView(e){this.owner.callObservers("controllerWillAttachMapContainerView",e,this.owner)},didAttachView(e){let t=this.owner.map.view;null===t&&(t=this.owner.createMapView(e),this.owner.map.setView(t)),null!==t&&t.container.setView(e)},didDetachView(e){this.owner.callObservers("controllerDidDetachMapContainerView",e,this.owner)}})],s=[h.TraitViewControllerSet({controllerType:b,binds:!0,observes:!0,get parentView(){return this.owner.map.view},getTraitViewRef:e=>e.geo,willAttachController(e){this.owner.callObservers("controllerWillAttachLayer",e,this.owner)},didAttachController(e){const t=e.geo.trait;null!==t&&this.attachLayerTrait(t,e);const i=e.geo.view;null!==i&&this.attachLayerView(i,e)},willDetachController(e){const t=e.geo.view;null!==t&&this.detachLayerView(t,e);const i=e.geo.trait;null!==i&&this.detachLayerTrait(i,e)},didDetachController(e){this.owner.callObservers("controllerDidDetachLayer",e,this.owner)},controllerWillAttachGeoTrait(e,t){this.owner.callObservers("controllerWillAttachLayerTrait",e,t,this.owner),this.attachLayerTrait(e,t)},controllerDidDetachGeoTrait(e,t){this.detachLayerTrait(e,t),this.owner.callObservers("controllerDidDetachLayerTrait",e,t,this.owner)},attachLayerTrait(e,t){},detachLayerTrait(e,t){this.deleteController(t)},controllerWillAttachGeoView(e,t){this.owner.callObservers("controllerWillAttachLayerView",e,t,this.owner),this.attachLayerView(e,t)},controllerDidDetachGeoView(e,t){this.detachLayerView(e,t),this.owner.callObservers("controllerDidDetachLayerView",e,t,this.owner)},attachLayerView(e,t){const i=this.owner.map.view;null!==i&&null===e.parent&&t.geo.insertView(i)},detachLayerView(e,t){e.remove()},controllerDidSetGeoPerspective(e,t){this.owner.callObservers("controllerDidSetLayerGeoPerspective",e,t,this.owner)},createController(e){return void 0!==e?e.createGeoController():super.createController()}})],c(null,null,t,{kind:"field",name:"map",static:!1,private:!1,access:{has:e=>"map"in e,get:e=>e.map,set:(e,t)=>{e.map=t}},metadata:g},u,l),c(null,null,i,{kind:"field",name:"canvas",static:!1,private:!1,access:{has:e=>"canvas"in e,get:e=>e.canvas,set:(e,t)=>{e.canvas=t}},metadata:g},v,l),c(null,null,n,{kind:"field",name:"container",static:!1,private:!1,access:{has:e=>"container"in e,get:e=>e.container,set:(e,t)=>{e.container=t}},metadata:g},w,l),c(null,null,s,{kind:"field",name:"layers",static:!1,private:!1,access:{has:e=>"layers"in e,get:e=>e.layers,set:(e,t)=>{e.layers=t}},metadata:g},m,l),g&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:g})})(),e})();class X{get geoFrame(){return i.GeoBox.globe()}get geoCenter(){return i.GeoPoint.origin()}get zoom(){return 0}get heading(){return 0}get tilt(){return 0}canEqual(e){return e instanceof X&&this.constructor===e.constructor}equals(e){return this===e||e instanceof X&&(e.canEqual(this)&&this.viewFrame.equals(e.viewFrame))}}class Y extends X{constructor(e){super(),this.viewFrame=e}withViewFrame(e){let t=e.xMin,i=e.yMin,n=e.xMax,s=e.yMax;const r=n-t,o=s-i,a=r/o;if(a<2){const a=(o-r/2)/2;i+=a,s-=a,e=new u.R2Box(t,i,n,s)}else if(a>2){const a=(r-2*o)/2;t+=a,n-=a,e=new u.R2Box(t,i,n,s)}return new Y(e)}project(e,t){1===arguments.length&&(Array.isArray(e)?(t=e[1],e=e[0]):(t=e.lat,e=e.lng));const i=this.viewFrame,n=i.xMin+(180+e)/360*i.width,s=i.yMax-(90+t)/180*i.height;return new u.R2Point(n,s)}unproject(e,t){1===arguments.length&&(Array.isArray(e)?(t=e[1],e=e[0]):(t=e.y,e=e.x));const n=this.viewFrame,s=360*(e-n.xMin)/n.width-180,r=180*(n.yMax-t)/n.height-90;return new i.GeoPoint(s,r)}}let Z=(()=>{var e;let t,i,s,r=H,a=[],l=[],h=[],d=[];return e=class extends r{constructor(e){super(),this.geoViewport=(p(this,a),p(this,l,void 0)),this.canvas=p(this,h,void 0),this.container=p(this,d,void 0),this.geoViewport.value=e}willProcess(e){0!=(e&o.View.NeedsProject)&&this.geoViewport.update(),super.willProcess(e)}moveTo(e,t){}static create(t){return void 0===t&&(t=new Y(u.R2Box.undefined())),new e(t)}},(()=>{var u;const p="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(u=r[Symbol.metadata])&&void 0!==u?u:null):void 0;t=[n.Property({extends:!0,update(){this.hasAffinity(n.Affinity.Intrinsic)&&this.value instanceof X&&this.setIntrinsic(this.value.withViewFrame(this.owner.viewFrame))}})],i=[o.ViewRef({extends:!0,didAttachView(e,t){null===this.owner.parent&&e.appendChild(this.owner),super.didAttachView(e,t)},willDetachView(e){super.willDetachView(e),this.owner.parent===e&&e.removeChild(this.owner)}})],s=[o.ViewRef({extends:!0,didAttachView(e,t){this.owner.canvas.insertView(e),super.didAttachView(e,t)},willDetachView(e){super.willDetachView(e);const t=this.owner.canvas.view;null!==t&&t.parent===e&&e.removeChild(t)}})],c(null,null,t,{kind:"field",name:"geoViewport",static:!1,private:!1,access:{has:e=>"geoViewport"in e,get:e=>e.geoViewport,set:(e,t)=>{e.geoViewport=t}},metadata:p},l,a),c(null,null,i,{kind:"field",name:"canvas",static:!1,private:!1,access:{has:e=>"canvas"in e,get:e=>e.canvas,set:(e,t)=>{e.canvas=t}},metadata:p},h,a),c(null,null,s,{kind:"field",name:"container",static:!1,private:!1,access:{has:e=>"container"in e,get:e=>e.container,set:(e,t)=>{e.container=t}},metadata:p},d,a),p&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:p})})(),e})();class _{constructor(e,t,i,n,s,r){this.map=e,this.geoFrame=t,this.geoCenter=i,this.zoom=n,this.heading=s,this.tilt=r}project(e,t){let i;i="number"==typeof e?new mapboxgl.LngLat(e,t):e;const n=this.map.project(i);return new u.R2Point(n.x,n.y)}unproject(e,t){let n;n="number"==typeof e?new mapboxgl.Point(e,t):Array.isArray(e)?e:new mapboxgl.Point(e.x,e.y);const s=this.map.unproject(n);return new i.GeoPoint(s.lng,s.lat)}equals(e){return this===e||e instanceof _&&(this.map===e.map&&this.geoFrame.equals(e.geoFrame)&&this.geoCenter.equals(e.geoCenter)&&this.zoom===e.zoom&&this.heading===e.heading&&this.tilt===e.tilt)}static create(e){const t=e.getBounds(),n=new i.GeoBox(t.getWest(),t.getSouth(),t.getEast(),t.getNorth()),s=e.getCenter(),r=new i.GeoPoint(s.lng,s.lat),o=e.getZoom(),a=e.getBearing(),l=e.getPitch();return new _(e,n,r,o,a,l)}}let J=(()=>{var e;let i,s,a,l,h,u,v,w,g,f,y,b=H,V=[],C=[],T=[],S=[],x=[],k=[],P=[],R=[],A=[],G=[];return e=class extends b{constructor(e){super(),this.map=void p(this,V),this.geoViewport=p(this,C,void 0),this.canvas=p(this,T,void 0),this.container=p(this,S,void 0),this.controlContainer=p(this,x,void 0),this.topLeftControls=p(this,k,void 0),this.topRightControls=p(this,P,void 0),this.bottomLeftControls=p(this,R,void 0),this.bottomRightControls=p(this,A,void 0),this.mapStyle=p(this,G,void 0),this.map=e,this.geoViewport.value=_.create(e),this.onMapRender=this.onMapRender.bind(this),this.onMoveStart=this.onMoveStart.bind(this),this.onMoveEnd=this.onMoveEnd.bind(this),this.initMap(e)}initMap(e){e.on("render",this.onMapRender),e.on("movestart",this.onMoveStart),e.on("moveend",this.onMoveEnd),void 0===e.style?this.mapStyle.update():this.mapStyle.setAffinity(n.Affinity.Extrinsic)}onMapRender(){this.geoViewport.update()}onMoveStart(){this.willMoveMap()}onMoveEnd(){this.didMoveMap()}moveTo(e,i){const n=this.geoViewport.value;if(null===n)return;let s;const a={},l=(e=m.fromLike(e)).geoFrame;null!==l&&(s=[l.west,l.south,l.east,l.north]);const h=e.geoCenter;null===h||n.geoCenter.equivalentTo(h,1e-5)||(a.center=h);const u=e.zoom;void 0===u||t.Equivalent(n.zoom,u,1e-5)||(a.zoom=u);const d=e.heading;void 0===d||t.Equivalent(n.heading,d,1e-5)||(a.bearing=d);const c=e.tilt;void 0===c||t.Equivalent(n.tilt,c,1e-5)||(a.pitch=c),(i=void 0===i||!0===i?this.getLookOr(r.Look.timing,r.Mood.ambient,!1):t.Timing.fromLike(i))instanceof t.Timing?a.duration=i.duration:a.duration=0,a.padding=this.edgeInsets.padding,void 0!==s?this.map.fitBounds(s,a):this.map.flyTo(a),0===a.duration&&setTimeout(this.requireUpdate.bind(this,o.View.NeedsProject))}willMoveMap(){this.callObservers("viewWillMoveMap",this)}didMoveMap(){this.callObservers("viewDidMoveMap",this)}get edgeInsets(){return n.Property.getter()}onResize(){super.onResize(),this.map.resize()}onLayout(){super.onLayout(),this.layoutControls()}layoutControls(){const e=this.container.view;if(null===e)return;const t=e.edgeInsets.value,i=Math.max(e.style.paddingTop.pxState(),t.insetTop),n=Math.max(e.style.paddingRight.pxState(),t.insetRight),s=Math.max(e.style.paddingBottom.pxState(),t.insetBottom),r=Math.max(e.style.paddingLeft.pxState(),t.insetLeft),o=this.topLeftControls.view;null!==o&&(o.style.top.setIntrinsic(i),o.style.left.setIntrinsic(r));const a=this.topRightControls.view;null!==a&&(a.style.top.setIntrinsic(i),a.style.right.setIntrinsic(n));const l=this.bottomLeftControls.view;null!==l&&(l.style.bottom.setIntrinsic(s),l.style.left.setIntrinsic(r));const h=this.bottomRightControls.view;null!==h&&(h.style.bottom.setIntrinsic(s),h.style.right.setIntrinsic(n))}get viewport(){return n.Provider.getter()}onMount(){super.onMount(),this.mapStyle.update()}},(()=>{var t;const r="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(t=b[Symbol.metadata])&&void 0!==t?t:null):void 0;i=[n.Property({extends:!0,didSetValue(e,t){super.didSetValue(e,t);const i=!this.owner.hidden&&!this.owner.culled;this.owner.requireUpdate(o.View.NeedsProject,i)},update(){this.hasAffinity(n.Affinity.Intrinsic)&&this.setIntrinsic(_.create(this.owner.map))}})],s=[o.ViewRef({extends:!0,didAttachView(e,t){null===this.owner.parent&&(e.appendChild(this.owner),e.setEventTarget(this.owner.map.getCanvasContainer())),super.didAttachView(e,t)},willDetachView(e){super.willDetachView(e),this.owner.parent===e&&e.removeChild(this.owner)}})],a=[o.ViewRef({extends:!0,didAttachView(e,t){d.HtmlView.fromNode(this.owner.map.getContainer());const i=d.HtmlView.fromNode(this.owner.map.getCanvasContainer());this.owner.canvas.insertView(i);const n=e.node.querySelector(".mapboxgl-control-container");if(null!==n){this.owner.controlContainer.setView(d.HtmlView.fromNode(n));const e=n.querySelector(".mapboxgl-ctrl-top-left");null!==e&&this.owner.topLeftControls.setView(d.HtmlView.fromNode(e));const t=n.querySelector(".mapboxgl-ctrl-top-right");null!==t&&this.owner.topRightControls.setView(d.HtmlView.fromNode(t));const i=n.querySelector(".mapboxgl-ctrl-bottom-left");null!==i&&this.owner.bottomLeftControls.setView(d.HtmlView.fromNode(i));const s=n.querySelector(".mapboxgl-ctrl-bottom-right");null!==s&&this.owner.bottomRightControls.setView(d.HtmlView.fromNode(s))}super.didAttachView(e,t)},willDetachView(e){super.willDetachView(e);const t=this.owner.canvas.view,i=d.HtmlView.fromNode(this.owner.map.getCanvasContainer());null!==t&&t.parent===i&&i.removeChild(e),this.owner.controlContainer.setView(null),this.owner.topLeftControls.setView(null),this.owner.topRightControls.setView(null),this.owner.bottomLeftControls.setView(null),this.owner.bottomRightControls.setView(null)}})],l=[o.ViewRef({viewType:d.HtmlView})],h=[o.ViewRef({viewType:d.HtmlView})],u=[o.ViewRef({viewType:d.HtmlView})],v=[o.ViewRef({viewType:d.HtmlView})],w=[o.ViewRef({viewType:d.HtmlView})],g=[n.Property({extends:!0,get padding(){const e=this.value;let t=e.insetTop,i=e.insetRight,n=e.insetBottom,s=e.insetLeft;const r=this.owner.container.view;return null!==r&&(t=Math.max(r.style.paddingTop.pxState(),t),i=Math.max(r.style.paddingRight.pxState(),i),n=Math.max(r.style.paddingBottom.pxState(),n),s=Math.max(r.style.paddingLeft.pxState(),s)),{top:t,right:i,bottom:n,left:s}}})],f=[n.Provider({extends:!0,observes:!0,serviceDidSetViewportColorScheme(e){this.owner.mapStyle.update()}})],y=[n.Property({value:null,init(){this.dark="mapbox://styles/mapbox/dark-v10",this.light="mapbox://styles/mapbox/light-v10"},didSetValue(e){null!==e&&this.owner.map.setStyle(e)},update(){if(!this.hasAffinity(n.Affinity.Intrinsic))return;const e=this.owner.viewport.service;if(null===e)return;"dark"===e.colorScheme.value?this.setIntrinsic(this.dark):this.setIntrinsic(this.light)}})],c(e,null,g,{kind:"getter",name:"edgeInsets",static:!1,private:!1,access:{has:e=>"edgeInsets"in e,get:e=>e.edgeInsets},metadata:r},null,V),c(e,null,f,{kind:"getter",name:"viewport",static:!1,private:!1,access:{has:e=>"viewport"in e,get:e=>e.viewport},metadata:r},null,V),c(null,null,i,{kind:"field",name:"geoViewport",static:!1,private:!1,access:{has:e=>"geoViewport"in e,get:e=>e.geoViewport,set:(e,t)=>{e.geoViewport=t}},metadata:r},C,V),c(null,null,s,{kind:"field",name:"canvas",static:!1,private:!1,access:{has:e=>"canvas"in e,get:e=>e.canvas,set:(e,t)=>{e.canvas=t}},metadata:r},T,V),c(null,null,a,{kind:"field",name:"container",static:!1,private:!1,access:{has:e=>"container"in e,get:e=>e.container,set:(e,t)=>{e.container=t}},metadata:r},S,V),c(null,null,l,{kind:"field",name:"controlContainer",static:!1,private:!1,access:{has:e=>"controlContainer"in e,get:e=>e.controlContainer,set:(e,t)=>{e.controlContainer=t}},metadata:r},x,V),c(null,null,h,{kind:"field",name:"topLeftControls",static:!1,private:!1,access:{has:e=>"topLeftControls"in e,get:e=>e.topLeftControls,set:(e,t)=>{e.topLeftControls=t}},metadata:r},k,V),c(null,null,u,{kind:"field",name:"topRightControls",static:!1,private:!1,access:{has:e=>"topRightControls"in e,get:e=>e.topRightControls,set:(e,t)=>{e.topRightControls=t}},metadata:r},P,V),c(null,null,v,{kind:"field",name:"bottomLeftControls",static:!1,private:!1,access:{has:e=>"bottomLeftControls"in e,get:e=>e.bottomLeftControls,set:(e,t)=>{e.bottomLeftControls=t}},metadata:r},R,V),c(null,null,w,{kind:"field",name:"bottomRightControls",static:!1,private:!1,access:{has:e=>"bottomRightControls"in e,get:e=>e.bottomRightControls,set:(e,t)=>{e.bottomRightControls=t}},metadata:r},A,V),c(null,null,y,{kind:"field",name:"mapStyle",static:!1,private:!1,access:{has:e=>"mapStyle"in e,get:e=>e.mapStyle,set:(e,t)=>{e.mapStyle=t}},metadata:r},G,V),r&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:r})})(),e})();class Q{constructor(e,t,i,n,s,r,o){this.map=e,this.geoFrame=t,this.geoCenter=i,this.viewOrigin=n,this.zoom=s,this.heading=r,this.tilt=o}project(e,t){const i=this.viewOrigin;let n;n="number"==typeof e?new L.LatLng(t,e):Array.isArray(e)?new L.LatLng(e[1],e[0]):e;const s=this.map.project(n,this.zoom);return new u.R2Point(s.x-i.x,s.y-i.y)}unproject(e,t){const n=this.viewOrigin;let s;s="number"==typeof e?new L.Point(e+n.x,t+n.y):Array.isArray(e)?new L.Point(e[0]+n.x,e[1]+n.y):new L.Point(e.x+n.x,e.y+n.y);const r=this.map.unproject(s,this.zoom);return new i.GeoPoint(r.lng,r.lat)}equals(e){return this===e||e instanceof Q&&(this.map===e.map&&this.geoFrame.equals(e.geoFrame)&&this.geoCenter.equals(e.geoCenter)&&this.viewOrigin.equals(e.viewOrigin)&&this.zoom===e.zoom&&this.heading===e.heading&&this.tilt===e.tilt)}static create(e){const t=e.getBounds(),n=new i.GeoBox(t.getWest(),t.getSouth(),t.getEast(),t.getNorth()),s=e.getCenter(),r=new i.GeoPoint(s.lng,s.lat);let{x:o,y:a}=e.getPixelOrigin();try{const t=u.Transform.parse(e.getPane("mapPane").style.transform);t instanceof u.TranslateTransform&&(o-=t.x.pxValue(),a-=t.y.pxValue())}catch(e){}const l=new u.R2Point(o,a),h=e.getZoom();return new Q(e,n,r,l,h,0,0)}}let $=(()=>{var e;let i,s,a,l=H,h=[],u=[],v=[],w=[];return e=class extends l{constructor(e){super(),this.map=void p(this,h),this.geoViewport=p(this,u,void 0),this.canvas=p(this,v,void 0),this.container=p(this,w,void 0),this.map=e,this.geoViewport.value=Q.create(e),this.onMapRender=this.onMapRender.bind(this),this.onMoveStart=this.onMoveStart.bind(this),this.onMoveEnd=this.onMoveEnd.bind(this),this.initMap(e)}initMap(e){e.on("move",this.onMapRender),e.on("movestart",this.onMoveStart),e.on("moveend",this.onMoveEnd)}onMapRender(){this.geoViewport.update()}onMoveStart(){this.willMoveMap()}onMoveEnd(){this.didMoveMap()}moveTo(e,i){const n=this.geoViewport.value;if(null===n)return;const s={};let o=(e=m.fromLike(e)).geoCenter;null===o&&(o=n.geoCenter);const a=e.zoom;(i=void 0===i||!0===i?this.getLookOr(r.Look.timing,r.Mood.ambient,!1):t.Timing.fromLike(i))instanceof t.Timing?(s.animate=!0,s.duration=i.duration):s.duration=0,this.map.flyTo(o,a,s)}willMoveMap(){this.callObservers("viewWillMoveMap",this)}didMoveMap(){this.callObservers("viewDidMoveMap",this)}},(()=>{var t;const r="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(t=l[Symbol.metadata])&&void 0!==t?t:null):void 0;i=[n.Property({extends:!0,didSetValue(e,t){super.didSetValue(e,t);const i=!this.owner.hidden&&!this.owner.culled;this.owner.requireUpdate(o.View.NeedsProject,i)},update(){this.hasAffinity(n.Affinity.Intrinsic)&&this.setIntrinsic(Q.create(this.owner.map))}})],s=[o.ViewRef({extends:!0,didAttachView(e,t){null===this.owner.parent&&e.appendChild(this.owner),super.didAttachView(e,t)},willDetachView(e){super.willDetachView(e),this.owner.parent===e&&e.removeChild(this.owner)}})],a=[o.ViewRef({extends:!0,didAttachView(e,t){const i=d.HtmlView.fromNode(e.node.querySelector(".leaflet-control-container")),n=this.owner.canvas.insertView(e,void 0,i);null!==n&&n.style.zIndex.setIntrinsic(500),super.didAttachView(e,t)},willDetachView(e){super.willDetachView(e);const t=this.owner.canvas.view;null!==t&&t.parent===e&&e.removeChild(e)}})],c(null,null,i,{kind:"field",name:"geoViewport",static:!1,private:!1,access:{has:e=>"geoViewport"in e,get:e=>e.geoViewport,set:(e,t)=>{e.geoViewport=t}},metadata:r},u,h),c(null,null,s,{kind:"field",name:"canvas",static:!1,private:!1,access:{has:e=>"canvas"in e,get:e=>e.canvas,set:(e,t)=>{e.canvas=t}},metadata:r},v,h),c(null,null,a,{kind:"field",name:"container",static:!1,private:!1,access:{has:e=>"container"in e,get:e=>e.container,set:(e,t)=>{e.container=t}},metadata:r},w,h),r&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:r})})(),e})();class ee{constructor(e,t,i,n,s,r){this.projection=e,this.geoFrame=t,this.geoCenter=i,this.zoom=n,this.heading=s,this.tilt=r}project(e,t){const i=this.projection;if(null===i)return u.R2Point.undefined();let n;n="number"==typeof e?new google.maps.LatLng(t,e):Array.isArray(e)?new google.maps.LatLng(e[1],e[0]):new google.maps.LatLng(e.lat,e.lng);const s=i.fromLatLngToContainerPixel(n);return null===s?u.R2Point.undefined():new u.R2Point(s.x,s.y)}unproject(e,t){const n=this.projection;if(null===n)return i.GeoPoint.undefined();let s;s="number"==typeof e?new google.maps.Point(e,t):Array.isArray(e)?new google.maps.Point(e[0],e[1]):new google.maps.Point(e.x,e.y);const r=n.fromContainerPixelToLatLng(s);return null===r?i.GeoPoint.undefined():new i.GeoPoint(r.lng(),r.lat())}equals(e){return this===e||e instanceof ee&&(this.projection===e.projection&&this.geoFrame.equals(e.geoFrame)&&this.geoCenter.equals(e.geoCenter)&&this.zoom===e.zoom&&this.heading===e.heading&&this.tilt===e.tilt)}static create(e,t){void 0===t&&(t=null);const n=e.getBounds();let s;if(null!=n){const e=n.getSouthWest(),t=n.getNorthEast();s=new i.GeoBox(e.lng(),e.lat(),t.lng(),t.lat())}else s=i.GeoBox.undefined();const r=e.getCenter(),o=void 0!==r?new i.GeoPoint(r.lng(),r.lat()):i.GeoPoint.origin();let a=e.getZoom();void 0===a&&(a=0);let l=e.getHeading();void 0===l&&(l=0);let h=e.getTilt();return void 0===h&&(h=0),new ee(t,s,o,a,l,h)}}let te=(()=>{var e;let i,s,r,a,l=H,h=[],u=[],v=[],w=[],g=[];return e=class extends l{constructor(e){super(),this.map=void p(this,u),this.geoViewport=p(this,v,void 0),this.canvas=p(this,w,void 0),this.container=p(this,g,void 0),this.map=e,this.mapOverlay=this.createMapOverlay(e),this.geoViewport.value=ee.create(e,this.mapOverlay.getProjection()),this.onMapDraw=this.onMapDraw.bind(this),this.onMapIdle=this.onMapIdle.bind(this),this.initMap(e)}initMap(e){e.addListener("idle",this.onMapIdle)}createMapOverlay(t){const i=new e.MapOverlay(this);return i.setMap(t),i}static get MapOverlay(){return class extends google.maps.OverlayView{constructor(e){super(),this.owner=e}onAdd(){const e=this.owner.container.view;null!==e&&this.owner.container.materializeView(e)}onRemove(){this.owner.canvas.removeView()}draw(){this.owner.onMapDraw()}}}willProcess(e){this.geoViewport.update(),super.willProcess(e)}onMapDraw(){this.geoViewport.update()}onMapIdle(){this.requireUpdate(o.View.NeedsProject)}moveTo(e,i){const n=this.geoViewport.value;if(null===n)return;const s=(e=m.fromLike(e)).geoCenter;null===s||n.geoCenter.equivalentTo(s,1e-5)||this.map.panTo(s);const r=e.zoom;void 0===r||t.Equivalent(n.zoom,r,1e-5)||this.map.setZoom(r);const o=e.heading;void 0===o||t.Equivalent(n.heading,o,1e-5)||this.map.setHeading(o);const a=e.tilt;void 0===a||t.Equivalent(n.tilt,a,1e-5)||this.map.setTilt(a)}},(()=>{var m;const f="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(m=l[Symbol.metadata])&&void 0!==m?m:null):void 0;i=[t.Lazy],s=[n.Property({extends:!0,didSetValue(e,t){super.didSetValue(e,t);const i=!this.owner.hidden&&!this.owner.culled;this.owner.requireUpdate(o.View.NeedsProject,i)},update(){this.hasAffinity(n.Affinity.Intrinsic)&&this.setIntrinsic(ee.create(this.owner.map,this.owner.mapOverlay.getProjection()))}})],r=[o.ViewRef({extends:!0,didAttachView(e,t){null===this.owner.parent&&e.appendChild(this.owner),super.didAttachView(e,t)},willDetachView(e){super.willDetachView(e),this.owner.parent===e&&e.removeChild(this.owner)}})],a=[o.ViewRef({extends:!0,didAttachView(e,t){this.materializeView(e),super.didAttachView(e,t)},willDetachView(e){super.willDetachView(e);const t=this.owner.canvas.view,i=this.owner.mapOverlay.getPanes();if(null===t||null==i)return;const n=d.HtmlView.get(i.overlayMouseTarget),s=null!==n?n.parent:null,r=null!==s?s.parent:null;null!==r&&t.parent===r&&r.removeChild(e)},materializeView(e){const t=this.owner.mapOverlay.getPanes();if(null!=t){!function e(t){const i=t.parentNode;return i instanceof HTMLElement&&null===d.HtmlView.get(i)&&e(i),d.HtmlView.fromNode(t)}(t.overlayMouseTarget);const e=d.HtmlView.get(t.overlayMouseTarget),i=null!==e?e.parent:null,n=null!==i?i.parent:null;this.owner.canvas.insertView(n)}else null===this.owner.canvas.view&&this.owner.canvas.attachView()}})],c(e,null,i,{kind:"getter",name:"MapOverlay",static:!0,private:!1,access:{has:e=>"MapOverlay"in e,get:e=>e.MapOverlay},metadata:f},null,h),c(null,null,s,{kind:"field",name:"geoViewport",static:!1,private:!1,access:{has:e=>"geoViewport"in e,get:e=>e.geoViewport,set:(e,t)=>{e.geoViewport=t}},metadata:f},v,u),c(null,null,r,{kind:"field",name:"canvas",static:!1,private:!1,access:{has:e=>"canvas"in e,get:e=>e.canvas,set:(e,t)=>{e.canvas=t}},metadata:f},w,u),c(null,null,a,{kind:"field",name:"container",static:!1,private:!1,access:{has:e=>"container"in e,get:e=>e.container,set:(e,t)=>{e.container=t}},metadata:f},g,u),f&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:f}),p(e,h)})(),e})();class ie{constructor(e,t,i,n,s,r){this.map=e,this.geoFrame=t,this.geoCenter=i,this.zoom=n,this.heading=s,this.tilt=r}equals(e){return this===e||e instanceof ie&&(this.map===e.map&&this.geoFrame.equals(e.geoFrame)&&this.geoCenter.equals(e.geoCenter)&&this.zoom===e.zoom&&this.heading===e.heading&&this.tilt===e.tilt)}static init(){void 0===ie.webMercatorUtils&&window.require(["esri/geometry/support/webMercatorUtils"],(function(e){ie.webMercatorUtils=e}))}}ie.webMercatorUtils=void 0;class ne extends H{constructor(){super(),ie.init()}}class se extends ie{constructor(e,t,i,n,s,r){super(e,t,i,n,s,r)}project(e,t){let i;i="number"==typeof e?{x:e,y:t,spatialReference:{wkid:4326}}:Array.isArray(e)?{x:e[0],y:e[1],spatialReference:{wkid:4326}}:{x:e.lng,y:e.lat,spatialReference:{wkid:4326}};const n=this.map.toScreen(i);return null!==n?new u.R2Point(n.x,n.y):u.R2Point.origin()}unproject(e,t){let n;n="number"==typeof e?{x:e,y:t}:Array.isArray(e)?{x:e[0],y:e[1]}:e;const s=this.map.toMap(n);return null!==s?new i.GeoPoint(s.longitude,s.latitude):i.GeoPoint.origin()}static create(e){let t,n=e.extent;null===n?t=i.GeoBox.undefined():(n=ie.webMercatorUtils.webMercatorToGeographic(n,!1),t=new i.GeoBox(n.xmin,n.ymin,n.xmax,n.ymax));const s=e.center,r=new i.GeoPoint(s.longitude,s.latitude),o=e.zoom,a=e.rotation;return new se(e,t,r,o,a,0)}}let re=(()=>{var e;let i,s,a,l=ne,h=[],u=[],v=[],w=[];return e=class extends l{constructor(e){super(),this.map=void p(this,h),this.geoViewport=p(this,u,void 0),this.canvas=p(this,v,void 0),this.container=p(this,w,void 0),this.map=e,this.geoViewport.value=se.create(e),this.onMapRender=this.onMapRender.bind(this),this.initMap(e)}initMap(e){e.watch("extent",this.onMapRender)}onMapRender(){this.geoViewport.update()}moveTo(e,i){const n=this.geoViewport.value;if(null===n)return;const s={},o={},a=(e=m.fromLike(e)).geoCenter;null===a||n.geoCenter.equivalentTo(a,1e-5)||(s.center=[a.lng,a.lat]);const l=e.zoom;void 0===l||t.Equivalent(n.zoom,l,1e-5)||(s.zoom=l);const h=e.heading;void 0===h||t.Equivalent(n.heading,h,1e-5)||(s.heading=h);const u=e.tilt;void 0===u||t.Equivalent(n.tilt,u,1e-5)||(s.tilt=u),(i=void 0===i||!0===i?this.getLookOr(r.Look.timing,r.Mood.ambient,!1):t.Timing.fromLike(i))instanceof t.Timing?o.duration=i.duration:o.duration=0,this.map.goTo(s,o)}},(()=>{var t;const r="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(t=l[Symbol.metadata])&&void 0!==t?t:null):void 0;i=[n.Property({extends:!0,didSetValue(e,t){super.didSetValue(e,t);const i=!this.owner.hidden&&!this.owner.culled;this.owner.requireUpdate(o.View.NeedsProject,i)},update(){this.hasAffinity(n.Affinity.Intrinsic)&&this.setIntrinsic(se.create(this.owner.map))}})],s=[o.ViewRef({extends:!0,didAttachView(e,t){null===this.owner.parent&&(e.appendChild(this.owner),e.setEventTarget(this.owner.map.container.querySelector(".esri-view-root"))),super.didAttachView(e,t)},willDetachView(e){super.willDetachView(e),this.owner.parent===e&&e.removeChild(this.owner)}})],a=[o.ViewRef({extends:!0,didAttachView(e,t){const i=d.HtmlView.fromNode(this.owner.map.container),n=d.HtmlView.fromNode(i.node.querySelector(".esri-view-root")),s=d.HtmlView.fromNode(n.node.querySelector(".esri-overlay-surface"));this.owner.canvas.insertView(s),super.didAttachView(e,t)},willDetachView(e){super.willDetachView(e);const t=this.owner.canvas.view,i=d.HtmlView.fromNode(this.owner.map.container),n=d.HtmlView.fromNode(i.node.querySelector(".esri-view-root")),s=d.HtmlView.fromNode(n.node.querySelector(".esri-overlay-surface"));null!==t&&t.parent===s&&s.removeChild(e)}})],c(null,null,i,{kind:"field",name:"geoViewport",static:!1,private:!1,access:{has:e=>"geoViewport"in e,get:e=>e.geoViewport,set:(e,t)=>{e.geoViewport=t}},metadata:r},u,h),c(null,null,s,{kind:"field",name:"canvas",static:!1,private:!1,access:{has:e=>"canvas"in e,get:e=>e.canvas,set:(e,t)=>{e.canvas=t}},metadata:r},v,h),c(null,null,a,{kind:"field",name:"container",static:!1,private:!1,access:{has:e=>"container"in e,get:e=>e.container,set:(e,t)=>{e.container=t}},metadata:r},w,h),r&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:r})})(),e})();class oe extends ie{constructor(e,t,i,n,s,r){super(e,t,i,n,s,r)}project(e,t){let i;i="number"==typeof e?{x:e,y:t,spatialReference:{wkid:4326}}:Array.isArray(e)?{x:e[0],y:e[1],spatialReference:{wkid:4326}}:{x:e.lng,y:e.lat,spatialReference:{wkid:4326}};const n=this.map.toScreen(i);return null!==n?new u.R2Point(n.x,n.y):u.R2Point.origin()}unproject(e,t){let n;n="number"==typeof e?{x:e,y:t}:Array.isArray(e)?{x:e[0],y:e[1]}:e;const s=this.map.toMap(n);return null!==s?new i.GeoPoint(s.longitude,s.latitude):i.GeoPoint.origin()}static create(e){let t,n=e.extent;null===n?t=i.GeoBox.undefined():(n=ie.webMercatorUtils.webMercatorToGeographic(n,!1),t=new i.GeoBox(n.xmin,n.ymin,n.xmax,n.ymax));const s=e.center,r=new i.GeoPoint(s.longitude,s.latitude),o=e.zoom,a=e.camera.heading,l=e.camera.tilt;return new oe(e,t,r,o,a,l)}}let ae=(()=>{var e;let i,s,a,l=ne,h=[],u=[],v=[],w=[];return e=class extends l{constructor(e){super(),this.map=void p(this,h),this.geoViewport=p(this,u,void 0),this.canvas=p(this,v,void 0),this.container=p(this,w,void 0),this.map=e,this.geoViewport.value=oe.create(e),this.onMapRender=this.onMapRender.bind(this),this.initMap(e)}initMap(e){e.watch("extent",this.onMapRender)}onMapRender(){this.geoViewport.update()}moveTo(e,i){const n=this.geoViewport.value;if(null===n)return;const s={},o={},a=(e=m.fromLike(e)).geoCenter;null===a||n.geoCenter.equivalentTo(a,1e-5)||(s.center=[a.lng,a.lat]);const l=e.zoom;void 0===l||t.Equivalent(n.zoom,l,1e-5)||(s.zoom=l);const h=e.heading;void 0===h||t.Equivalent(n.heading,h,1e-5)||(s.heading=h);const u=e.tilt;void 0===u||t.Equivalent(n.tilt,u,1e-5)||(s.tilt=u),(i=void 0===i||!0===i?this.getLookOr(r.Look.timing,r.Mood.ambient,!1):t.Timing.fromLike(i))instanceof t.Timing?o.duration=i.duration:o.duration=0,this.map.goTo(s,o)}},(()=>{var t;const r="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(t=l[Symbol.metadata])&&void 0!==t?t:null):void 0;i=[n.Property({extends:!0,didSetValue(e,t){super.didSetValue(e,t);const i=!this.owner.hidden&&!this.owner.culled;this.owner.requireUpdate(o.View.NeedsProject,i)},update(){this.hasAffinity(n.Affinity.Intrinsic)&&this.setIntrinsic(oe.create(this.owner.map))}})],s=[o.ViewRef({extends:!0,didAttachView(e,t){null===this.owner.parent&&(e.appendChild(this.owner),e.setEventTarget(this.owner.map.container.querySelector(".esri-view-root"))),super.didAttachView(e,t)},willDetachView(e){super.willDetachView(e),this.owner.parent===e&&e.removeChild(this.owner)}})],a=[o.ViewRef({extends:!0,didAttachView(e,t){const i=d.HtmlView.fromNode(this.owner.map.container),n=d.HtmlView.fromNode(i.node.querySelector(".esri-view-root")),s=d.HtmlView.fromNode(n.node.querySelector(".esri-view-surface"));this.owner.canvas.insertView(s),super.didAttachView(e,t)},willDetachView(e){super.willDetachView(e);const t=this.owner.canvas.view,i=d.HtmlView.fromNode(this.owner.map.container),n=d.HtmlView.fromNode(i.node.querySelector(".esri-view-root")),s=d.HtmlView.fromNode(n.node.querySelector(".esri-view-surface"));null!==t&&t.parent===s&&s.removeChild(e)}})],c(null,null,i,{kind:"field",name:"geoViewport",static:!1,private:!1,access:{has:e=>"geoViewport"in e,get:e=>e.geoViewport,set:(e,t)=>{e.geoViewport=t}},metadata:r},u,h),c(null,null,s,{kind:"field",name:"canvas",static:!1,private:!1,access:{has:e=>"canvas"in e,get:e=>e.canvas,set:(e,t)=>{e.canvas=t}},metadata:r},v,h),c(null,null,a,{kind:"field",name:"container",static:!1,private:!1,access:{has:e=>"container"in e,get:e=>e.container,set:(e,t)=>{e.container=t}},metadata:r},w,h),r&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:r})})(),e})();e.EquirectangularMapViewport=Y,e.EsriMapView=re,e.EsriMapViewport=se,e.EsriSceneView=ae,e.EsriSceneViewport=oe,e.EsriView=ne,e.EsriViewport=ie,e.GeoArcView=j,e.GeoCircleView=B,e.GeoController=b,e.GeoFeatureController=S,e.GeoFeatureTrait=T,e.GeoFeatureView=C,e.GeoIconController=q,e.GeoIconTrait=z,e.GeoIconView=N,e.GeoLayerController=R,e.GeoLayerTrait=x,e.GeoPerspective=m,e.GeoPerspectiveInit=w,e.GeoPerspectiveLike=v,e.GeoPlotView=I,e.GeoPointView=E,e.GeoRasterView=A,e.GeoRippleView=V,e.GeoShapeController=F,e.GeoShapeTrait=D,e.GeoShapeView=W,e.GeoTileController=O,e.GeoTileTrait=M,e.GeoTileView=G,e.GeoTrait=y,e.GeoTree=k,e.GeoTreeView=P,e.GeoView=f,e.GeoViewport=g,e.GoogleMapView=te,e.GoogleMapViewport=ee,e.LeafletView=$,e.LeafletViewport=Q,e.MapController=K,e.MapTrait=U,e.MapView=H,e.MapboxView=J,e.MapboxViewport=_,e.WorldMapView=Z,e.WorldMapViewport=X,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
//# sourceMappingURL=swim-maps.min.js.map
